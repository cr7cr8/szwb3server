{"version":3,"sources":["logo.svg","ThemeContextProvider.js","EditingBlock.js","config.js","CommentSector.js","Content.js","useAppContext.js","PeopleList.js","MentionPlugin.js","PersonPlugin.js","EmojiConfig.js","EmojiPanel.js","EmojiPlugin.js","cropImage.js","ImageBlock.js","LinkPlugin.js","VoteBlock.js","DraftEditor.js","ImagePlugin.js","VotePlugin.js","SimpleDraft.js","ContextProvider.js","ContentPerson.js","MainPage.js","App.js","reportWebVitals.js","index.js"],"names":["ThemeContextProvider","props","useState","sizeObj","xs","sm","md","lg","xl","setSizeObj","scaleSizeObj","useCallback","factor","obj","Object","keys","forEach","itemKey","num","Number","replace","unit","String","addingSizeObj","numOfPix","Math","abs","React","mode","setMode","myTheme","useMemo","createTheme","palette","panelColor","mentionBg","isLight","isDark","components","MuiButton","defaultProps","variant","disableRipple","MuiPaper","styleOverrides","root","ownerState","theme","sx","fontSize","MuiSvgIcon","color","text","secondary","ThemeProvider","CssBaseline","children","EditingBlock","VoteBlock","readOnly","setReadOnly","markingImageBlock","markingVoteBlock","useContext","Context","currentBlockKey","editorState","imageBlockNum","hasVoteBlock","setEditorState","Boolean","getCurrentContent","getBlocksAsArray","filter","block","getType","length","selection","getSelection","toArray","hasfocus","isCollapsed","getBlockForKey","currentBlockText","getText","currentBlockType","useTheme","map","blockKey","key","blockType","blockData","getData","toObject","isCurrentRow","Box","paddingTop","style","isSmallFont","textAlign","width","paddingLeft","paddingRight","boxShadow","transform","backgroundColor","background","default","transition","position","zIndex","display","alignItems","IconButton","height","left","right","opacity","size","contentEditable","suppressContentEditableWarning","onClick","ImageOutlined","StackedBarChart","url","colorArr","red","pink","purple","deepPurple","indigo","blue","lightBlue","cyan","teal","green","lightGreen","lime","yellow","amber","orange","deepOrange","brown","grey","blueGrey","colorIndexArr","toPreHtml","stateToHTML","defaultBlockTag","inlineStyleFn","styleNameSet","styleObj","element","attributes","includes","entityStyleFn","entity","type","data","mutablity","indexOf","blockStyleFn","getKey","blockRenderers","imageBlock","escape","JSON","stringify","voteBlock","hexify","values","split","a","parseFloat","r","floor","parseInt","g","b","toString","slice","hexToRGB","hex","alpha","hexToRGB2","uniqByKeepFirst","seen","Set","item","k","has","add","getColor","name","userName","userInfoArr","userColor","avatarString","multiavatar","avatarColor","colorItem","findIndex","colorName","find","userItem","match","getColor3","CommentSector","toHtml","PostingTime","commentCount","setCommentCount","preHtmlEditor","location","useLocation","isPersonPage","matchPath","pathname","useAppContext","setNeedReduceArr","postArr","postID","content","ownerName","postingTime","getColor2","bgcolor","getColor4","commentArr","setCommentArr","loadComments","beforeTime","axios","get","then","response","pre","commentID","useEffect","addOneSubComment","comment","subCommentNum","minusOneSubComment","incomingSubComment","setIncomingSubComment","tabIndex","setTabIndex","unmountEditor","setUnmountEditor","commentIDSet","setCommentIDSet","className","paddingBottom","index","Fragment","Divider","marginBottom","justifyContent","AvatarChip","avatarScale","textScale","title","Reply","post","console","log","deleteComment","max","DeleteOutline","delete","ChatBubbleOutline","Typography","marginLeft","flexGrow","Collapse","in","unmountOnExit","borderRadius","overflow","marginTop","SimpleDraftProvider","subCommentEditor","openEditor","onSubmit","newSubComment","SubCommentSector","Button","fullWidth","subCommentArr","setSubCommentArr","loadSubComments","subCommentID","subComment","Paper","deleteSubComment","textTransform","MoreHoriz","ContentContext","createContext","preHtml","target","setSize","setLightBoxOn","allImageArr","ReactHtmlParser","transformFn","node","attribs","child","avatarElement","convertNodeToElement","personName","reactElementToJSXString","linkAdd","LinkTag","parse","unescape","imgDataArr","img","push","Array","isArray","Images","VoteFrame","Content","savedPostArr","setSavedPostArr","setPostArr","dialogSize","setDialogSize","breakpointColumnsObj","breakpoints","isFull","setIsFull","useInView","threshold","triggerOnce","initialInView","rootMargin","ref","inView","entry","getSinglePost","openIndex","setOpenIndex","lightBoxOn","Provider","value","breakpointCols","columnClassName","newKey","PostFrame","isFirstOne","setOpen","padding","spacing","margin","CircularProgress","Dialog","onBackdropClick","open","onClose","random","scroll","useRef","currentSize","commentNum","needUpdateArr","needReduceArr","setNeedUpdateArr","count","resizeObserver","ResizeObserver","entries","current","contentRect","observe","disconnect","setPreHtmlEditor","setOpenEditor","openComment","setOpenComment","unmountComment","setUnmountComment","id","wordWrap","Stack","direction","date","Date","intervalDelay","renderer","days","hours","minutes","seconds","completed","PostTimeRender","overtime","Hidden","smDown","e","preventDefault","stopPropagation","AspectRatioOutlined","mdUp","Edit","marginRight","setContent","component","cursor","textDecoration","Link","href","rel","numOfImage","baseGrid","gridTemplateColumns","gridTemplateRows","arr","gridColumn","gridRow","imageHeight","cssObj","gridGap","photoIndex","setPhotoIndex","isOpen","setIsOpen","images","imgSnap","substr","lastIndexOf","imgUrl","mainSrc","nextSrc","prevSrc","onCloseRequest","onMovePrevRequest","onMoveNextRequest","onAfterOpen","pic","imageSnap","src","objectFit","pos","setUserName","voteDataObj","voteArr","voteTopic","pollDuration","percentageArr","setPercentageArr","expireTime","setExpireTime","isVotting","setIsVotting","totalVotes","setTotalVotes","voteCountRef","voteCountArr","whoVoted","now","reduce","next","toFixed","choice","action","disabledBackground","disabled","totalVotes_","put","choicePos","LinearProgress","alt","top","whiteSpace","textOverflow","substring","TimeRender","onComplete","message","AppContext","PeopleList","setShowing","setTabName","nameList","insertMention","inTab","setRight","setOpacity","anchor","getBoundingClientRect","x","window","innerWidth","useParams","bind","inList","userAvatarUrl","clickFn","avatarNameArr","setUserAvatarUrl","hoverColor","avatarSrc","btoa","ConditionalWrapper","condition","wrapper","to","Chip","clickable","avatar","Avatar","label","onMouseDown","createMentionPlugin","newContent","entityKeyObj","tagStartPos","tagEndPos","isShowing","tabName","bool","contentState","anchorKey","anchorOffset","focusKey","focusOffset","isBackward","anchorStartKey","newSelection","merge","hasFocus","Modifier","replaceText","applyEntity","setTimeout","EditorState","forceSelection","acceptSelection","checkShowing","mentionPlugin","onChange","newState","setEditorState_","mentionOn","createEntity","mentionType","getLastCreatedEntityKey","mentionOff","personTag","anchorFocusKey","anchorFocusOffset","regx","oldSelection","searchAllBlock","getBlockMap","getStartKey","conditionWrap","matchArr","blockText","getCharacterList","itemEntityKey","getEntity","exec","start","end","contentFocusAt","taggingMention","keyBindingFn","getEditorState","keyCode","handleKeyCommand","command","evenTimeStamp","handleReturn","decorators","strategy","contentBlock","callback","findEntityRanges","character","entityKey","peopleList","decoratedText","offsetKey","mentionHeadKey","mentionBodyKey","person","imgurl","RegExp","people","createPersonPlugin","personPlugin","backgroundImage","verticalAlign","backgroundSize","backgroundRepeat","backgroundPositionX","backgroundPositionY","lineHeight","emojiRegex","require","emojiRegexRGI","emojiArr14","emojiArr","symbolStr","category","isChrome","EmojiPanel","insertEmoji","typeName","editorRef","anchorEl","setAnchorEl","undefined","dataArr","emojiIndex","setEmojiIndex","event","currentTarget","alignSelf","EmojiEmotionsOutlined","Popover","anchorOrigin","vertical","horizontal","transformOrigin","flexDirection","wordBreak","emoji","createImagePlugin","anchorStartOffset","setFocus","emojiPlugin","EmojiComp","createImage","Promise","resolve","reject","image","Image","addEventListener","error","setAttribute","getRadianAngle","degreeValue","PI","rotateSize","rotation","rotRad","cos","sin","getCroppedImg","imageSrc","pixelCrop","flip","canvas","document","createElement","ctx","getContext","bBoxWidth","bBoxHeight","translate","rotate","scale","drawImage","getImageData","y","picW","picH","putImageData","toBlob","file","URL","createObjectURL","ImageBlock","imageObj","setImageObj","blockProps","useLayoutEffect","useResizeObserver","useSize","inputRef","multiple","accept","files","trim","newFileArr","imgId","isEditing","preBlock","click","AddCircleOutline","Close","ImageAdjuster","imageUrl","imageId","ImageSnap","Crop","crop","setCrop","setRotation","zoom","setZoom","croppedAreaPixels","setCroppedAreaPixels","onCropComplete","croppedArea","croppedImage","setIsEidting","DoneRounded","aspect","onCropChange","onRotationChange","onZoomChange","Slider","min","step","bottom","createLinkPlugin","linkPlugin","styleArr","getStyle","removeInlineStyle","applyInlineStyle","taggingLink","setVoteArr","setVoteTopic","gap","TextField","multiline","placeholder","onFocus","onBlur","onKeyDown","code","splice","getElementById","focus","RemoveCircleOutline","TimeBar","setPollDuration","d","h","m","valueLabelDisplay","valueLabelFormat","numOfMins_","marks","hasCommandModifier","KeyBindingUtil","createEmojiPlugin","imagePlugin","isDeleting","SelectionState","createEmpty","setBlockType","votePlugin","createVotePlugin","DraftEditor","setCurrentBlockKey","frameRef","shadowValue","setShadowValue","specialBakcSpace","postDisable","setPostDisable","autoFocused","setAutoFocused","setBlockData","Immutable","Map","es","FormatSize","RichUtils","toggleBlockType","FormatAlignLeft","FormatAlignCenter","FormatAlignRight","addEmptyBlock","HorizontalSplitOutlined","Switch","checked","startKey","newContentState","plugins","customStyleFn","styleNameArr","blockRendererFn","editable","blockRenderMap","startOffset","getStartOffset","getEndKey","getEndOffset","getAnchorKey","getAnchorOffset","getFocusKey","getFocusOffset","getIsBackward","getHasFocus","allBlocks","firstBlockKey","getKeyBefore","getBlockBefore","shift","store","beforeKey","beforeBlock","targetRange","removeRange","getLength","deleteBlock2","deleteBlock1","shiftKey","altKey","getDefaultKeyBinding","alert","endKey","upperBlockKey","lowerBlockKey","getKeyAfter","adjacentBlock","getBlockAfter","handleBeforeInput","aaa","selectionState","my","blockTypeArr","stepPromiseArr","voteBlockData","FormData","data2","promiseArr","promiseArr2","fileNameArr","fileNameArr2","fetch","res","filename","blob","promise","all","blobArr","append","File","headers","newBlock","ContentBlock","characterList","List","newBlockMap","set","ContentState","createFromBlockArray","getSelectionBefore","getSelectionAfter","SimpleDraft","setIsOnFocus","shadows","Send","useEditorState","savedEditorState","usePeopleListState","setPeopleList","ContextProvider","savedImageObj","setSavedImageObj","setSavedEditorState","savedVoteArr","setSavedVoteArr","savedVoteTopic","setSavedVoteTopic","savedPollDuration","setSavedPollDuration","ContentPerson","allPostArr","MainPage","setClickFn","isAnimiDone","setIsAnimiDone","useNavigate","px","mx","maxWidth","Grid","container","callBack","App","localStorage","getItem","setUserColor","setAvatarNameArr","setUserInfoArr","setRandom","hasAvatar","setItem","Container","disableGutters","fixed","path","BarMain","BarPerson","settingOn","setSettingOn","newName","setNewName","nameInputRef","nameBtn","setNameBtn","RadioGroup","row","sizeValue","FormControlLabel","control","Radio","flexWrap","borderWidth","borderColor","borderStyle","inputProps","maxLength","isThere","result","reload","overflowY","navigate","newDescription","setNewDescription","userAvatarSrc","banerRef","setHeight","setImageUrl","maxHeight","ImageAdjuster2","autoFocus","description","blobData","AddAPhoto","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.b5a7334c.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/logo.6ce24c58.svg\";","import React, { createContext, useEffect, useState, useReducer, useRef, useMemo, useCallback, useLayoutEffect, useContext, Component } from 'react';\r\nimport {\r\n  EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw,\r\n  RichUtils, Modifier, convertFromHTML, AtomicBlockUtils\r\n} from 'draft-js';\r\n\r\nimport { ThemeProvider, useTheme, createTheme, experimental_sx as sx } from '@mui/material/styles';\r\n\r\nimport { Button, CssBaseline, Switch, Typography } from '@mui/material';\r\nimport { arrowFunctionExpression } from '@babel/types';\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport default function ThemeContextProvider(props) {\r\n\r\n\r\n  const [sizeObj, setSizeObj] = useState(props.sizeObj || { xs: \"1.5rem\", sm: \"1.5rem\", md: \"1.5rem\", lg: \"1.5rem\", xl: \"1.5rem\" })\r\n\r\n  //const [sizeObj, setSizeObj] = useState(props.sizeObj || { xs: \"3rem\", sm: \"3rem\", md: \"3rem\", lg: \"3rem\", xl: \"3rem\" })\r\n\r\n\r\n  const scaleSizeObj = useCallback((factor = 1) => {\r\n    const obj = {}\r\n    Object.keys(sizeObj).forEach(itemKey => {\r\n\r\n      const num = Number(sizeObj[itemKey].replace(/[^\\d\\.]/g, '')) * factor\r\n      const unit = String(sizeObj[itemKey].replace(/[\\d\\.]/g, ''))\r\n      obj[itemKey] = num + unit\r\n\r\n    })\r\n\r\n    return obj\r\n  }, [sizeObj])\r\n\r\n\r\n  const addingSizeObj = useCallback((numOfPix = 0) => {\r\n    const obj = {}\r\n    Object.keys(sizeObj).forEach(itemKey => {\r\n\r\n      //  const num = Number(sizeObj[itemKey].replace(/[^\\d\\.]/g, '')) * factor\r\n      //  const unit = String(sizeObj[itemKey].replace(/[\\d\\.]/g, ''))\r\n      obj[itemKey] = `calc(${sizeObj[itemKey]} ${numOfPix >= 0 ? \"+\" : \"-\"} ${Math.abs(numOfPix)}px)`\r\n\r\n    })\r\n\r\n    return obj\r\n  }, [sizeObj])\r\n\r\n\r\n\r\n  const [mode, setMode] = React.useState('light');\r\n  const myTheme = React.useMemo(\r\n    () =>\r\n      createTheme({\r\n        palette: {\r\n          mode,\r\n          panelColor: mode === \"light\" ? \"lightgray\" : \"darkgray\",\r\n          mentionBg: mode === \"light\" ? \"aliceblue\" : \"skyblue\",\r\n        },\r\n        sizeObj,\r\n        setSizeObj,\r\n        setMode,\r\n        scaleSizeObj,\r\n        addingSizeObj,\r\n        mode,\r\n        isLight: mode === \"light\",\r\n        isDark: mode === \"dark\",\r\n        components: {\r\n          // MuiTypography: {\r\n          //   styleOverrides: {\r\n          //     root: ({ ownerState, theme, ...props }) => {\r\n          //      //alert(JSON.stringify(props))\r\n          //       return [\r\n          //         ownerState.variant === 'body2' &&\r\n          //         sx({\r\n          //           fontSize: theme.sizeObj,\r\n          //         }),\r\n\r\n          //       ]\r\n          //     }\r\n          //   }\r\n          // },\r\n          MuiButton:{\r\n            defaultProps:{\r\n              variant:\"contained\",\r\n              disableRipple:false,\r\n            }\r\n          },\r\n          MuiPaper:{\r\n            defaultProps:{\r\n\r\n            },\r\n\r\n            styleOverrides: {\r\n              root: ({ ownerState, theme, ...props }) => {\r\n             \r\n                return [\r\n                //  ownerState.variant === 'body2' &&\r\n                  sx({\r\n                    fontSize: theme.sizeObj,\r\n                  }),\r\n\r\n                ]\r\n              }\r\n            }\r\n          },\r\n          MuiSvgIcon:{\r\n            styleOverrides:{\r\n              root: ({ ownerState, theme, ...props }) => {\r\n             \r\n                return [\r\n                //  ownerState.variant === 'body2' &&\r\n                  sx({\r\n                    color: theme.palette.text.secondary,\r\n                  }),\r\n\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }),\r\n    [mode,sizeObj],\r\n  );\r\n\r\n  return (\r\n\r\n    <ThemeProvider theme={myTheme}>\r\n      <CssBaseline />\r\n      {props.children}\r\n    </ThemeProvider>\r\n\r\n\r\n  )\r\n\r\n\r\n}","import React, { useState, useRef, useEffect, useContext, useCallback, createContext, useMemo } from 'react';\r\n\r\nimport { genKey, EditorBlock, EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, AtomicBlockUtils } from 'draft-js';\r\nimport Editor from \"draft-js-plugins-editor\";\r\nimport Immutable from 'immutable';\r\n\r\n\r\nimport {\r\n  isMobile,\r\n  isFirefox,\r\n  isChrome,\r\n  browserName,\r\n  engineName,\r\n} from \"react-device-detect\";\r\nimport { Context } from './ContextProvider';\r\nimport { Container, Grid, Paper, IconButton, ButtonGroup, Stack, Box } from '@mui/material';\r\nimport { ImageOutlined, StackedBarChart } from '@mui/icons-material';\r\nimport { Scale } from '@mui/icons-material';\r\n\r\nimport { ThemeProvider, useTheme, createTheme } from '@mui/material/styles';\r\n\r\nexport default function EditingBlock({ VoteBlock, readOnly, setReadOnly, markingImageBlock, markingVoteBlock, children, ...props }) {\r\n\r\n  //const arr = [[props.children[0]]]\r\n\r\n  const { currentBlockKey, editorState, imageBlockNum,setEditorState } = useContext(Context)\r\n\r\n\r\n  const hasVoteBlock = Boolean(editorState.getCurrentContent().getBlocksAsArray().filter(block => {\r\n    return block.getType() === \"voteBlock\"\r\n  }).length);\r\n\r\n\r\n\r\n\r\n  const selection = editorState.getSelection()\r\n  const [anchorKey, anchorOffset, focusKey, focusOffset, isBackward, hasfocus] = editorState.getSelection().toArray()\r\n  const isCollapsed = selection.isCollapsed()\r\n\r\n  const block = editorState.getCurrentContent().getBlockForKey(currentBlockKey)//.getText();\r\n\r\n  const currentBlockText = block && block.getText()\r\n  const currentBlockType = block && block.getType()\r\n\r\n  const theme = useTheme()\r\n\r\n\r\n\r\n\r\n  return (\r\n    < >\r\n      {children.map(block => {\r\n\r\n        const blockKey = block.key\r\n        const blockType = editorState.getCurrentContent().getBlockForKey(block.key).getType()\r\n        const blockData = editorState.getCurrentContent().getBlockForKey(block.key).getData().toObject()\r\n\r\n\r\n\r\n        //  console.log(blockData.toObject())\r\n\r\n        //   console.log(alignPos)\r\n\r\n        const isCurrentRow = (blockKey === currentBlockKey) && (hasfocus) && (isCollapsed)\r\n\r\n        if (blockType === \"imageBlock\") {\r\n          //  return <div className=\"image-block\">{block}</div>\r\n          return <Box key={blockKey} sx={{ \"& + &\": { paddingTop: \"2px\" } }}>{block}</Box>\r\n        }\r\n        else if (blockType === \"voteBlock\") {\r\n          //   return <VoteBlock readOnly={readOnly} setReadOnly={setReadOnly} />\r\n          return <Box key={blockKey} sx={{ \"& + &\": { paddingTop: \"2px\" } }}>{block}</Box>\r\n\r\n\r\n        }\r\n        return (\r\n          <Box\r\n\r\n            key={blockKey}\r\n            style={{\r\n              // transition: \"box-shadow transform 300ms\",\r\n              //  WebkitTransition: \"background-color box-shadow transform 300ms\",\r\n              // backgroundColor:\"yellow\"\r\n            }}\r\n\r\n            sx={{\r\n              //     boxSizing: \"border-box\",\r\n              ...(blockData.isSmallFont) && { fontSize: theme.scaleSizeObj(0.8) },\r\n              ...(blockType === \"unstyled\") && { \"& > div\": { textAlign: \"left\", width: \"100%\" } },\r\n              ...(blockType === \"centerBlock\") && { \"& > div\": { textAlign: \"center\", width: \"100%\" } },\r\n              ...(blockType === \"rightBlock\") && { \"& > div\": { textAlign: \"right\", width: \"100%\" } },\r\n\r\n              // ...(blockType === \"centerBlock\") && { display: \"flex\", justifyContent: \"center\" },\r\n              // ...(blockType === \"rightBlock\") && { display: \"flex\", justifyContent: \"flex-end\" },\r\n\r\n              // bgcolor: \"yellow\",\r\n              paddingLeft: \"2px\",\r\n              paddingRight: \"2px\",\r\n              boxShadow: isCurrentRow ? 3 : 0,\r\n              transform: isCurrentRow ? `scale(1.03)` : `scale(1)`,\r\n              ...isCurrentRow && { backgroundColor: theme.palette.background.default },\r\n\r\n              ...isCurrentRow && (currentBlockType !== \"unstyled\") && { transform: `scale(1)` },\r\n              //backgroundColor: isCurrentRow ? \"wheat\" : \"transparent\",\r\n              transition: \"box-shadow, background-color, transform, 300ms\",\r\n\r\n              position: \"relative\",\r\n              zIndex: isCurrentRow ? 100 : 0,\r\n              display: \"flex\",\r\n              alignItems: \"center\",\r\n              ...(theme.palette.mode === \"dark\") && isCurrentRow && {\r\n                //   backgroundColor:\"\"\r\n                backgroundColor: \"rgba(80, 80, 80, 1)\"\r\n                //   borderWidth: 1,\r\n                //   borderStyle: \"solid\",\r\n                //    boxSizing: \"border-box\",\r\n              }\r\n\r\n\r\n            }}\r\n          >\r\n            <IconButton sx={{\r\n              fontSize: \"2rem\", width: \"2.5rem\", height: \"2.5rem\", position: \"absolute\",\r\n              ...(blockType === \"rightBlock\") ? { left: 0 } : { right: 0 },\r\n              opacity: (isCurrentRow && !Boolean(currentBlockText) && (imageBlockNum < 3) && (blockType !== \"imageBlock\") && (blockType !== \"voteBlock\")) ? 1 : 0,\r\n              transform: (isCurrentRow && !Boolean(currentBlockText) && (imageBlockNum < 3) && (blockType !== \"imageBlock\") && (blockType !== \"voteBlock\")) ? \"scale(1)\" : \"scale(0)\",\r\n              transition: \"opacity, 300ms\"\r\n              // backgroundColor: \"pink\"\r\n\r\n            }}\r\n              size=\"small\"\r\n\r\n              contentEditable={false} suppressContentEditableWarning={true}\r\n              onClick={function () {\r\n                // setEmojiIndex(index)\r\n                markingImageBlock(blockKey)\r\n              }}\r\n            >\r\n              <ImageOutlined fontSize=\"large\" />\r\n            </IconButton>\r\n\r\n            <IconButton sx={{\r\n              fontSize: \"2rem\", width: \"2.5rem\", height: \"2.5rem\", position: \"absolute\",\r\n              ...(blockType === \"rightBlock\") ? { left: 0 } : { right: 0 },\r\n              opacity: (isCurrentRow && !Boolean(currentBlockText) && (blockType !== \"imageBlock\") && (blockType !== \"voteBlock\")) ? 1 : 0,\r\n              transform: (isCurrentRow && !Boolean(currentBlockText) && (blockType !== \"imageBlock\") && (blockType !== \"voteBlock\"))\r\n                ? `scale(1) translateX(${blockType === \"rightBlock\" ? \"100%\" : \"-100%\"})`\r\n                : `scale(0)`,\r\n              transition: \"opacity, 300ms\",\r\n              ...hasVoteBlock && { transform: \"scale(0)\" }\r\n\r\n              // backgroundColor: \"pink\"\r\n\r\n            }}\r\n              size=\"small\"\r\n\r\n              contentEditable={false} suppressContentEditableWarning={true}\r\n              onClick={function () {\r\n                // setEmojiIndex(index)\r\n                //markingImageBlock(blockKey)\r\n                markingVoteBlock(blockKey)\r\n              }}\r\n            >\r\n              <StackedBarChart fontSize=\"large\" sx={{ transform: \"rotate(90deg) scaleX(-1)\" }} />\r\n            </IconButton>\r\n\r\n\r\n            {block}\r\n          </Box>\r\n        )\r\n\r\n      })}\r\n\r\n    </>\r\n  )\r\n\r\n}\r\n\r\n\r\n","import { stateToHTML } from 'draft-js-export-html';\r\n\r\nimport useMediaQuery from '@mui/material/useMediaQuery';\r\n\r\nimport { ThemeProvider, useTheme, createTheme, styled } from '@mui/material/styles';\r\nimport {\r\n  red, pink, purple, deepPurple, indigo,\r\n  blue, lightBlue, cyan, teal, green,\r\n  lightGreen, lime, yellow, amber, orange,\r\n  deepOrange, brown, grey, blueGrey\r\n} from '@mui/material/colors';\r\nimport multiavatar from \"@multiavatar/multiavatar\";\r\n\r\n//export const url = \"http://192.168.0.100\";\r\n\r\n//export const url = \"https://passport-js.herokuapp.com\";\r\n\r\n\r\n\r\nexport let url = process.env.NODE_ENV === \"development\" ? \"http://192.168.0.100\" : \"\";\r\n\r\n\r\n\r\n\r\nexport const colorArr = [red, pink, purple, deepPurple, indigo,\r\n  blue, lightBlue, cyan, teal, green,\r\n  lightGreen, lime, yellow, amber, orange,\r\n  deepOrange, brown, grey, blueGrey]\r\n\r\nexport const colorIndexArr = [\"red\", \"pink\", \"purple\", \"deepPurple\", \"indigo\",\r\n  \"blue\", \"lightBlue\", \"cyan\", \"teal\", \"green\",\r\n  \"lightGreen\", \"lime\", \"yellow\", \"amber\", \"orange\",\r\n  \"deepOrange\", \"brown\", \"grey\", \"blueGrey\"]\r\n\r\n\r\nexport function toPreHtml(editorState, theme) {\r\n\r\n  const preHtml = stateToHTML(\r\n    editorState.getCurrentContent(),\r\n    {\r\n      defaultBlockTag: \"div\",\r\n\r\n\r\n\r\n      inlineStyleFn: function (styleNameSet) {\r\n\r\n        const styleObj = {\r\n\r\n          element: \"span\",\r\n          style: {},\r\n          attributes: {}\r\n\r\n        }\r\n\r\n\r\n        if (styleNameSet.toArray().includes(\"linkTagOn\")) {\r\n          //  styleObj.style = { color: blue[800] }\r\n          styleObj.attributes[\"data-type\"] = \"link\"\r\n        }\r\n        if (styleNameSet.toArray().includes(\"linkTagOff\")) {\r\n          //    styleObj.style = { color: blue[800] }\r\n          styleObj.attributes[\"data-type\"] = \"link\"\r\n        }\r\n\r\n\r\n\r\n        return styleObj\r\n\r\n      },\r\n\r\n\r\n      entityStyleFn: function (entity) {\r\n        const { type, data, mutablity } = entity.toObject()\r\n\r\n        //  console.log(type, data, mutablity)\r\n\r\n        if (type.indexOf(\"mention\") >= 0) {\r\n          return {\r\n            element: 'object',\r\n            attributes: {\r\n              \"data-type\": \"mention-tag\"\r\n            },\r\n\r\n          }\r\n        }\r\n        else if (type.indexOf(\"personTag\") >= 0) {\r\n          return {\r\n            element: 'object',\r\n            attributes: {\r\n              \"data-type\": \"person-tag\"\r\n            },\r\n\r\n          }\r\n\r\n        }\r\n\r\n      },\r\n\r\n      blockStyleFn: function (block) {\r\n\r\n        const text = block.getText()\r\n        const data = block.getData().toObject()\r\n        const type = block.getType()\r\n        const key = block.getKey()\r\n\r\n        return {\r\n          style: {\r\n            ...(type === \"centerBlock\") && { textAlign: \"center\" },  // style will be a string not an object during toHtmll call\r\n            ...(type === \"rightBlock\") && { textAlign: \"right\" },\r\n\r\n\r\n            // ...(data.isSmallFont&&type===\"rightBlock\")&&{transform:\"translateX(10%) scale(0.8) \",backgroundColor:\"pink\",lineHeight:1},\r\n            // ...(data.isSmallFont&&type===\"unstyled\")&&{transform:\"translateX(-10%) scale(0.8) \",backgroundColor:\"pink\",lineHeight:1},\r\n            // ...(data.isSmallFont&&type===\"centerBlock\")&&{transform:\"scale(0.8) \",backgroundColor:\"pink\",lineHeight:1},\r\n\r\n            // ...styleObj.centerBlock && { textAlign: \"center\" },\r\n            // ...styleObj.rightBlock && { textAlign: \"right\" }\r\n\r\n          },\r\n          attributes: {\r\n            ...data.isSmallFont && { \"small-font\": \"small-font\" },\r\n            ...(type === \"centerBlock\") && { \"text-align\": \"center\" },\r\n            ...(type === \"rightBlock\") && { \"text-align\": \"right\" },\r\n\r\n            // ...styleObj.centerBlock && { className: \"text-center\" },\r\n            // ...styleObj.rightBlock && { className: \"text-right\" }\r\n          }\r\n        }\r\n\r\n\r\n      },\r\n\r\n\r\n      blockRenderers: {\r\n\r\n\r\n\r\n\r\n        imageBlock: function (block) {\r\n          const text = block.getText()\r\n          const data = escape(JSON.stringify(block.getData().toObject()))\r\n          //  console.log(JSON.stringify(block.getData().toObject()))\r\n\r\n          //const data = block.getData().toObject()\r\n\r\n          const type = block.getType()\r\n          const key = block.getKey()\r\n          return `<object  data-type=\"image-block\"  data-block_key=\"${key}\" data-block_data=\"${data}\" >` + escape(block.getText()) + '</object>'\r\n        },\r\n\r\n        voteBlock: function (block) {\r\n          const data = escape(JSON.stringify({ ...block.getData().toObject() }))\r\n          const type = block.getType()\r\n          const key = block.getKey()\r\n          return `<object  data-type=\"vote-block\"  data-block_key=\"${key}\" data-block_data=\"${data}\" >` + escape(block.getText()) + '</object>'\r\n        },\r\n\r\n\r\n\r\n      },\r\n\r\n    }\r\n  )\r\n  return preHtml\r\n}\r\n\r\n\r\nexport function hexify(color) {\r\n  var values = color\r\n    .replace(/rgba?\\(/, '')\r\n    .replace(/\\)/, '')\r\n    .replace(/[\\s+]/g, '')\r\n    .split(',');\r\n  var a = parseFloat(values[3] || 1),\r\n    r = Math.floor(a * parseInt(values[0]) + (1 - a) * 255),\r\n    g = Math.floor(a * parseInt(values[1]) + (1 - a) * 255),\r\n    b = Math.floor(a * parseInt(values[2]) + (1 - a) * 255);\r\n  return \"#\" +\r\n    (\"0\" + r.toString(16)).slice(-2) +\r\n    (\"0\" + g.toString(16)).slice(-2) +\r\n    (\"0\" + b.toString(16)).slice(-2);\r\n}\r\n\r\nexport function hexToRGB(hex, alpha) {\r\n  var r = parseInt(hex.slice(1, 3), 16),\r\n    g = parseInt(hex.slice(3, 5), 16),\r\n    b = parseInt(hex.slice(5, 7), 16);\r\n\r\n  if (alpha) {\r\n    return hexify(\"rgba(\" + r + \", \" + g + \", \" + b + \", \" + alpha + \")\");\r\n  } else {\r\n    return hexify(\"rgb(\" + r + \", \" + g + \", \" + b + \")\");\r\n  }\r\n}\r\n\r\nexport function hexToRGB2(hex, alpha) {\r\n  var r = parseInt(hex.slice(1, 3), 16),\r\n    g = parseInt(hex.slice(3, 5), 16),\r\n    b = parseInt(hex.slice(5, 7), 16);\r\n\r\n  if (alpha) {\r\n    return \"rgba(\" + r + \", \" + g + \", \" + b + \", \" + alpha + \")\";\r\n  } else {\r\n    return \"rgb(\" + r + \", \" + g + \", \" + b + \")\";\r\n  }\r\n}\r\n\r\n\r\nexport function useScreenState() {\r\n  const theme = useTheme()\r\n\r\n  const xs = useMediaQuery(theme.breakpoints.only(\"xs\"))\r\n  const sm = useMediaQuery(theme.breakpoints.only(\"sm\"))\r\n  const md = useMediaQuery(theme.breakpoints.only(\"md\"))\r\n  const lg = useMediaQuery(theme.breakpoints.only(\"lg\"))\r\n  const xl = useMediaQuery(theme.breakpoints.only(\"xl\"))\r\n  return [\"xs\", \"sm\", \"md\", \"lg\", \"xl\"][[xs, sm, md, lg, xl].indexOf(true)]\r\n\r\n}\r\n\r\n\r\nexport function uniqByKeepFirst(a, key) {\r\n  let seen = new Set();\r\n  return a.filter(item => {\r\n    let k = key(item);\r\n    return seen.has(k) ? false : seen.add(k);\r\n  });\r\n}\r\n\r\nexport function getColor({ name, userName, userInfoArr, userColor, theme }) {\r\n\r\n\r\n\r\n  const avatarString = multiavatar(name)\r\n  let avatarColor = \"\"\r\n  let colorItem = \"\"\r\n\r\n  if (!userColor && (userName === name)) {\r\n\r\n    let colorItem = avatarString.match(/#[a-zA-z0-9]*/)[0]\r\n    if (colorItem.length < 7) {\r\n      colorItem = \"#\" + colorItem[1] + colorItem[1] + colorItem[2] + colorItem[2] + colorItem[3] + colorItem[3]\r\n    }\r\n    avatarColor = theme.isLight ? hexToRGB(colorItem, 0.4) : hexToRGB2(colorItem, 0.6)\r\n  }\r\n  else if (userColor && (userName === name)) {\r\n    const colorItem = colorArr[colorIndexArr.findIndex(item => item === userColor)]\r\n    avatarColor = theme.isLight ? colorItem[100] : hexToRGB2(colorItem[500], 0.5)\r\n  }\r\n  else if (userName !== name) {\r\n\r\n    const colorName = userInfoArr.find(userItem => userItem.userName === name)?.colorName\r\n    let colorItem = \"\"\r\n    if (colorName) {\r\n      colorItem = colorArr[colorIndexArr.findIndex(item => item === colorName)]\r\n      avatarColor = theme.isLight ? colorItem[100] : hexToRGB2(colorItem[500], 0.5)\r\n    }\r\n    else {\r\n      let colorItem = avatarString.match(/#[a-zA-z0-9]*/)[0]\r\n      if (colorItem.length < 7) {\r\n        colorItem = \"#\" + colorItem[1] + colorItem[1] + colorItem[2] + colorItem[2] + colorItem[3] + colorItem[3]\r\n      }\r\n      avatarColor = theme.isLight ? hexToRGB(colorItem, 0.4) : hexToRGB2(colorItem, 0.6)\r\n    }\r\n  }\r\n\r\n  return avatarColor\r\n\r\n}\r\n\r\n\r\nexport function getColor3({ name, userName, userInfoArr, userColor, theme }) {\r\n\r\n\r\n\r\n  const avatarString = multiavatar(name)\r\n  let avatarColor = \"\"\r\n  let colorItem = \"\"\r\n\r\n  if (!userColor && (userName === name)) {\r\n\r\n    let colorItem = avatarString.match(/#[a-zA-z0-9]*/)[0]\r\n    if (colorItem.length < 7) {\r\n      colorItem = \"#\" + colorItem[1] + colorItem[1] + colorItem[2] + colorItem[2] + colorItem[3] + colorItem[3]\r\n    }\r\n    avatarColor = theme.isLight ? hexToRGB(colorItem, 1) : hexToRGB2(colorItem, 1)\r\n  }\r\n  else if (userColor && (userName === name)) {\r\n    const colorItem = colorArr[colorIndexArr.findIndex(item => item === userColor)]\r\n    // avatarColor = theme.isLight ? colorItem[100] : colorItem[900]\r\n    avatarColor = theme.isLight ? hexToRGB(colorItem[500], 0.5) : hexToRGB2(colorItem[500], 0.5)\r\n  }\r\n  else if (userName !== name) {\r\n\r\n    const colorName = userInfoArr.find(userItem => userItem.userName === name)?.colorName\r\n    let colorItem = \"\"\r\n    if (colorName) {\r\n      colorItem = colorArr[colorIndexArr.findIndex(item => item === colorName)]\r\n      // avatarColor = theme.isLight ? colorItem[100] : colorItem[900]\r\n      avatarColor = theme.isLight ? hexToRGB(colorItem[500], 0.5) : hexToRGB2(colorItem[500], 0.5)\r\n    }\r\n    else {\r\n      let colorItem = avatarString.match(/#[a-zA-z0-9]*/)[0]\r\n      if (colorItem.length < 7) {\r\n        colorItem = \"#\" + colorItem[1] + colorItem[1] + colorItem[2] + colorItem[2] + colorItem[3] + colorItem[3]\r\n      }\r\n      avatarColor = theme.isLight ? hexToRGB(colorItem, 1) : hexToRGB2(colorItem, 1)\r\n    }\r\n  }\r\n\r\n  return avatarColor\r\n\r\n}\r\n\r\n\r\nexport function getColor2({ name, userName, userInfoArr, userColor, theme }) {\r\n\r\n\r\n\r\n  const avatarString = multiavatar(name)\r\n  let avatarColor = \"\"\r\n  let colorItem = \"\"\r\n\r\n  if (!userColor && (userName === name)) {\r\n\r\n    let colorItem = avatarString.match(/#[a-zA-z0-9]*/)[0]\r\n    if (colorItem.length < 7) {\r\n      colorItem = \"#\" + colorItem[1] + colorItem[1] + colorItem[2] + colorItem[2] + colorItem[3] + colorItem[3]\r\n    }\r\n    avatarColor = theme.isLight ? hexToRGB(colorItem, 0.1) : hexToRGB2(colorItem, 0.4)\r\n  }\r\n  else if (userColor && (userName === name)) {\r\n    const colorItem = colorArr[colorIndexArr.findIndex(item => item === userColor)]\r\n    avatarColor = theme.isLight ? hexToRGB2(colorItem[500], 0.1) : hexToRGB2(colorItem[500], 0.4)\r\n  }\r\n  else if (userName !== name) {\r\n\r\n    const colorName = userInfoArr.find(userItem => userItem.userName === name)?.colorName\r\n    let colorItem = \"\"\r\n    if (colorName) {\r\n      colorItem = colorArr[colorIndexArr.findIndex(item => item === colorName)]\r\n      avatarColor = theme.isLight ? hexToRGB2(colorItem[500], 0.1) : hexToRGB2(colorItem[500], 0.4)\r\n    }\r\n    else {\r\n      let colorItem = avatarString.match(/#[a-zA-z0-9]*/)[0]\r\n      if (colorItem.length < 7) {\r\n        colorItem = \"#\" + colorItem[1] + colorItem[1] + colorItem[2] + colorItem[2] + colorItem[3] + colorItem[3]\r\n      }\r\n      avatarColor = theme.isLight ? hexToRGB(colorItem, 0.1) : hexToRGB2(colorItem, 0.4)\r\n    }\r\n  }\r\n\r\n  return avatarColor\r\n\r\n}\r\n\r\nexport function getColor4({ name, userName, userInfoArr, userColor, theme }) {\r\n\r\n\r\n\r\n  const avatarString = multiavatar(name)\r\n  let avatarColor = \"\"\r\n  let colorItem = \"\"\r\n\r\n  if (!userColor && (userName === name)) {\r\n\r\n    let colorItem = avatarString.match(/#[a-zA-z0-9]*/)[0]\r\n    if (colorItem.length < 7) {\r\n      colorItem = \"#\" + colorItem[1] + colorItem[1] + colorItem[2] + colorItem[2] + colorItem[3] + colorItem[3]\r\n    }\r\n    avatarColor = theme.isLight ? hexToRGB(colorItem, 0.2) : hexToRGB2(colorItem, 0.4)\r\n  }\r\n  else if (userColor && (userName === name)) {\r\n    const colorItem = colorArr[colorIndexArr.findIndex(item => item === userColor)]\r\n    avatarColor = theme.isLight ? hexToRGB2(colorItem[900], 0.2) : hexToRGB2(colorItem[500], 0.2)\r\n  }\r\n  else if (userName !== name) {\r\n\r\n    const colorName = userInfoArr.find(userItem => userItem.userName === name)?.colorName\r\n    let colorItem = \"\"\r\n    if (colorName) {\r\n      colorItem = colorArr[colorIndexArr.findIndex(item => item === colorName)]\r\n      avatarColor = theme.isLight ? hexToRGB2(colorItem[900], 0.2) : hexToRGB2(colorItem[500], 0.2)\r\n    }\r\n    else {\r\n      let colorItem = avatarString.match(/#[a-zA-z0-9]*/)[0]\r\n      if (colorItem.length < 7) {\r\n        colorItem = \"#\" + colorItem[1] + colorItem[1] + colorItem[2] + colorItem[2] + colorItem[3] + colorItem[3]\r\n      }\r\n      avatarColor = theme.isLight ? hexToRGB(colorItem, 0.2) : hexToRGB2(colorItem, 0.4)\r\n    }\r\n  }\r\n\r\n  return avatarColor\r\n\r\n}\r\n","import React, { createContext, useEffect, useState, useReducer, useRef, useMemo, useCallback, useLayoutEffect, useContext, Component } from 'react';\r\n\r\nimport { EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, AtomicBlockUtils } from 'draft-js';\r\n\r\nimport { stateToHTML } from 'draft-js-export-html';\r\nimport ReactHtmlParser, { processNodes, convertNodeToElement, htmlparser2, } from 'react-html-parser';\r\nimport reactElementToJSXString from 'react-element-to-jsx-string';\r\n\r\n\r\nimport { ThemeProvider, useTheme, createTheme, styled, } from '@mui/material/styles';\r\n\r\nimport Immutable from \"immutable\"\r\n\r\nimport { AvatarChip } from \"./PeopleList\"\r\n\r\nimport { Container, Grid, Paper, Typography, Box, Chip, Avatar, Link, Button, LinearProgress, Stack, IconButton, Divider, Collapse } from '@mui/material';\r\nimport {\r\n  EmojiEmotions, FormatSize, FormatAlignLeft, FormatAlignCenter, FormatAlignRight, StackedBarChart, HorizontalSplitOutlined,\r\n  ChatBubbleOutline, Reply, MoreHoriz, Edit, BubbleChart, DeleteOutline\r\n} from '@mui/icons-material';\r\n\r\nimport { blue, red, grey } from '@mui/material/colors';\r\n\r\nimport axios from \"axios\";\r\nimport { url, toPreHtml, hexToRGB, hexToRGB2, useScreenState, colorArr, colorIndexArr,getColor2,getColor4 } from \"./config\";\r\nimport { compareAsc, format, formatDistanceToNow } from 'date-fns';\r\nimport { zhCN } from \"date-fns/locale\";\r\nimport Countdown from \"react-countdown\";\r\nimport multiavatar from \"@multiavatar/multiavatar\";\r\nimport useAppContext from './useAppContext';\r\n//import { ContextProvider as EditorCtx, useEditorState } from \"./ContextProvider\";\r\nimport { SimpleDraftProvider } from './ContextProvider';\r\n\r\nimport {\r\n  BrowserRouter, Route, Routes, useRoutes, Link as LinkRoute, useParams, matchPath, useLocation, useNavigate\r\n\r\n} from \"react-router-dom\";\r\n\r\n\r\n\r\n\r\nexport default function CommentSector({ item, /*avatarColor,*/ toHtml, PostingTime, commentCount, setCommentCount, preHtmlEditor, ...props }) {\r\n\r\n  const location = useLocation()\r\n  const isPersonPage = Boolean(matchPath(\"/person/:personName\", location.pathname))\r\n\r\n\r\n\r\n  const { setNeedReduceArr, postArr } = useAppContext()\r\n  const theme = useTheme()\r\n  const { content, postID, ownerName, postingTime, } = item\r\n  const { userName, userInfoArr, userColor } = useAppContext()\r\n\r\n  const avatarColor = getColor2({ name: ownerName, userName, userInfoArr, userColor, theme })\r\n  const bgcolor = getColor4({ name: ownerName, userName, userInfoArr, userColor, theme })\r\n\r\n\r\n  const [commentArr, setCommentArr] = useState([])\r\n\r\n  const loadComments = useCallback(function () {\r\n    const beforeTime = commentArr.length > 0 ? commentArr[commentArr.length - 1].postingTime : \"\"\r\n\r\n    axios.get(`${url}/api/comment/${postID}/${beforeTime}`)\r\n      .then(response => {\r\n\r\n        // console.log(response.data)\r\n        setCommentArr(pre => {\r\n          return uniqByKeepFirst([...pre, ...response.data], function (item) { return item.commentID })\r\n        })\r\n      })\r\n\r\n  }, [commentArr])\r\n\r\n\r\n  // useEffect(function () {\r\n  //  alert(newKey)\r\n  // }, [newKey])\r\n\r\n\r\n\r\n  useEffect(function () {\r\n    loadComments()\r\n  }, [])\r\n\r\n  const addOneSubComment = useCallback(function (commentID) {\r\n    setCommentArr(pre => {\r\n      const comment = pre.find(item => item.commentID === commentID)\r\n      comment.subCommentNum = comment.subCommentNum ? (comment.subCommentNum + 1) : 1\r\n      return [...pre]\r\n    })\r\n\r\n\r\n\r\n  }, [commentArr])\r\n\r\n\r\n  const minusOneSubComment = useCallback(function (commentID) {\r\n    setCommentArr(pre => {\r\n      const comment = pre.find(item => item.commentID === commentID)\r\n      comment.subCommentNum = comment.subCommentNum ? (comment.subCommentNum - 1) : 0\r\n      return [...pre]\r\n    })\r\n  }, [commentArr])\r\n\r\n  const deleteComment = function (commentID) {\r\n\r\n\r\n    setCommentArr(pre => {\r\n      return pre.filter(comment => comment.commentID !== commentID)\r\n    })\r\n\r\n  }\r\n\r\n  const [incomingSubComment, setIncomingSubComment] = useState(\"\")\r\n\r\n  useEffect(function () {\r\n\r\n    if (preHtmlEditor?.content) {\r\n      setCommentArr(pre => {\r\n        return uniqByKeepFirst([preHtmlEditor, ...pre], function (item) { return item.commentID })\r\n      })\r\n    }\r\n\r\n  }, [preHtmlEditor])\r\n\r\n\r\n\r\n  const [tabIndex, setTabIndex] = useState(999)\r\n  const [unmountEditor, setUnmountEditor] = useState(true)\r\n\r\n\r\n  const [commentIDSet, setCommentIDSet] = useState(new Set())\r\n\r\n\r\n\r\n  //name, userName, userInfoArr, userColor,theme\r\n\r\n\r\n\r\n  return (\r\n    <Box className=\"comment-sector\"\r\n      sx={{\r\n        display: \"relative\",\r\n        //  bgcolor: theme.isLight ? hexToRGB2(avatarColor, 0.1) : hexToRGB2(avatarColor, 0.4),\r\n        bgcolor: avatarColor\r\n      }}\r\n    >\r\n\r\n\r\n      <Box sx={{\r\n\r\n\r\n\r\n        paddingLeft: \"4px\", paddingRight: \"4px\",\r\n\r\n        display: \"relative\",\r\n        ...(commentArr.length > 0) && { paddingBottom: \"4px\", \"& .bar:first-of-type\": { paddingTop: \"4px\" } },\r\n        //    bgcolor: theme.isLight ? hexToRGB2(avatarColor, 0.1) : hexToRGB2(avatarColor, 0.4),\r\n      }}>\r\n\r\n\r\n\r\n        {/* <SimpleDraftProvider postID={postID} userName={userName} /> */}\r\n\r\n\r\n        {commentArr.map((comment, index) => {\r\n          const { commentID, content, ownerName, postingTime, subCommentNum } = comment\r\n\r\n\r\n\r\n          return (\r\n            <React.Fragment key={commentID}>\r\n              <Divider sx={{ marginBottom: \"4px\", ...(index === 0) && { display: \"none\" } }} />\r\n              <Box className=\"bar\" sx={{ display: \"flex\", alignItems: \"center\", justifyContent: \"space-between\", marginBottom: \"0px\" }}>\r\n\r\n\r\n                <Box sx={{ display: \"flex\", alignItems: \"center\", marginBottom: \"4px\" }}>\r\n                  <AvatarChip name={ownerName} avatarScale={1.2} textScale={0.8} boxShadow={0} title={true} />\r\n                  <PostingTime postingTime={postingTime} />\r\n\r\n                </Box>\r\n\r\n                <Box sx={{ display: \"flex\", alignItems: \"center\" }}>\r\n                  <IconButton size=\"small\" onClick={function () {\r\n                    setTabIndex(pre => { return pre === index ? 999 : index })\r\n                    setUnmountEditor(false)\r\n                  }}>\r\n                    <Reply fontSize='medium' />\r\n                  </IconButton>\r\n\r\n                  <IconButton size=\"small\"\r\n                    sx={{ ...(userName !== ownerName) && { display: \"none\" } }}\r\n\r\n                    onClick={function () {\r\n                      axios.post(`${url}/api/comment/delete`, { commentID }).then(response => {\r\n                        console.log(response.data)\r\n                        deleteComment(commentID)\r\n                        setCommentCount(pre => { return Math.max(0, pre - 1) })\r\n\r\n                        if (postArr.length > 0) {\r\n                          isPersonPage && setNeedReduceArr(pre => {\r\n\r\n                            return [...pre, postID]\r\n\r\n                          })\r\n                        }\r\n                      })\r\n                    }}>\r\n                    <DeleteOutline fontSize='medium' />\r\n                  </IconButton>\r\n\r\n                  <IconButton size=\"small\"\r\n                    onClick={function () {\r\n\r\n                      setCommentIDSet(pre => {\r\n\r\n                        pre.has(commentID)\r\n                          ? pre.delete(commentID)\r\n                          : pre.add(commentID)\r\n\r\n                        return new Set([...pre])\r\n                      })\r\n\r\n                    }}\r\n                  >\r\n                    <ChatBubbleOutline fontSize='medium' />\r\n                    <Typography sx={{ fontSize: \"1rem !important\", color: theme.palette.text.secondary }}>&nbsp;{subCommentNum || 0}</Typography>\r\n                  </IconButton>\r\n\r\n\r\n\r\n\r\n                </Box>\r\n              </Box>\r\n\r\n\r\n\r\n              <Box sx={{\r\n                marginLeft: theme.scaleSizeObj(0),\r\n                //  bgcolor,\r\n                bgcolor: \"transparent\",\r\n                // bgcolor:theme.palette.divider\r\n                boxShadow: 0,\r\n                marginBottom: \"4px\",\r\n                paddingLeft: \"4px\",\r\n                paddingRight: \"4px\",\r\n                flexGrow: 1,\r\n              }}>\r\n                {toHtml(content, { theme })}\r\n              </Box>\r\n\r\n\r\n\r\n\r\n              <Collapse in={tabIndex === index} unmountOnExit={unmountEditor}>\r\n                <Box sx={{\r\n                  borderRadius: \"4px\", overflow: \"visible\", marginTop: \"0px\", marginBottom: \"4px\",\r\n                  //    marginLeft: theme.scaleSizeObj(1.2),\r\n                }}>\r\n                  <SimpleDraftProvider postID={postID} userName={userName} subCommentEditor={true} commentID={commentID}\r\n                    openEditor={tabIndex === index}\r\n                    onSubmit={function (newSubComment) {\r\n\r\n                      console.log(newSubComment)\r\n\r\n                      setTabIndex(999)\r\n\r\n                      setIncomingSubComment(newSubComment)\r\n\r\n                      setCommentIDSet(pre => {\r\n                        pre.add(commentID)\r\n                        return new Set([...pre])\r\n                      })\r\n\r\n                      addOneSubComment(commentID)\r\n                    }}\r\n\r\n                  />\r\n                </Box>\r\n              </Collapse>\r\n\r\n\r\n\r\n              <Collapse unmountOnExit={false} in={commentIDSet.has(commentID)}>\r\n                <SubCommentSector commentID={commentID} PostingTime={PostingTime} toHtml={toHtml} bgcolor={bgcolor}\r\n                  incomingSubComment={incomingSubComment}\r\n                  setIncomingSubComment={setIncomingSubComment}\r\n                  subCommentNum={subCommentNum}\r\n                  minusOneSubComment={minusOneSubComment}\r\n                  userName={userName}\r\n                />\r\n              </Collapse>\r\n\r\n\r\n\r\n\r\n\r\n\r\n            </React.Fragment>\r\n\r\n          )\r\n\r\n        })\r\n\r\n        }\r\n\r\n        {(commentArr.length < commentCount) && <Button variant='clear' fullWidth={true} sx={{ color: theme.palette.text.secondary }} onClick={loadComments} >\r\n          Comments {commentArr.length}/{commentCount}\r\n        </Button>\r\n        }\r\n      </Box>\r\n\r\n\r\n    </Box>\r\n  )\r\n}\r\n\r\nfunction SubCommentSector({ commentID, userName, PostingTime, toHtml, bgcolor, incomingSubComment, setIncomingSubComment, subCommentNum, minusOneSubComment, ...props }) {\r\n\r\n  const theme = useTheme()\r\n  const [subCommentArr, setSubCommentArr] = useState([])\r\n\r\n  const loadSubComments = useCallback(function () {\r\n    const beforeTime = subCommentArr.length > 0 ? subCommentArr[subCommentArr.length - 1].postingTime : \"\"\r\n\r\n    axios.get(`${url}/api/subComment/${commentID}/${beforeTime}`)\r\n      .then(response => {\r\n\r\n        //   console.log(response.data)\r\n        setSubCommentArr(pre => {\r\n          return uniqByKeepFirst([...pre, ...response.data], function (item) { return item.subCommentID })\r\n        })\r\n      })\r\n\r\n  }, [subCommentArr])\r\n\r\n  function deleteSubComment(subCommentID) {\r\n\r\n\r\n    setSubCommentArr(pre => {\r\n      return pre.filter((item) => item.subCommentID !== subCommentID)\r\n    })\r\n\r\n  }\r\n\r\n\r\n  useEffect(function () {\r\n    loadSubComments()\r\n  }, [])\r\n\r\n\r\n  useEffect(function () {\r\n    if ((incomingSubComment) && (incomingSubComment?.commentID === commentID)) {\r\n      setSubCommentArr(pre => {\r\n        return uniqByKeepFirst([incomingSubComment, ...pre], function (item) { return item.subCommentID })\r\n      })\r\n      setIncomingSubComment(\"\")\r\n    }\r\n  }, [incomingSubComment])\r\n\r\n\r\n  return (\r\n    <>\r\n      {subCommentArr.map(subComment => {\r\n        const { subCommentID, content, ownerName, postingTime, commentID } = subComment;\r\n\r\n\r\n        return (\r\n          <Paper\r\n            key={subCommentID}\r\n            sx={{\r\n              //   marginLeft: theme.scaleSizeObj(1.2),\r\n              bgcolor,\r\n              boxShadow: 0,\r\n              marginBottom: \"4px\",\r\n              paddingLeft: \"4px\",\r\n              paddingRight: \"4px\",\r\n            }}>\r\n            <Box sx={{ display: \"flex\", alignItems: \"center\", paddingTop: \"2px\", paddingBottom: \"2px\" }}>\r\n              <Box sx={{ flexGrow: 1, display: \"flex\", alignItems: \"center\" }}>\r\n                <AvatarChip name={ownerName} avatarScale={1.2} textScale={0.8} boxShadow={0} title={true} />\r\n                <PostingTime postingTime={postingTime} />\r\n              </Box>\r\n              <IconButton size=\"small\" sx={{\r\n                ...(ownerName !== userName) && { display: \"none\" }\r\n\r\n              }} onClick={function () {\r\n                axios.post(`${url}/api/subComment/delete`, { subCommentID }).then(response => {\r\n                  //console.log(response.data)\r\n                  deleteSubComment(subCommentID)\r\n                  minusOneSubComment(commentID)\r\n                  //    setCommentCount(pre => Math.max(0, pre - 1))\r\n                })\r\n              }}>\r\n                <DeleteOutline fontSize='medium' />\r\n              </IconButton>\r\n\r\n\r\n\r\n            </Box>\r\n            {/* <Divider /> */}\r\n            {toHtml(content, { theme })}\r\n          </Paper>\r\n        )\r\n\r\n\r\n      })}\r\n      <Button variant='clear' fullWidth={true} sx={{\r\n        color: theme.palette.text.secondary,\r\n        textTransform: \"none\",\r\n        ...(subCommentArr.length >= (subCommentNum)) && { display: \"none\" }\r\n      }}\r\n        onClick={function () {\r\n\r\n          loadSubComments()\r\n\r\n        }}\r\n      >\r\n        <MoreHoriz fontSize='medium' />{subCommentArr.length}/{subCommentNum}\r\n      </Button>\r\n\r\n\r\n\r\n    </>\r\n\r\n\r\n\r\n\r\n\r\n  )\r\n\r\n\r\n}\r\n\r\n\r\n\r\nfunction uniqByKeepFirst(a, key) {\r\n  let seen = new Set();\r\n  return a.filter(item => {\r\n    let k = key(item);\r\n    return seen.has(k) ? false : seen.add(k);\r\n  });\r\n}\r\n\r\n\r\n\r\n","import React, { createContext, useEffect, useState, useReducer, useRef, useMemo, useCallback, useLayoutEffect, useContext, Component } from 'react';\r\n\r\nimport { EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, AtomicBlockUtils } from 'draft-js';\r\n\r\nimport { stateToHTML } from 'draft-js-export-html';\r\nimport ReactHtmlParser, { processNodes, convertNodeToElement, htmlparser2, } from 'react-html-parser';\r\nimport reactElementToJSXString from 'react-element-to-jsx-string';\r\n\r\n\r\nimport { ThemeProvider, useTheme, createTheme, styled, } from '@mui/material/styles';\r\n\r\nimport Immutable from \"immutable\"\r\n\r\nimport { AvatarChip } from \"./PeopleList\"\r\n\r\nimport {\r\n  Container, Grid, Paper, Typography, Box, Chip, Avatar, Link, Button, LinearProgress, Stack, IconButton, Divider, Collapse, Badge,\r\n\r\n  CircularProgress, Hidden\r\n} from '@mui/material';\r\nimport {\r\n  EmojiEmotions, FormatSize, FormatAlignLeft, FormatAlignCenter, FormatAlignRight, StackedBarChart, HorizontalSplitOutlined,\r\n  ChatBubbleOutline, Edit, DeleteOutline, OpenInFullOutlined, AspectRatioOutlined,\r\n} from '@mui/icons-material';\r\n\r\n\r\n\r\nimport Dialog from '@mui/material/Dialog';\r\nimport DialogActions from '@mui/material/DialogActions';\r\nimport DialogContent from '@mui/material/DialogContent';\r\nimport DialogContentText from '@mui/material/DialogContentText';\r\nimport DialogTitle from '@mui/material/DialogTitle';\r\n\r\nimport useResizeObserver from '@react-hook/resize-observer';\r\n\r\n\r\nimport { blue, red, grey } from '@mui/material/colors';\r\nimport Lightbox from 'react-image-lightbox';\r\nimport 'react-image-lightbox/style.css';\r\n\r\n\r\nimport axios from \"axios\";\r\nimport { url, toPreHtml, hexToRGB, hexToRGB2, useScreenState, uniqByKeepFirst, colorArr, colorIndexArr, getColor, getColor3 } from \"./config\";\r\nimport { compareAsc, format, formatDistanceToNow } from 'date-fns';\r\nimport { zhCN } from \"date-fns/locale\";\r\nimport Countdown from \"react-countdown\";\r\nimport multiavatar from \"@multiavatar/multiavatar\";\r\nimport useAppContext from './useAppContext';\r\n\r\nimport CommentSector from './CommentSector';\r\n\r\nimport Masonry from 'react-masonry-css';\r\nimport { SimpleDraftProvider } from './ContextProvider';\r\n\r\nimport { useInView } from 'react-intersection-observer';\r\n\r\n\r\n\r\nexport const ContentContext = createContext()\r\nfunction useContentContext() {\r\n\r\n  return useContext(ContentContext)\r\n\r\n\r\n}\r\n\r\n\r\n\r\nfunction toHtml(preHtml, { theme, target, size, setSize, avatarColor, postID, setLightBoxOn, ownerName }) {\r\n\r\n  // console.log(preHtml)\r\n\r\n  const allImageArr = []\r\n\r\n  return ReactHtmlParser(preHtml, {\r\n    transform: function transformFn(node, index) {\r\n\r\n      if (node.name === \"div\" && node.attribs[\"small-font\"]) {\r\n\r\n        const element = node.children.map((child, index) => {\r\n\r\n          if (child.name === \"object\" && child.attribs[\"data-type\"] === \"person-tag\") {\r\n\r\n            const avatarElement = convertNodeToElement(child)\r\n            const personName = reactElementToJSXString(<>{avatarElement}</>).replace(/(<([^>]*)>)/ig, '').replace(/\\s/g, '')\r\n\r\n            return <AvatarChip name={personName} key={index} avatarScale={0.8} textScale={0.8} boxShadow={0} />\r\n          }\r\n          else if (child.name === \"span\" && child.attribs[\"data-type\"] === \"link\") {\r\n            const element = convertNodeToElement(child)\r\n            const linkAdd = reactElementToJSXString(<>{element}</>).replace(/(<([^>]*)>)/ig, '').replace(/\\s/g, '')\r\n\r\n            // return <a href={linkAdd} style={{ color: blue[800], textDecoration:\"none\" }} >{linkAdd}</a >\r\n            return <LinkTag linkAdd={linkAdd} key={index} />\r\n          }\r\n\r\n          return convertNodeToElement(child, index, transformFn)\r\n        })\r\n\r\n        //  toHtml(reactElementToJSXString(<>{element}</>),theme,target)\r\n\r\n        //  console.log(reactElementToJSXString(<>{element}</>))\r\n\r\n\r\n        return <Box\r\n          key={index}\r\n          sx={{\r\n            fontSize: theme.scaleSizeObj(0.8),\r\n\r\n            ...(node.attribs[\"text-align\"]) && { textAlign: node.attribs[\"text-align\"] }\r\n          }} >\r\n          {/* {toHtml(reactElementToJSXString(<div>{element}</div>), theme, target)} */}\r\n          {element}\r\n        </Box>\r\n\r\n      }\r\n      else if (node.name === \"span\" && node.attribs[\"data-type\"] === \"link\") {\r\n        const element = convertNodeToElement(node)\r\n        const linkAdd = reactElementToJSXString(<>{element}</>).replace(/(<([^>]*)>)/ig, '').replace(/\\s/g, '')\r\n\r\n        // return <a href={linkAdd} style={{ color: blue[800], textDecoration:\"none\" }} >{linkAdd}</a >\r\n        return <LinkTag linkAdd={linkAdd} key={index} />\r\n      }\r\n      else if (node.name === \"object\" && node.attribs[\"data-type\"] === \"image-block\") {\r\n        // console.log(node.attribs[\"data-bgiamge\"], index)\r\n\r\n\r\n\r\n        const data = JSON.parse(unescape(node.attribs[\"data-block_data\"]))\r\n\r\n\r\n        if (data.imgDataArr) {\r\n          data.imgDataArr.forEach(img => {\r\n            //     console.log(img)\r\n            allImageArr.push(img)\r\n          })\r\n        }\r\n\r\n        // console.log(data)\r\n        // arr.push({ bg: node.attribs[\"data-bgiamge\"], row: index, node })\r\n        //  console.log(data)\r\n\r\n        if (Array.isArray(data.imgDataArr) && data.imgDataArr.length > 0) {\r\n          return <Images key={index} imgDataArr={data.imgDataArr} allImageArr={allImageArr} target={target} size={size} setSize={setSize} postID={postID}\r\n            setLightBoxOn={setLightBoxOn}\r\n\r\n          />\r\n        }\r\n        else {\r\n          return null\r\n        }\r\n\r\n      }\r\n      else if (node.name === \"object\" && node.attribs[\"data-type\"] === \"mention-tag\") {\r\n\r\n        const element = convertNodeToElement(node)\r\n        const personName = reactElementToJSXString(<>{element}</>).replace(/(<([^>]*)>)/ig, '').replace(/\\s/g, '')\r\n\r\n        return <Typography variant=\"body2\" key={index}\r\n          sx={{ display: \"inline\", }}\r\n        >{personName}</Typography>\r\n      }\r\n      else if (node.name === \"object\" && node.attribs[\"data-type\"] === \"person-tag\") {\r\n\r\n        const element = convertNodeToElement(node)\r\n        const personName = reactElementToJSXString(<>{element}</>).replace(/(<([^>]*)>)/ig, '').replace(/\\s/g, '')\r\n        return <AvatarChip name={personName} key={index} avatarScale={1.2} textScale={0.8} boxShadow={0} />\r\n      }\r\n      else if (node.name === \"object\" && node.attribs[\"data-type\"] === \"vote-block\") {\r\n\r\n        const data = node.attribs[\"data-block_data\"] ? JSON.parse(unescape(node.attribs[\"data-block_data\"])) : null\r\n        const blockKey = node.attribs[\"data-block_key\"]\r\n\r\n\r\n        //  console.log(data, blockKey)\r\n        return <VoteFrame data={data} blockKey={blockKey} avatarColor={avatarColor} postID={postID} key={index} ownerName={ownerName} />\r\n      }\r\n\r\n      //  return null\r\n    }\r\n  })\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\nexport default function Content({ ...props }) {\r\n\r\n  const theme = useTheme()\r\n  const { userName, savedPostArr, setSavedPostArr, postArr, setPostArr, } = useAppContext()\r\n\r\n  const [size, setSize] = useState()\r\n  const [dialogSize, setDialogSize] = useState()\r\n\r\n  const breakpointColumnsObj = {\r\n    [theme.breakpoints.values.xs]: 1,\r\n    [theme.breakpoints.values.sm]: 1,\r\n    [theme.breakpoints.values.md]: 2,\r\n    [theme.breakpoints.values.lg]: 3,\r\n    [theme.breakpoints.values.xl]: 4,\r\n    2000: 4, 3000: 5, 4000: 6, 5000: 7, 6000: 8, 7000: 9, 9999999: 10,\r\n  };\r\n\r\n  const [isFull, setIsFull] = useState(false)\r\n  const { ref, inView, entry } = useInView({\r\n    /* Optional options */\r\n    threshold: 0.8,\r\n    triggerOnce: false,\r\n    initialInView: true,\r\n    rootMargin: \"0px 0px 0px 0px\"\r\n  });\r\n\r\n\r\n\r\n\r\n  function getSinglePost() {\r\n\r\n    if (inView) {\r\n      const beforeTime = postArr.length > 0 ? postArr[postArr.length - 1].postingTime : \"\"\r\n\r\n\r\n      axios.get(`${url}/api/article/getOne/${beforeTime}`).then(response => {\r\n\r\n        response.data.length === 0\r\n          ? setIsFull(true)\r\n          : setPostArr(pre => { return uniqByKeepFirst([...pre, ...response.data], item => item.postID) })\r\n\r\n\r\n\r\n      })\r\n    }\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n  useEffect(function () {\r\n\r\n\r\n    if (inView && (!isFull)) {\r\n      getSinglePost()\r\n    }\r\n\r\n\r\n  }, [isFull, inView, postArr])\r\n\r\n\r\n  const [openIndex, setOpenIndex] = useState(-1);\r\n  const [lightBoxOn, setLightBoxOn] = useState(false)\r\n\r\n\r\n\r\n  return (\r\n    <ContentContext.Provider value={{ /*votedArr, setVotedArr, commentChangeArr, setCommentChangeArr*/ }}>\r\n      <Box sx={{\r\n        display: \"flex\",\r\n        justifyContent: \"center\",\r\n        fontSize: theme.sizeObj,\r\n        \"& p\": { fontSize: theme.sizeObj }\r\n      }}\r\n\r\n      >\r\n\r\n\r\n        <Masonry\r\n          breakpointCols={breakpointColumnsObj}\r\n          className=\"my-masonry-grid\"\r\n          columnClassName=\"my-masonry-grid_column\"\r\n        >\r\n\r\n          {postArr.map((item, index) => {\r\n\r\n            const { content, postID, ownerName, newKey } = item\r\n            return (\r\n              <PostFrame\r\n                key={newKey || postID}\r\n                postID={postID}\r\n                item={item}\r\n                size={size}\r\n                setSize={setSize}\r\n                isFirstOne={index === 0}\r\n\r\n                index={index}\r\n                setOpen={setOpenIndex}\r\n                setLightBoxOn={setLightBoxOn}\r\n\r\n                userName={userName}\r\n                setPostArr={setPostArr}\r\n              />\r\n            )\r\n          })}\r\n        </Masonry>\r\n\r\n\r\n\r\n\r\n      </Box >\r\n\r\n      <Box\r\n        ref={ref}\r\n        style={{\r\n          padding: theme.spacing(1), margin: \"auto\", backgroundColor: theme.palette.background.default, width: \"100%\",\r\n          opacity: Boolean(!isFull) && inView ? 1 : 0,\r\n          display: \"flex\", justifyContent: \"center\", alignItems: \"center\",\r\n          ...(isFull) && { display: \"none\" }\r\n        }}>\r\n        <CircularProgress size=\"3rem\" sx={{ color: theme.palette.text.secondary }} />\r\n      </Box>\r\n\r\n      <Dialog\r\n\r\n\r\n        onBackdropClick={function () {\r\n          setOpenIndex(-1);\r\n        }}\r\n        fullWidth={true}\r\n        //  fullScreen={true}\r\n        open={openIndex >= 0}\r\n        onClose={function () {\r\n\r\n          if (postArr[openIndex].postID) {\r\n            axios.get(`${url}/api/article/findOne/${postArr[openIndex].postID}`).then((response) => {\r\n\r\n              setPostArr(pre => {\r\n                return pre.map((post, index) => {\r\n                  if (index !== openIndex) { return post }\r\n                  else {\r\n                    console.log(response.data)\r\n                    return { ...response.data, newKey: Math.random() }\r\n                  }\r\n                })\r\n\r\n              })\r\n            })\r\n          }\r\n\r\n\r\n\r\n        }}\r\n        scroll={lightBoxOn ? \"paper\" : \"body\"}\r\n        sx={{\r\n          bgcolor: \"rgba(0,0,0,0.7)\",\r\n          ...lightBoxOn && { bgcolor: \"transparent\", display: `none` },\r\n          \"& > div > div > div\": { marginBottom: 0 }\r\n        }}\r\n      >\r\n\r\n        {postArr[openIndex] && <PostFrame\r\n          key={postArr[openIndex].newKey || postArr[openIndex].postID}\r\n          postID={postArr[openIndex].postID}\r\n          item={postArr[openIndex]}\r\n          size={dialogSize}\r\n          setSize={setDialogSize}\r\n          isFirstOne={true}\r\n\r\n          setOpen={setOpenIndex}\r\n\r\n          setLightBoxOn={setLightBoxOn}\r\n          userName={userName}\r\n          setPostArr={setPostArr}\r\n\r\n        />}\r\n      </Dialog>\r\n\r\n\r\n    </ContentContext.Provider>\r\n  )\r\n\r\n\r\n}\r\n\r\n\r\n\r\nexport function PostFrame({ preHtml, item, size, setSize, isFirstOne, userName, setPostArr, setOpen, index = -1, setLightBoxOn, ...props }) {\r\n  const theme = useTheme()\r\n  const target = useRef(null)\r\n  const currentSize = useRef(0)\r\n\r\n  const { content, postID, ownerName, postingTime, commentNum, newKey } = item\r\n\r\n  const [commentCount, setCommentCount] = useState(commentNum)\r\n\r\n  const avatarString = multiavatar(ownerName)\r\n\r\n\r\n  let avatarColor = avatarString.match(/#[a-zA-z0-9]*/)[0]\r\n\r\n  if (avatarColor.length < 7) {\r\n    avatarColor = \"#\" + avatarColor[1] + avatarColor[1] + avatarColor[2] + avatarColor[2] + avatarColor[3] + avatarColor[3]\r\n    //  avatarColor = \"#fffaf6\"\r\n  }\r\n  // const bgcolor = theme.isLight ? hexToRGB(avatarColor, 0.2) : hexToRGB2(avatarColor, 0.6)\r\n\r\n\r\n\r\n  const { needUpdateArr, setNeedUpdateArr, needReduceArr, setNeedReduceArr, userInfoArr, userColor } = useAppContext()\r\n\r\n\r\n  const bgcolor = getColor({ name: ownerName, userName, userInfoArr, userColor, theme })\r\n\r\n  useEffect(function () {\r\n\r\n    if (needUpdateArr.includes(postID)) {\r\n\r\n      let count = 0;\r\n      needUpdateArr.forEach(item => {\r\n        if (item === postID) {\r\n          count++\r\n        }\r\n      })\r\n\r\n      needReduceArr.forEach(item => {\r\n        if (item === postID) {\r\n          count--\r\n        }\r\n      })\r\n\r\n\r\n      // setNeedUpdateArr( needUpdateArr.filter(item => item !== postID))\r\n\r\n      setCommentCount(pre => pre + count)\r\n\r\n\r\n\r\n\r\n    }\r\n\r\n  }, [])\r\n\r\n  useEffect(function () {\r\n    if (isFirstOne) {\r\n      const resizeObserver = new ResizeObserver(entries => {\r\n        if (currentSize.current !== entries[0].contentRect.width) {\r\n          currentSize.current = entries[0].contentRect.width\r\n          setSize(entries[0].contentRect)\r\n        }\r\n      })\r\n\r\n      resizeObserver.observe(target.current)\r\n      return function () { resizeObserver.disconnect() }\r\n    }\r\n\r\n\r\n  }, [])\r\n\r\n\r\n  const [height, setHeight] = useState(\"auto\")\r\n\r\n\r\n  const [preHtmlEditor, setPreHtmlEditor] = useState()\r\n  const [openEditor, setOpenEditor] = useState(false)\r\n  const [unmountEditor, setUnmountEditor] = useState(true)\r\n\r\n  const [openComment, setOpenComment] = useState(false)\r\n  const [unmountComment, setUnmountComment] = useState(true)\r\n\r\n  return (\r\n    <Box\r\n      id={postID}\r\n\r\n      sx={{\r\n\r\n        boxShadow: 3,\r\n        \"& > div > div:not(.image-frame):not(.vote-frame):not(.title-line):not(.comment-sector):not(.MuiCollapse-wrapper.MuiCollapse-vertical)\": {\r\n          paddingLeft: \"4px\",\r\n          paddingRight: \"4px\",\r\n        },\r\n\r\n        transition: \"all, 300ms\",\r\n        wordWrap: \"break-word\",\r\n        height,\r\n        overflow: \"visible\",\r\n        position: \"relative\",\r\n\r\n        marginBottom: \"8px\",\r\n      }}\r\n\r\n      onClick={function () { //  setHeight(pre => { return Number(100 + Math.random() * 600).toFixed(0) + \"px\" })\r\n\r\n\r\n\r\n      }}\r\n\r\n      ref={target}>\r\n\r\n      <Box sx={{\r\n        bgcolor,\r\n      }}>\r\n        <Stack className=\"title-line\" direction=\"row\" sx={{ padding: \"4px\", display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}\r\n        >\r\n\r\n\r\n          <AvatarChip name={ownerName} avatarScale={1.2} textScale={0.8} boxShadow={0} title={true} />\r\n\r\n          <Box sx={{ display: \"flex\", alignItems: \"center\" }}>\r\n            <Countdown date={Date.parse(postingTime)} intervalDelay={1 * 1000}\r\n              renderer={function ({ days, hours, minutes, seconds, completed, ...props }) {\r\n                return <PostTimeRender  {...{ days, hours, minutes, seconds, completed, ...props }} />\r\n              }}\r\n              overtime={true}\r\n            />\r\n            <IconButton size=\"small\" sx={{ ...(userName !== ownerName) && { display: \"none\" } }}\r\n\r\n\r\n              onClick={function () {\r\n                axios.post(`${url}/api/article/delete`, { postID }).then(response => {\r\n\r\n                  setPostArr(pre => {\r\n\r\n                    return pre.filter(post => post.postID !== postID)\r\n\r\n                  })\r\n\r\n                })\r\n              }}\r\n            >\r\n              <DeleteOutline fontSize='medium' sx={{ color: theme.palette.text.secondary }} />\r\n            </IconButton>\r\n\r\n\r\n          </Box>\r\n\r\n        </Stack>\r\n\r\n        {toHtml(content, { theme, target, size, setSize, avatarColor, postID, setLightBoxOn, ownerName })}\r\n\r\n\r\n        <Box sx={{ display: \"flex\", alignItems: \"center\", justifyContent: \"space-between\" }}>\r\n\r\n\r\n          <Hidden smDown={true}>\r\n            <IconButton size=\"small\" onClick={function (e) {\r\n              e.preventDefault()\r\n              e.stopPropagation()\r\n              if (index >= 0) {\r\n                setOpen(index)\r\n              }\r\n            }}>\r\n              <AspectRatioOutlined fontSize='medium' sx={{ transform: \"scaleX(-1)\" }} />\r\n            </IconButton>\r\n          </Hidden>\r\n\r\n          <Hidden mdUp={true}>\r\n            <Box></Box>\r\n          </Hidden>\r\n\r\n          <Box>\r\n            <IconButton size=\"small\" onClick={function (e) {\r\n              e.preventDefault()\r\n              e.stopPropagation()\r\n              setOpenEditor(pre => !pre)\r\n              setUnmountEditor(false)\r\n            }}>\r\n              <Edit fontSize='medium' />\r\n            </IconButton>\r\n\r\n            <IconButton size=\"small\" onClick={function (e) {\r\n              e.preventDefault()\r\n              e.stopPropagation()\r\n              setOpenComment(pre => !pre)\r\n              setUnmountComment(false)\r\n            }}>\r\n\r\n              {/* <Badge badgeContent={commentCount}  sx={{ \"& > span\":{bgcolor:theme.palette.text.secondary,color:\"white\"}}}> */}\r\n              <ChatBubbleOutline fontSize='medium' />\r\n              {/* </Badge> */}\r\n\r\n              <Typography sx={{ fontSize: \"1rem !important\", color: theme.palette.text.secondary }}>&nbsp;{commentCount}</Typography>\r\n            </IconButton>\r\n          </Box>\r\n\r\n        </Box>\r\n\r\n      </Box>\r\n\r\n      {\r\n        (!unmountEditor) && <Collapse unmountOnExit={unmountEditor} in={openEditor} className=\"collapse\" sx={{ bgcolor, }}  >\r\n\r\n\r\n          <Box sx={{ width: \"calc(100% - 8px)\", marginRight: \"4px\", marginBottom: \"4px\", marginLeft: \"4px\", borderRadius: \"4px\", overflow: \"visible\", }}>\r\n\r\n            <SimpleDraftProvider openEditor={openEditor} postID={postID} userName={userName} bgcolor={bgcolor}\r\n              onSubmit={function (preHtml) {\r\n                //   alert(JSON.stringify(preHtml))\r\n                setPreHtmlEditor(preHtml)\r\n                setCommentCount(pre => pre + 1)\r\n\r\n                setOpenEditor(false)\r\n                setUnmountEditor(false)\r\n\r\n                setOpenComment(true)\r\n                setUnmountComment(false)\r\n\r\n              }}\r\n            />\r\n          </Box>\r\n\r\n\r\n\r\n        </Collapse>\r\n      }\r\n\r\n      {\r\n        (!unmountComment) && <Collapse unmountOnExit={unmountComment} in={openComment} className=\"collapse\">\r\n          <CommentSector item={item} avatarColor={bgcolor} toHtml={toHtml} PostingTime={PostingTime} commentCount={commentCount} setCommentCount={setCommentCount}\r\n            preHtmlEditor={preHtmlEditor}\r\n            setCommentCount={setCommentCount}\r\n          />\r\n        </Collapse>\r\n      }\r\n    </Box >\r\n  )\r\n\r\n}\r\n\r\nexport function LinkTag({ linkAdd }) {\r\n\r\n  const theme = useTheme()\r\n\r\n  // console.log(linkAdd.match(/(\\/\\/)([a-z0-9\\-._~%]+)/))\r\n\r\n\r\n\r\n\r\n  const [content, setContent] = useState(\"\")\r\n\r\n\r\n  return (\r\n    <Box\r\n      component=\"span\"\r\n      target=\"_blank\"\r\n      //  key={index}\r\n      sx={{\r\n        color: theme.isLight ? blue[600] : blue[800],\r\n        cursor: \"pointer\",\r\n        textDecoration: \"none\",\r\n        \"&:hover\": { textDecoration: \"underline\" }\r\n      }}\r\n\r\n      onClick={function (e) {\r\n        setContent(\r\n          <Link href={linkAdd} target=\"_blank\" rel=\"noopener\"\r\n            sx={{\r\n              color: theme.isLight ? blue[600] : blue[800],\r\n              cursor: \"pointer\",\r\n              textDecoration: \"none\",\r\n              \"&:hover\": { textDecoration: \"underline\" }\r\n            }}\r\n          >\r\n            {linkAdd}\r\n          </Link>\r\n        )\r\n      }}\r\n    >\r\n      {content || linkAdd.match(/(\\/\\/)([a-z0-9\\-._~%]+)/)[2]}\r\n    </Box >\r\n  )\r\n}\r\n\r\nexport function Images({ imgDataArr, allImageArr, target, size, setSize, postID, setLightBoxOn, ...props }) {\r\n\r\n  const theme = useTheme()\r\n  const numOfImage = imgDataArr ? imgDataArr.length : 0\r\n\r\n  const width = size ? size.width : 0\r\n  const height = [width / 16 * 9, width / 16 * 9, width / 2, width / 3, width / 16 * 9][numOfImage]\r\n\r\n\r\n\r\n  const baseGrid = [\r\n    {\r\n      gridTemplateColumns: \"1fr\",\r\n      gridTemplateRows: \"1fr\",\r\n    },\r\n    {\r\n      gridTemplateColumns: \"1fr\",\r\n      gridTemplateRows: \"1fr\",\r\n    },\r\n    {\r\n      gridTemplateColumns: \"1fr 1fr\",\r\n      gridTemplateRows: \"1fr\",\r\n    },\r\n    {\r\n      gridTemplateColumns: \"1fr 1fr 1fr\",\r\n      gridTemplateRows: \"1fr 1fr\",\r\n    },\r\n    {\r\n      gridTemplateColumns: \"1fr 1fr\",\r\n      gridTemplateRows: \"1fr 1fr\",\r\n    },\r\n  ][numOfImage]\r\n\r\n  const arr = [\r\n    [\r\n      { gridColumn: \"1/3\", gridRow: \"1/3\" }\r\n    ],\r\n    [\r\n      { gridColumn: \"1/2\", gridRow: \"1/3\" },\r\n      { gridColumn: \"2/3\", gridRow: \"1/3\" },\r\n    ],\r\n    [\r\n      { gridColumn: \"1/2\", gridRow: \"1/2\" },\r\n      { gridColumn: \"2/3\", gridRow: \"1/2\" },\r\n      { gridColumn: \"3/4\", gridRow: \"1/2\" },\r\n\r\n    ],\r\n    [\r\n      { gridColumn: \"1/2\", gridRow: \"1/2\" },\r\n      { gridColumn: \"2/3\", gridRow: \"1/2\" },\r\n      { gridColumn: \"1/2\", gridRow: \"2/3\" },\r\n      { gridColumn: \"2/3\", gridRow: \"2/3\" },\r\n    ]\r\n  ]\r\n\r\n  const imageHeight = size\r\n    ? [{ height: 0 }, { height: size.width / 16 * 9 }, { height: size.width / 2 }, { height: size.width / 3 }, { height: size.width / 16 * 9 / 2 }][numOfImage]\r\n    : { height: 0 }\r\n\r\n  const cssObj = {\r\n    display: 'grid',\r\n    ...baseGrid,\r\n    // gridTemplateColumns: \"1fr 1fr\",\r\n    // gridTemplateRows: \"1fr 1fr\",\r\n    gridGap: \"2px\",\r\n    position: \"relative\",\r\n\r\n    //   marginTop: \"2px\",\r\n    //  marginBottom: \"2px\",\r\n    justifyContent: 'space-around',\r\n    overflow: 'hidden',\r\n\r\n    width: \"100%\",\r\n    height,\r\n    // bgcolor: \"pink\",\r\n\r\n    ...numOfImage > 0 && {\r\n      \"& > *:nth-type(1)\": {\r\n        position: \"relative\",\r\n        ...arr[numOfImage - 1][0],\r\n      }\r\n    },\r\n    ...numOfImage > 1 && {\r\n      \"& > *:nth-type(2)\": {\r\n        position: \"relative\",\r\n        backgroundColor: \"#ffa\",\r\n        ...arr[numOfImage - 1][1]\r\n      }\r\n    },\r\n    ...numOfImage > 2 && {\r\n      \"& > *:nth-type(3)\": {\r\n        position: \"relative\",\r\n        backgroundColor: \"#afa\",\r\n        ...arr[numOfImage - 1][2]\r\n      }\r\n    },\r\n    ...numOfImage > 3 && {\r\n      \"& > *:nth-type(4)\": {\r\n        position: \"relative\",\r\n        backgroundColor: \"#aaf\",\r\n        ...arr[numOfImage - 1][3]\r\n      }\r\n    },\r\n    ...numOfImage > 4 && {\r\n      \"& > *:nth-type( n + 5 )\": {\r\n        display: \"none\",\r\n      }\r\n    },\r\n\r\n  }\r\n\r\n\r\n  const [photoIndex, setPhotoIndex] = useState(0)\r\n  const [isOpen, setIsOpen] = useState(false)\r\n  // useEffect(function () {\r\n\r\n  //   console.log(setLightBoxOn)\r\n  //   setTimeout(function () {\r\n  //     setLightBoxOn(isOpen)\r\n  //   }, 0)\r\n  //   // \r\n  // }, [isOpen])\r\n\r\n\r\n  const images = allImageArr.length > 0\r\n    ? allImageArr.map(img => {\r\n      return {\r\n        ...img,\r\n        imgSnap: `${url}/api/picture/downloadPicture/` + (String(img.imgSnap).substr(String(img.imgSnap).lastIndexOf(\"/\") + 1)) + \"-snap\",\r\n        imgUrl: `${url}/api/picture/downloadPicture/` + (String(img.imgUrl).substr(String(img.imgUrl).lastIndexOf(\"/\") + 1)) + \"\"\r\n      }\r\n    })\r\n    : []\r\n\r\n\r\n\r\n  // const lightBox = images.length > 0\r\n  //   ? <Lightbox\r\n  //     mainSrc={images[photoIndex]?.imgUrl}\r\n  //     nextSrc={images[(photoIndex + 1) % images.length]?.imgUrl}\r\n  //     prevSrc={images[(photoIndex + images.length - 1) % images.length]?.imgUrl}\r\n  //     onCloseRequest={() => {\r\n  //       setIsOpen(false);\r\n\r\n  //       setLightBoxOn(false)\r\n  //     }}\r\n  //     onMovePrevRequest={() =>\r\n  //       setPhotoIndex(\r\n  //         pre => (pre + images.length - 1) % images.length,\r\n  //       )\r\n  //     }\r\n  //     onMoveNextRequest={() =>\r\n  //       setPhotoIndex(\r\n  //         pre => (pre + images.length + 1) % images.length,\r\n  //       )\r\n  //     }\r\n  //     onAfterOpen={() => {\r\n\r\n\r\n  //       setLightBoxOn(true)\r\n  //     }\r\n  //     }\r\n\r\n  //   />\r\n  //   : <></>\r\n\r\n\r\n  return (\r\n\r\n    <Box className=\"image-frame\" sx={cssObj}>\r\n\r\n      {isOpen && <Lightbox\r\n        mainSrc={images[photoIndex]?.imgUrl}\r\n        nextSrc={images[(photoIndex + 1) % images.length]?.imgUrl}\r\n        prevSrc={images[(photoIndex + images.length - 1) % images.length]?.imgUrl}\r\n        onCloseRequest={() => {\r\n          setIsOpen(false);\r\n\r\n          setLightBoxOn(false)\r\n        }}\r\n        onMovePrevRequest={() =>\r\n          setPhotoIndex(\r\n            pre => (pre + images.length - 1) % images.length,\r\n          )\r\n        }\r\n        onMoveNextRequest={() =>\r\n          setPhotoIndex(\r\n            pre => (pre + images.length + 1) % images.length,\r\n          )\r\n        }\r\n        onAfterOpen={() => {\r\n\r\n\r\n          setLightBoxOn(true)\r\n        }\r\n        }\r\n\r\n      />}\r\n      {imgDataArr.map((pic, index) => {\r\n\r\n        //   const imageSnap = pic.imgSnap\r\n        const imageSnap = `${url}/api/picture/downloadPicture/` + (String(pic.imgSnap).substr(String(pic.imgSnap).lastIndexOf(\"/\") + 1)) + \"-snap\"\r\n\r\n\r\n        return (\r\n\r\n          <Box style={{\r\n            // backgroundColor: \"pink\",\r\n            width: \"100%\",\r\n            ...imageHeight,\r\n            display: \"block\",\r\n            position: \"relative\"\r\n          }}\r\n\r\n            key={index}\r\n          >\r\n\r\n\r\n            <img src={imageSnap} style={{ objectFit: \"cover\", width: \"100%\", height: \"100%\" }}\r\n              onClick={function (e) {\r\n                // alert(JSON.stringify(images))\r\n                // alert(JSON.stringify(e.target.src))\r\n                // setIsOpen(true)\r\n                // setPhotoIndex(index)\r\n\r\n                const pos = images.findIndex(function (img) {\r\n                  return img.imgSnap === imageSnap //e.target.src\r\n                })\r\n                // alert(JSON.stringify(images))\r\n                if (pos >= 0) {\r\n                  setIsOpen(true)\r\n                  setPhotoIndex(pos)\r\n                }\r\n              }}\r\n            />\r\n          </Box>\r\n        )\r\n\r\n      })}\r\n\r\n    </Box>\r\n\r\n\r\n  )\r\n\r\n}\r\n\r\n\r\nexport function VoteFrame({ data, avatarColor, postID, ownerName, ...props }) {\r\n\r\n  const theme = useTheme()\r\n  const { userName, setUserName,\r\n\r\n    needUpdateArr, setNeedUpdateArr, needReduceArr, setNeedReduceArr, userInfoArr, userColor\r\n  } = useAppContext()\r\n  //const { votedArr, setVotedArr } = useContentContext()\r\n\r\n  const { voteArr = [], voteTopic = null, pollDuration = null, } = data?.voteDataObj || {}\r\n\r\n  const [percentageArr, setPercentageArr] = useState([])\r\n  const [expireTime, setExpireTime] = useState(\"\")\r\n\r\n  const [isVotting, setIsVotting] = useState(false)\r\n  const [totalVotes, setTotalVotes] = useState(0)\r\n\r\n  //const [intervalDelay, setIntervalDelay] = useState(1 * 1000)\r\n\r\n  const voteCountRef = useRef()\r\n\r\n  useEffect(function () {\r\n\r\n\r\n    axios.get(`${url}/api/voteBlock/${postID}`).then(response => {\r\n\r\n      const { voteCountArr, expireTime, whoVoted } = response.data\r\n\r\n      voteCountRef.current = voteCountArr\r\n\r\n      setExpireTime(expireTime)\r\n      //  setIsVotting(((!whoVoted.includes(userName)) && (Date.parse(expireTime) - Date.now()) > 0) && (!votedArr.includes(postID)))\r\n      setIsVotting(((!whoVoted.includes(userName)) && (Date.parse(expireTime) - Date.now()) > 0))\r\n\r\n      const totalVotes = voteCountArr.reduce((current, next) => {\r\n\r\n        return current + next\r\n\r\n      })\r\n\r\n      setPercentageArr(\r\n        voteCountArr.map(item => {\r\n          return totalVotes === 0 ? 0 : Number(Number((item / totalVotes) * 100).toFixed(0))\r\n        })\r\n      )\r\n      setTotalVotes(totalVotes)\r\n\r\n    })\r\n\r\n  }, [])\r\n\r\n  // useEffect(function () {\r\n  //   setIsVotting(pre => pre && (!votedArr.includes(postID)))\r\n  // }, [votedArr])\r\n\r\n\r\n\r\n  const bgcolor = getColor3({ name: ownerName, userName, userInfoArr, userColor, theme })\r\n\r\n\r\n  return (\r\n    <Box className=\"vote-frame\" sx={{ \"& p\": { fontSize: theme.scaleSizeObj(1) }, \"& .count-down\": { fontSize: \"1rem\" } }} >\r\n      {voteTopic && <Typography variant='body2' sx={{ textAlign: \"center\" }} >{voteTopic || \"no\"}</Typography>}\r\n\r\n      {voteArr.map((choice, index) => {\r\n\r\n\r\n        return (\r\n          <Box sx={{\r\n            position: \"relative\",\r\n\r\n\r\n            ...isVotting && {\r\n              \"& > span\": { bgcolor: theme.palette.action.disabledBackground },\r\n              \"& > span > span\": {\r\n                bgcolor,\r\n                //bgcolor: hexToRGB(avatarColor, 0.5),\r\n                //  transition: \"all, 300ms\",\r\n                //  opacity:0.6,\r\n              },\r\n              \"&:hover\": {\r\n                cursor: \"pointer\", transition: \"all, 300ms\",\r\n                \"& > span\": { bgcolor: theme.palette.action.disabled },\r\n                \"& > span > span\": {\r\n                  bgcolor,\r\n                  //  bgcolor: hexToRGB(avatarColor, 1),\r\n                  //    transition: \"all, 300ms\",\r\n                  //    opacity:1,\r\n                },\r\n              }\r\n            },\r\n\r\n            ...!isVotting && {\r\n              \"& > span\": { bgcolor: \"rgba(0,0,0,0)\" },\r\n              \"& > span > span\": {\r\n                bgcolor:\r\n                  bgcolor,\r\n                // hexToRGB(avatarColor, 0.5), transition: \"all, 300ms\"\r\n              },\r\n            }\r\n\r\n\r\n\r\n\r\n\r\n          }} key={index}\r\n            onClick={function () {\r\n              //   isVotting && alert(\"fsdf\")\r\n              if (isVotting && voteCountRef.current) {\r\n\r\n                voteCountRef.current[index]++;\r\n                let totalVotes_ = totalVotes + 1\r\n\r\n                setPercentageArr(voteCountRef.current.map(item => {\r\n                  return Number(Number((item / totalVotes_) * 100).toFixed(0))\r\n                })\r\n                )\r\n                setTotalVotes(totalVotes_)\r\n                setIsVotting(false)\r\n                axios.put(`${url}/api/voteBlock`, { choicePos: index, userName, postID, })\r\n                //   setVotedArr(pre => [...pre, postID])\r\n              }\r\n\r\n            }}>\r\n            <LinearProgress key={index} variant=\"determinate\" value={percentageArr.length === 0 ? 0 : percentageArr[index]}  // value={Math.min(100, index * 15 + 20)}             //value={Number(Math.random() * 100).toFixed(0)}\r\n              sx={{\r\n                height: theme.scaleSizeObj(1.5), marginBottom: \"2px\",\r\n              }}\r\n            />\r\n\r\n            <Typography variant='body2'\r\n              alt=\"sdfsddf\"\r\n              sx={{\r\n                position: \"absolute\", top: \"50%\", left: 4, zIndex: 100, transform: \"translateY(-50%)\", display: \"block\", width: \"calc(100% - 64px )\",\r\n                //bgcolor: \"yellow\", \r\n                whiteSpace: \"nowrap\",\r\n                overflow: \"hidden\",\r\n                textOverflow: \"ellipsis\"\r\n              }}>\r\n              {(choice.length >= 25 ? choice.substring(0, 25) : choice)}\r\n            </Typography>\r\n            {/* <Typography variant='body2' sx={{ position: \"absolute\", top: \"50%\", right: 0, zIndex: 100, transform: \"translateY(-50%)\" }}>{Math.min(100, (index * 15 + 20)) + \"%\"}</Typography> */}\r\n            {\r\n              voteArr.length === 1 &&\r\n              <Typography variant='body2' sx={{ position: \"absolute\", top: \"50%\", right: 4, zIndex: 100, transform: \"translateY(-50%)\" }}>\r\n                {totalVotes} Votes\r\n              </Typography>\r\n            }\r\n            {\r\n              voteArr.length > 1 &&\r\n              <Typography variant='body2' sx={{ position: \"absolute\", top: \"50%\", right: 4, zIndex: 100, transform: \"translateY(-50%)\" }}>\r\n                {percentageArr.length === 0 ? 0 : percentageArr[index] + \"%\"}\r\n              </Typography>\r\n            }\r\n\r\n          </Box>\r\n        )\r\n\r\n      })}\r\n      {\r\n        expireTime && <Countdown date={Date.parse(expireTime)} intervalDelay={1 * 1000}\r\n          renderer={function ({ days, hours, minutes, seconds, completed, ...props }) {\r\n            return <TimeRender  {...{ days, hours, minutes, seconds, completed, expireTime, totalVotes, ...props }} />\r\n          }}\r\n\r\n          onComplete={function () {\r\n            setIsVotting(false)\r\n          }}\r\n          overtime={true}\r\n\r\n        />\r\n      }\r\n\r\n    </ Box >\r\n\r\n  )\r\n\r\n}\r\n\r\nfunction PostingTime({ postingTime }) {\r\n\r\n\r\n  return (\r\n\r\n    <Countdown date={Date.parse(postingTime)} intervalDelay={1 * 1000}\r\n      renderer={function ({ days, hours, minutes, seconds, completed, ...props }) {\r\n        return <PostTimeRender  {...{ days, hours, minutes, seconds, completed, ...props }} />\r\n      }}\r\n      overtime={true}\r\n    />\r\n\r\n  )\r\n\r\n}\r\n\r\n\r\n\r\nfunction PostTimeRender({ days, hours, minutes, seconds, completed, ...props }) {\r\n\r\n  const theme = useTheme()\r\n\r\n\r\n\r\n  const message = completed\r\n\r\n    ? days > 0\r\n      ? `${days}d`\r\n      : hours > 0\r\n        ? `${hours}h`\r\n        : minutes > 0\r\n          ? `${minutes}m`\r\n          : `0m`//`${seconds}s`//`Just now` //`${seconds} sec ago`\r\n    : days > 0\r\n      ? `Remaining ${days}+ days`\r\n      : hours > 0\r\n        ? `Remaining ${hours}+ hours`\r\n        : minutes > 0\r\n          ? `Remaining ${minutes}+ minutes`\r\n          : `Remaining ${seconds} seconds`\r\n\r\n  return <Typography variant='body2' className=\"count-down\" style={{ fontSize: \"1rem\" }} sx={{ color: theme.palette.text.secondary }}>{message} </Typography>\r\n\r\n}\r\n\r\nfunction TimeRender({ days, hours, minutes, seconds, completed, expireTime, totalVotes, ...props }) {\r\n\r\n  const theme = useTheme()\r\n\r\n\r\n\r\n  const message = completed\r\n    //  ? `Finished on ${format(Date.parse(expireTime), \"yyyy-MM-dd hh:mm\")}`\r\n    ? days > 0\r\n      ? `Closed ${days} days ago`\r\n      : hours > 0\r\n        ? `Closed ${hours} hours ago`\r\n        : minutes > 0\r\n          ? `Closed ${minutes} min ago`\r\n          : `Closed ${seconds} sec ago`\r\n    : days > 0\r\n      ? `${days}+ days Left`\r\n      : hours > 0\r\n        ? `${hours}+ hours Left`\r\n        : minutes > 0\r\n          ? `${minutes}+ min Left`\r\n          : `${seconds} sec Left`\r\n\r\n  return <Box sx={{ display: \"flex\", justifyContent: \"space-between\", paddingLeft: \"4px\", paddingRight: \"4px\" }}>\r\n    <Typography variant='body2' className=\"count-down\" sx={{ color: theme.palette.text.secondary }}>{message} </Typography>\r\n    <Typography variant='body2' className=\"count-down\" sx={{ color: theme.palette.text.secondary }}>Total {totalVotes} </Typography>\r\n    {/* <Typography variant='body2' className=\"count-down\" sx={{ color: theme.palette.text.secondary }}>{days} {hours} {minutes} {seconds}</Typography>\r\n    <Typography variant='body2' className=\"count-down\">{intervalDelay}</Typography> */}\r\n  </Box>\r\n\r\n\r\n\r\n\r\n}\r\n\r\n\r\n","import React, { useState, useRef, useEffect, useLayoutEffect, useContext, useCallback, createContext, useMemo } from 'react';\r\n\r\nimport logo from './logo.svg';\r\nimport './App.css';\r\n\r\n\r\nimport ThemeContextProvider from \"./ThemeContextProvider\";\r\nimport { DraftProvider as EditorCtx, useEditorState } from \"./ContextProvider\";\r\nimport Content, { InstantContent } from \"./Content\";\r\n\r\n\r\nimport { AppContext } from \"./App\"\r\n\r\n\r\nimport { Container, Grid, Paper, IconButton, ButtonGroup, Stack, Box, Chip, Avatar } from '@mui/material';\r\n\r\nexport default function useAppContext() {\r\n  return useContext(AppContext)\r\n}","import { useContext, useEffect, useState, useRef } from 'react';\r\nimport List from '@mui/material/List';\r\nimport ListItem from '@mui/material/ListItem';\r\nimport Divider from '@mui/material/Divider';\r\nimport ListItemText from '@mui/material/ListItemText';\r\nimport ListItemAvatar from '@mui/material/ListItemAvatar';\r\n\r\nimport Typography from '@mui/material/Typography';\r\n\r\nimport Avatar from '@mui/material/Avatar';\r\nimport Chip from '@mui/material/Chip';\r\nimport Stack from '@mui/material/Stack';\r\nimport Button from '@mui/material/Button';\r\nimport Popover from '@mui/material/Popover';\r\n\r\nimport { ThemeProvider, useTheme, createTheme } from '@mui/material/styles';\r\n\r\nimport {\r\n  BrowserRouter, Route, Routes, useRoutes, Link, useParams, matchPath, useLocation, useNavigate\r\n\r\n} from \"react-router-dom\";\r\n\r\n//import multiavatar from '@multiavatar/multiavatar';\r\n\r\nimport multiavatar from '@multiavatar/multiavatar';\r\n\r\nimport { url, toPreHtml, hexToRGB, hexToRGB2, colorArr, colorIndexArr } from \"./config\";\r\nimport { Context } from \"./ContextProvider\";\r\nimport useAppContext from \"./useAppContext\";\r\n\r\nexport default function PeopleList({ tabIndex, setShowing, setTabName, nameList, insertMention, blockType, ...props }) {\r\n\r\n\r\n\r\n\r\n  //const { sizeObj, peopleList } = useContext(Context)\r\n\r\n\r\n\r\n\r\n  const inTab = tabIndex % nameList.length\r\n\r\n\r\n  const theme = useTheme()\r\n\r\n  useEffect(function () {\r\n\r\n\r\n    setShowing(true)\r\n\r\n    return function () {\r\n      setShowing(false)\r\n    }\r\n\r\n  }, [])\r\n\r\n  const [right, setRight] = useState(false)\r\n  const [opacity, setOpacity] = useState(0)\r\n  const anchor = useRef()\r\n  useEffect(function () {\r\n    const { x, width } = anchor.current.getBoundingClientRect()\r\n    if (x + width + 50 > window.innerWidth) {\r\n      setRight(1)\r\n    }\r\n\r\n    //console.log(anchor.current.getBoundingClientRect().x, anchor.current.getBoundingClientRect().width, window.innerWidth)\r\n    setOpacity(1)\r\n\r\n\r\n  }, [])\r\n\r\n\r\n  const { personName } = useParams()\r\n\r\n  return (\r\n\r\n    <Stack direction=\"column\" spacing={0.2}\r\n      ref={anchor}\r\n      sx={{\r\n        width: \"fit-content\", position: \"absolute\",  // bgcolor: theme.palette.action.disabledBackground,\r\n        boxShadow: 3,\r\n        zIndex: 5000,\r\n        opacity,\r\n        ...Boolean(right) && { right: 0 },\r\n\r\n        backgroundColor: theme.palette.action.disabledBackground,//theme.isLight?\"lightgray\":\"darkgray\",//theme.palette.action.disabledBackground,\r\n        // ...(blockType === \"rightBlock\") && { transform: \"translateX(calc(-100% + 2rem) )\" },\r\n        // ...(blockType === \"centerBlock\") && { transform: \"translateX(calc(-50% + 2rem) )\" },\r\n      }}\r\n\r\n    // component={function (props) {\r\n    //   return (\r\n    //     <div {...props} contentEditable={false} suppressContentEditableWarning={true}\r\n    //       style={{\r\n    //         backgroundColor: theme.palette.action.disabledBackground,\r\n\r\n\r\n    //       }} />\r\n    //   )\r\n    // }}\r\n    >\r\n\r\n\r\n      {nameList.map((name, index) => {\r\n\r\n        if (inTab === index) { setTabName(name) }\r\n\r\n        return <AvatarChip name={name} insertMention={insertMention.bind(null, name)} inTab={inTab} index={index} key={index} inList={true} />\r\n\r\n\r\n\r\n      })}\r\n\r\n    </Stack>\r\n\r\n  )\r\n\r\n}\r\n\r\nexport function AvatarChip({ name = \"aaa\", inTab = 0, index = 0, avatarScale = 1.2, textScale = 0.8, title = false,\r\n  inList = false,\r\n  boxShadow = 0,\r\n  insertMention = () => { },\r\n  ...props }) {\r\n\r\n  const theme = useTheme()\r\n  const { userName, clickFn, userAvatarUrl, setUserAvatarUrl, avatarNameArr, userColor, userInfoArr, random } = useAppContext()\r\n\r\n\r\n\r\n  const avatarString = multiavatar(name)\r\n  let avatarColor = \"\"\r\n  let hoverColor = \"\"\r\n\r\n\r\n\r\n\r\n\r\n  if (!userColor && (userName === name)) {\r\n\r\n    let colorItem = avatarString.match(/#[a-zA-z0-9]*/)[0]\r\n    if (colorItem.length < 7) {\r\n      colorItem = \"#\" + colorItem[1] + colorItem[1] + colorItem[2] + colorItem[2] + colorItem[3] + colorItem[3]\r\n    }\r\n\r\n    console.log(name, colorItem)\r\n    if (title) {\r\n      avatarColor = \"transparent\"\r\n      hoverColor = colorItem\r\n    }\r\n    else if (inList && (inTab !== index)) {\r\n      avatarColor = theme.palette.panelColor\r\n      hoverColor = colorItem\r\n    }\r\n    else if (inList && (inTab === index)) {\r\n      avatarColor = theme.isLight ? hexToRGB(colorItem, 0.4) : hexToRGB(colorItem, 0.8)\r\n      hoverColor = colorItem\r\n    }\r\n    else {\r\n      avatarColor = theme.isLight ? hexToRGB(colorItem, 0.4) : hexToRGB2(colorItem, 0.6)\r\n      hoverColor = colorItem\r\n    }\r\n\r\n  }\r\n  else if (userColor && (userName === name)) {\r\n\r\n    const colorItem = colorArr[colorIndexArr.findIndex(item => item === userColor)]\r\n\r\n    if (title) {\r\n      avatarColor = \"transparent\"\r\n      hoverColor = colorItem[500]\r\n\r\n    }\r\n    else if (inList && (inTab !== index)) {\r\n      avatarColor = theme.palette.panelColor\r\n      hoverColor = colorItem[500]\r\n    }\r\n    else if (inList && (inTab === index)) {\r\n      avatarColor = theme.isLight ? colorItem[200] : colorItem[800]\r\n      hoverColor = colorItem[500]\r\n    }\r\n    else {\r\n      avatarColor = theme.isLight ? colorItem[200] : colorItem[800]\r\n      hoverColor = colorItem[500]\r\n    }\r\n\r\n  }\r\n  else if (userName !== name) {\r\n\r\n    const colorName = userInfoArr.find(userItem => userItem.userName === name)?.colorName\r\n    let colorItem = \"\"\r\n    if (colorName) {\r\n      colorItem = colorArr[colorIndexArr.findIndex(item => item === colorName)]\r\n      if (title) {\r\n        avatarColor = \"transparent\"\r\n        hoverColor = colorItem[500]\r\n      }\r\n      else if (inList && (inTab !== index)) {\r\n        avatarColor = theme.palette.panelColor\r\n        hoverColor = colorItem[500]\r\n      }\r\n      else if (inList && (inTab === index)) {\r\n        avatarColor = theme.isLight ? colorItem[200] : colorItem[800]\r\n        hoverColor = colorItem[500]\r\n      }\r\n      else {\r\n        avatarColor = theme.isLight ? colorItem[200] : colorItem[800]\r\n        hoverColor = colorItem[500]\r\n      }\r\n    }\r\n    else{\r\n      let colorItem = avatarString.match(/#[a-zA-z0-9]*/)[0]\r\n      if (colorItem.length < 7) {\r\n        colorItem = \"#\" + colorItem[1] + colorItem[1] + colorItem[2] + colorItem[2] + colorItem[3] + colorItem[3]\r\n      }\r\n\r\n      if (title) {\r\n        avatarColor = \"transparent\"\r\n        hoverColor = colorItem\r\n      }\r\n      else if (inList && (inTab !== index)) {\r\n        avatarColor = theme.palette.panelColor\r\n        hoverColor = colorItem\r\n      }\r\n      else if (inList && (inTab === index)) {\r\n        avatarColor = theme.isLight ? hexToRGB(colorItem, 0.4) : hexToRGB(colorItem, 0.8)\r\n        hoverColor = colorItem\r\n      }\r\n      else {\r\n        avatarColor = theme.isLight ? hexToRGB(colorItem, 0.4) : hexToRGB2(colorItem, 0.6)\r\n        hoverColor = colorItem\r\n      }\r\n\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n\r\n\r\n  const avatarSrc = userName == name\r\n    ? userAvatarUrl\r\n    : avatarNameArr.includes(name)\r\n      ? `${url}/api/user/downloadAvatar/${name}/${random}`\r\n      : \"data:image/svg+xml;base64,\" + btoa(avatarString)\r\n\r\n\r\n  return (\r\n\r\n\r\n    <ConditionalWrapper condition={!inList} wrapper={function (children) {\r\n\r\n      return <Link to={`/person/${name}`} target=\"_self\" style={{ textDecoration: \"none\" }}> {children}</Link>\r\n\r\n    }} >\r\n\r\n\r\n      <Chip\r\n        key={index}\r\n        clickable={true}\r\n        avatar={\r\n          <Avatar alt={name}\r\n            {...{ src: avatarSrc }}\r\n            sx={{\r\n              \"&.MuiAvatar-root.MuiChip-avatar\": {\r\n                width: title ? \"2.4rem\" : theme.scaleSizeObj(avatarScale),\r\n                height: title ? \"2.4rem\" : theme.scaleSizeObj(avatarScale),\r\n                marginLeft: 0,\r\n                marginRight: \"-8px\",// theme.scaleSizeObj(-0.3),\r\n                //transform: \"scale(0.9)\",\r\n                //  minWidth:\"2rem\",\r\n                //  minHeight:\"2rem\",\r\n                // marginTop:\"8px\",\r\n                // marginBottom:\"8px\",\r\n\r\n              }\r\n            }}\r\n          />}\r\n        label={name}\r\n        variant=\"filled\"\r\n        sx={{\r\n          justifyContent: \"flex-start\",\r\n          borderRadius: \"1000px\",\r\n          paddingRight: theme.scaleSizeObj(0.25 * 0.85),\r\n\r\n          // backgroundColor: inTab === index\r\n          //   ? theme.palette.mode === \"light\"\r\n          //     ? inList ? hexToRGB(avatarColor, 0.2) : hexToRGB2(avatarColor, title ? 0.0001 : 0.2)\r\n          //     : inList ? hexToRGB(avatarColor, 0.6) : hexToRGB2(avatarColor, title ? 0.0001 : 0.6)\r\n\r\n          //   : theme.palette.panelColor,\r\n\r\n          bgcolor: avatarColor,\r\n\r\n\r\n          height: title ? \"2.4rem\" : theme.scaleSizeObj(avatarScale),\r\n          fontSize: theme.scaleSizeObj(textScale),\r\n\r\n          boxShadow,\r\n          \"&:hover\": {\r\n\r\n            //  backgroundColor: inList ? hexToRGB(avatarColor, 1) : hexToRGB2(avatarColor, 1),  //hexify(hexToRgbA3(multiavatar(name).match(/#[a-zA-z0-9]*/)[0])),\r\n\r\n            bgcolor: hoverColor\r\n          },\r\n          \"& .MuiChip-label\": {\r\n            transform: \"translateY(0px)\",\r\n            ...title && { color: theme.palette.text.secondary },\r\n          }\r\n        }}\r\n        onClick={function () {\r\n          //  navigate(`/person/${name}`)\r\n        }}\r\n        onMouseDown={function () {\r\n\r\n          insertMention(name)\r\n        }}\r\n      />\r\n\r\n    </ConditionalWrapper >\r\n  )\r\n\r\n}\r\n\r\n\r\nfunction ConditionalWrapper({ condition, wrapper, children }) {\r\n\r\n  return condition ? wrapper(children) : children;\r\n}\r\n\r\n\r\n\r\nfunction getColor(){\r\n\r\n\r\n\r\n  \r\n}","\r\n\r\nimport { useContext, useState, useRef, useEffect } from 'react';\r\nimport { EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, AtomicBlockUtils } from 'draft-js';\r\nimport { Container, Grid, Paper, Typography, Box, Popover, Popper } from '@mui/material';\r\nimport PeopleList from './PeopleList';\r\n\r\n\r\nimport { Context } from \"./ContextProvider\"\r\nimport { useTheme } from '@mui/private-theming';\r\n\r\n\r\n//const fontSize = { xs: \"5rem\", sm: \"4rem\", md: \"3rem\", lg: \"2rem\", xl: \"3rem\" }\r\n\r\n\r\n\r\n\r\nexport default function createMentionPlugin() {\r\n\r\n  let editorState = null\r\n  let setEditorState = null\r\n  let newContent = null\r\n  const entityKeyObj = {}\r\n\r\n  let tagStartPos = 0\r\n  let tagEndPos = 0\r\n\r\n\r\n  let tabIndex = 1006;\r\n  let isShowing = false;\r\n\r\n  let tabName = \"\"\r\n\r\n  function checkShowing() {\r\n    return isShowing\r\n  }\r\n\r\n  function setShowing(bool) {\r\n    isShowing = bool\r\n  }\r\n\r\n  function setTabName(name) {\r\n    tabName = name\r\n  }\r\n\r\n\r\n  function conditionWrap({ searchAllBlock = true, editorState }) {\r\n\r\n    return searchAllBlock\r\n      ? editorState.getCurrentContent().getBlockMap()\r\n      : [editorState.getCurrentContent().getBlockForKey(editorState.getSelection().getStartKey())]\r\n\r\n  }\r\n\r\n\r\n\r\n  function taggingMention() {\r\n\r\n    const [anchorKey, anchorOffset, focusKey, focusOffset, isBackward, hasfocus] = editorState.getSelection().toArray()\r\n    const [anchorStartKey, anchorStartOffset, anchorFocusKey, anchorFocusOffset, isAnchorBackward, isAnchorFocused]\r\n      = [!isBackward ? anchorKey : focusKey, !isBackward ? anchorOffset : focusOffset, isBackward ? anchorKey : focusKey, isBackward ? anchorOffset : focusOffset,]\r\n    const regx = /\\s([@][\\w_\\[\\u4E00-\\u9FCA\\]]*)/g\r\n\r\n    const oldSelection = editorState.getSelection();\r\n    let newSelection = editorState.getSelection();\r\n    newContent = editorState.getCurrentContent();\r\n\r\n    conditionWrap({ editorState, searchAllBlock: true }).forEach(function (block) {\r\n\r\n      const blockKey = block.getKey()\r\n      const blockText = block.getText()\r\n      const metaArr = block.getCharacterList()\r\n\r\n      metaArr.forEach(function (item, index) {\r\n        const itemEntityKey = item.getEntity()\r\n        if (itemEntityKey) {\r\n          const entityType = newContent.getEntity(itemEntityKey).getType()\r\n\r\n          if (entityType.indexOf(\"mention\") >= 0) {\r\n\r\n            newSelection = newSelection.merge({\r\n              anchorKey: blockKey,\r\n              anchorOffset: index,\r\n              focusKey: blockKey,\r\n              focusOffset: index + 1,\r\n              isBackward: false,\r\n              hasFocus: false,\r\n            })\r\n            newContent = Modifier.applyEntity(newContent, newSelection, null)\r\n          }\r\n        }\r\n      })\r\n\r\n      let matchArr;\r\n      while ((matchArr = regx.exec(blockText)) !== null) {\r\n        // alert(\"fdfsf\")\r\n        const start = matchArr.index;\r\n        const end = matchArr.index + matchArr[0].length;\r\n        const contentLenth = end - start;\r\n        const contentFocusAt = anchorFocusOffset - start;\r\n\r\n\r\n        const mentionOn = hasfocus && (blockKey === anchorFocusKey) && (contentFocusAt > 0) && (contentFocusAt <= contentLenth)\r\n        const mentionOff = !mentionOn\r\n\r\n\r\n        if (mentionOn) {\r\n\r\n          tagStartPos = start\r\n          tagEndPos = end\r\n\r\n          newSelection = newSelection.merge({\r\n            anchorKey: blockKey,\r\n            focusKey: blockKey,\r\n            anchorOffset: start + 1,\r\n            focusOffset: end,//  start + 2,\r\n            isBackward: false,\r\n            hasFocus: false,\r\n          })\r\n          newContent = Modifier.applyEntity(newContent, newSelection, entityKeyObj[`mentionOn`])\r\n        }\r\n        else if (mentionOff) {\r\n          tagStartPos = start\r\n          tagEndPos = end\r\n\r\n          newSelection = newSelection.merge({\r\n            anchorKey: blockKey,\r\n            focusKey: blockKey,\r\n            anchorOffset: start + 1,\r\n            focusOffset: end,//start + 2,\r\n            isBackward: false,\r\n            hasFocus: false,\r\n          })\r\n          newContent = Modifier.applyEntity(newContent, newSelection, entityKeyObj[`mentionOff`])\r\n        }\r\n      }\r\n    })\r\n\r\n    editorState = EditorState.push(editorState, newContent, \"apply-entity\");\r\n    editorState = EditorState.acceptSelection(editorState, oldSelection);\r\n    return editorState\r\n\r\n  }\r\n\r\n  function mentionStrategy(contentBlock, callback, contentState) {\r\n\r\n    contentBlock.findEntityRanges(\r\n      function (character) {\r\n        const entityKey = character.getEntity();\r\n        return entityKey !== null && contentState.getEntity(entityKey).getType().indexOf(\"mention\") >= 0\r\n      },\r\n      callback\r\n    );\r\n  }\r\n\r\n  function Mention({ ...props }) {\r\n\r\n\r\n    const { peopleList } = useContext(Context)\r\n\r\n    const theme = useTheme()\r\n\r\n\r\n\r\n\r\n\r\n    const { contentState, entityKey, blockKey, offsetKey, start, end, decoratedText, children } = props;\r\n    const { mentionHeadKey, mentionBodyKey, person, imgurl, mentionType } = contentState.getEntity(entityKey).getData()\r\n\r\n\r\n    const blockType = contentState.getBlockForKey(blockKey).getType()\r\n    const blockData = contentState.getBlockForKey(blockKey).getData().toObject()\r\n\r\n    const regx = new RegExp(`${decoratedText.replace(\"@\", \"\")}`, \"i\")\r\n    const text = decoratedText.replace(\"@\", \"\")\r\n\r\n    const cssObj = {\r\n      ...text && { backgroundColor: theme.palette.mentionBg },\r\n      display: \"inline-block\",\r\n      \"& span\": { fontSize: blockData.isSmallFont ? theme.scaleSizeObj(0.8) : theme.sizeObj }\r\n    }\r\n\r\n\r\n    const nameList = peopleList.filter(people => {\r\n      return Boolean(people.match(regx))\r\n    })\r\n\r\n\r\n\r\n\r\n\r\n    if ((mentionType === \"mentionOn\") && (nameList.length !== 0)) {\r\n\r\n      return (\r\n        <Box sx={{ display: \"inline-block\" }} >\r\n          <Typography sx={cssObj} variant=\"body2\">\r\n            {children}\r\n          </Typography>\r\n\r\n\r\n\r\n          <PeopleList tabIndex={tabIndex} setShowing={setShowing} setTabName={setTabName} nameList={nameList} insertMention={insertMention} blockType={blockType} />\r\n\r\n\r\n        </Box>\r\n      )\r\n    }\r\n\r\n    else {\r\n      return <Typography sx={cssObj} variant=\"body2\">\r\n        {children}\r\n      </Typography>\r\n      // return (\r\n      //   <Box sx={{ display: \"inline-block\" }}>\r\n      //     <Typography aria-describedby={\"sssd\"} sx={cssObj} variant=\"body2\" //ref={anchor}\r\n      //     >\r\n      //       {children}\r\n      //     </Typography>\r\n      //     <PeopleList tabIndex={tabIndex} setShowing={setShowing} setTabName={setTabName} nameList={nameList} insertMention={insertMention} blockType={blockType} />\r\n      //   </Box>\r\n      // )\r\n    }\r\n\r\n  }\r\n\r\n\r\n\r\n\r\n  function insertMention(name) {\r\n\r\n\r\n\r\n    const text = name ? (\" \" + name) : (\" \" + tabName)\r\n    const contentState = editorState.getCurrentContent();\r\n    const selection = editorState.getSelection();\r\n\r\n\r\n    const [anchorKey, anchorOffset, focusKey, focusOffset, isBackward, hasfocus] = selection.toArray()\r\n    const [anchorStartKey, anchorStartOffset, anchorFocusKey, anchorFocusOffset, isAnchorBackward, isAnchorFocused]\r\n      = [!isBackward ? anchorKey : focusKey, !isBackward ? anchorOffset : focusOffset, isBackward ? anchorKey : focusKey, isBackward ? anchorOffset : focusOffset,]\r\n\r\n\r\n    let newSelection = selection.merge({\r\n      anchorKey: anchorStartKey,\r\n      anchorOffset: tagStartPos,\r\n      focusKey: anchorStartKey,\r\n      focusOffset: tagEndPos,\r\n      isBackward: false,\r\n      hasFocus: true,\r\n\r\n    })\r\n\r\n    let newContent = Modifier.replaceText(\r\n      contentState,\r\n      newSelection,\r\n      text,\r\n    )\r\n\r\n    newContent = Modifier.applyEntity(newContent, editorState.getSelection().merge({\r\n\r\n      anchorKey: anchorStartKey,\r\n      anchorOffset: tagStartPos + 1,  // +1 for extra space added in tabName\r\n      focusKey: anchorStartKey,\r\n      focusOffset: tagStartPos + text.length,\r\n      isBackward: false,\r\n      hasFocus: true,\r\n    }), entityKeyObj[`personTag`])\r\n\r\n\r\n    newSelection = editorState.getSelection().merge({\r\n\r\n      anchorKey: anchorStartKey,\r\n      anchorOffset: tagStartPos + text.length,\r\n      focusKey: anchorStartKey,\r\n      focusOffset: tagStartPos + text.length,\r\n      isBackward: false,\r\n      hasFocus: true,\r\n    })\r\n\r\n\r\n\r\n    if (!name) {\r\n      editorState = EditorState.push(editorState, newContent, \"insert-characters\");\r\n      editorState = EditorState.acceptSelection(editorState, newSelection)\r\n      setEditorState(editorState)\r\n    }\r\n    else {\r\n      setTimeout(() => {\r\n        editorState = EditorState.push(editorState, newContent, \"insert-characters\");\r\n        editorState = EditorState.forceSelection(editorState, newSelection)\r\n        setEditorState(editorState)\r\n      }, 0);\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  return {\r\n    checkShowing,\r\n    mentionPlugin: {\r\n\r\n\r\n\r\n      onChange: function (newState, { setEditorState: setEditorState_ }) {\r\n\r\n        editorState = newState\r\n        setEditorState = setEditorState_\r\n        newContent = newState.getCurrentContent()\r\n\r\n        if (Object.keys(entityKeyObj).length === 0) {\r\n\r\n          entityKeyObj.mentionOn = newContent.createEntity(`mentionOn`, \"MUTABLE\", { mentionType: `mentionOn` }).getLastCreatedEntityKey();\r\n          entityKeyObj.mentionOff = newContent.createEntity(`mentionOff`, \"MUTABLE\", { mentionType: `mentionOff` }).getLastCreatedEntityKey();\r\n          entityKeyObj.personTag = newContent.createEntity(`personTag`, \"IMMUTABLE\", { mentionType: `personTag` }).getLastCreatedEntityKey();\r\n        }\r\n\r\n\r\n        editorState = taggingMention()\r\n\r\n        return editorState\r\n\r\n      },\r\n\r\n\r\n      keyBindingFn(e, { getEditorState, setEditorState, ...obj }) {\r\n\r\n        if ((e.keyCode === 40) && isShowing) {\r\n          tabIndex = tabIndex + 1;\r\n          return \"fire-arrow\";\r\n        }\r\n\r\n        else if ((e.keyCode === 38) && isShowing) {\r\n          tabIndex = tabIndex - 1;\r\n          return \"fire-arrow\";\r\n        }\r\n        else {\r\n          return undefined\r\n\r\n        }\r\n      },\r\n      handleKeyCommand(command, editorState, evenTimeStamp, { setEditorState }) {\r\n\r\n        if (command === \"fire-arrow\") {\r\n\r\n          setEditorState(editorState)\r\n\r\n          return \"handled\"\r\n        }\r\n\r\n        return undefined\r\n      },\r\n      handleReturn(e, newState, { setEditorState: setEditorState_ }) {\r\n\r\n        if (isShowing) {\r\n          editorState = newState\r\n          setEditorState = setEditorState_\r\n          insertMention();\r\n          //  insertMention(matchFriendArr[tabIndex % matchFriendArr.length]);\r\n          return \"handled\"\r\n        }\r\n        else {\r\n          return undefined\r\n        }\r\n      },\r\n\r\n      decorators: [\r\n        {\r\n          strategy: mentionStrategy,\r\n          component: Mention,//MentionWrapFn,//withContext(withTheme(Mention))\r\n        }\r\n      ],\r\n\r\n    }\r\n\r\n  }\r\n\r\n}","\r\n\r\nimport { useContext } from 'react';\r\nimport { EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, AtomicBlockUtils } from 'draft-js';\r\nimport { Container, Grid, Paper, Typography, Box, Avatar } from '@mui/material';\r\nimport PeopleList from './PeopleList';\r\n\r\nimport multiavatar from '@multiavatar/multiavatar';\r\nimport { Context } from \"./ContextProvider\"\r\nimport { useTheme } from '@mui/private-theming';\r\n\r\nimport { AvatarChip } from \"./PeopleList\";\r\n\r\nimport useAppContext from './useAppContext';\r\nimport { url, toPreHtml, hexToRGB, hexToRGB2, colorArr, colorIndexArr } from \"./config\";\r\n\r\n\r\nexport default function createPersonPlugin() {\r\n\r\n  function personStrategy(contentBlock, callback, contentState) {\r\n\r\n    contentBlock.findEntityRanges(\r\n      function (character) {\r\n        const entityKey = character.getEntity();\r\n        return entityKey !== null && contentState.getEntity(entityKey).getType().indexOf(\"personTag\") >= 0\r\n      },\r\n      callback\r\n    );\r\n  }\r\n\r\n  function Person({ ...props }) {\r\n\r\n    const theme = useTheme()\r\n    const { userName, clickFn, userAvatarUrl, setUserAvatarUrl, avatarNameArr, userColor, userInfoArr, random } = useAppContext()\r\n\r\n\r\n    const { contentState, entityKey, blockKey, offsetKey, start, end, decoratedText, children, } = props;\r\n    const { mentionHeadKey, mentionBodyKey, person, imgurl, mentionType } = contentState.getEntity(entityKey).getData()\r\n\r\n    const blockData = contentState.getBlockForKey(blockKey).getData().toObject()\r\n\r\n    const backgroundImage = userName === decoratedText\r\n      ? `url(${userAvatarUrl})`\r\n      : avatarNameArr.includes(decoratedText)\r\n        ? `url(${url}/api/user/downloadAvatar/${decoratedText}/${random})`\r\n        : `url(${\"data:image/svg+xml;base64,\" + btoa(multiavatar(decoratedText))})`\r\n\r\n\r\n    const cssObj = {\r\n      // backgroundColor: theme.palette.mode === \"light\"\r\n      //   ? hexify(hexToRgbA(multiavatar(decoratedText).match(/#[a-zA-z0-9]*/)[0]))\r\n      //   : hexify(hexToRgbA2(multiavatar(decoratedText).match(/#[a-zA-z0-9]*/)[0])),//       \"gold\",\r\n      display: \"inline-block\",\r\n      \"& span\": {\r\n\r\n        fontSize: theme.scaleSizeObj(blockData.isSmallFont ? 0.8 : 1),\r\n\r\n        wordWrap: \"normal\",\r\n        transition: \"font-size, 300ms\"\r\n      },\r\n\r\n    }\r\n\r\n    const name = decoratedText\r\n    const avatarString = multiavatar(name)\r\n    let avatarColor = \"\"\r\n    let colorItem = \"\"\r\n\r\n    if (!userColor && (userName === name)) {\r\n\r\n      let colorItem = avatarString.match(/#[a-zA-z0-9]*/)[0]\r\n      if (colorItem.length < 7) {\r\n        colorItem = \"#\" + colorItem[1] + colorItem[1] + colorItem[2] + colorItem[2] + colorItem[3] + colorItem[3]\r\n      }\r\n      avatarColor = theme.isLight ? hexToRGB(colorItem, 0.4) : hexToRGB2(colorItem, 0.6)\r\n    }\r\n    else if (userColor && (userName === name)) {\r\n      const colorItem = colorArr[colorIndexArr.findIndex(item => item === userColor)]\r\n      avatarColor = theme.isLight ? colorItem[200] : colorItem[800]\r\n    }\r\n    else if (userName !== name) {\r\n\r\n      const colorName = userInfoArr.find(userItem => userItem.userName === name)?.colorName\r\n      let colorItem = \"\"\r\n      if (colorName) {\r\n        colorItem = colorArr[colorIndexArr.findIndex(item => item === colorName)]\r\n        avatarColor = theme.isLight ? colorItem[200] : colorItem[800]\r\n      }\r\n      else {\r\n        let colorItem = avatarString.match(/#[a-zA-z0-9]*/)[0]\r\n        if (colorItem.length < 7) {\r\n          colorItem = \"#\" + colorItem[1] + colorItem[1] + colorItem[2] + colorItem[2] + colorItem[3] + colorItem[3]\r\n        }\r\n        avatarColor = theme.isLight ? hexToRGB(colorItem, 0.4) : hexToRGB2(colorItem, 0.6)\r\n      }\r\n    }\r\n\r\n\r\n\r\n    return (\r\n\r\n      <Box //contentEditable={false} suppressContentEditableWarning={true}\r\n        sx={{\r\n          // bgcolor: theme.palette.mode === \"light\"\r\n          //   ? hexify(hexToRgbA(multiavatar(decoratedText).match(/#[a-zA-z0-9]*/)[0]))\r\n          //   : hexify(hexToRgbA2(multiavatar(decoratedText).match(/#[a-zA-z0-9]*/)[0])),\r\n\r\n\r\n          bgcolor: avatarColor,\r\n          verticalAlign: \"sub\",\r\n          backgroundImage,\r\n          // backgroundImage: `url(${\"data:image/svg+xml;base64,\" + btoa(multiavatar(decoratedText))})`,\r\n          backgroundSize: \"contain\",\r\n          paddingLeft: theme.scaleSizeObj(blockData.isSmallFont ? 1 : 1.2),\r\n          paddingRight: theme.scaleSizeObj(blockData.isSmallFont ? 0.4 : 0.5),\r\n          borderRadius: \"1000px\",\r\n          backgroundRepeat: \"no-repeat\",\r\n          display: \"inline-block\",\r\n          //   backgroundSize: theme.sizeObj,\r\n          backgroundPositionX: \"left\",\r\n          backgroundPositionY: \"center\",\r\n          height: theme.scaleSizeObj(blockData.isSmallFont ? 0.8 : 1),\r\n          \"& p\": {\r\n            verticalAlign: \"top\",\r\n            lineHeight: 1,\r\n          },\r\n          transition: \"height, padding-left, padding-right, 300ms\",\r\n        }}\r\n      >\r\n\r\n        <Typography sx={cssObj} variant=\"body2\">\r\n          {children}\r\n        </Typography>\r\n      </Box>\r\n\r\n\r\n    )\r\n\r\n\r\n\r\n\r\n\r\n    return <Typography sx={cssObj} variant=\"body2\">\r\n      {children}\r\n    </Typography>\r\n\r\n  }\r\n\r\n  return {\r\n\r\n    personPlugin: {\r\n\r\n      decorators: [\r\n        {\r\n          strategy: personStrategy,\r\n          component: Person,\r\n        }\r\n      ],\r\n\r\n    }\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nfunction hexify(color) {\r\n  var values = color\r\n    .replace(/rgba?\\(/, '')\r\n    .replace(/\\)/, '')\r\n    .replace(/[\\s+]/g, '')\r\n    .split(',');\r\n  var a = parseFloat(values[3] || 1),\r\n    r = Math.floor(a * parseInt(values[0]) + (1 - a) * 255),\r\n    g = Math.floor(a * parseInt(values[1]) + (1 - a) * 255),\r\n    b = Math.floor(a * parseInt(values[2]) + (1 - a) * 255);\r\n  return \"#\" +\r\n    (\"0\" + r.toString(16)).slice(-2) +\r\n    (\"0\" + g.toString(16)).slice(-2) +\r\n    (\"0\" + b.toString(16)).slice(-2);\r\n}\r\n\r\nfunction hexToRgbA(hex) {\r\n  var c;\r\n  if (/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)) {\r\n    c = hex.substring(1).split('');\r\n    if (c.length == 3) {\r\n      c = [c[0], c[0], c[1], c[1], c[2], c[2]];\r\n    }\r\n    c = '0x' + c.join('');\r\n    return 'rgba(' + [(c >> 16) & 255, (c >> 8) & 255, c & 255].join(',') + ',0.2)';\r\n  }\r\n  throw new Error('Bad Hex');\r\n}\r\n\r\n\r\nfunction hexToRgbA2(hex) {\r\n  var c;\r\n  if (/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)) {\r\n    c = hex.substring(1).split('');\r\n    if (c.length == 3) {\r\n      c = [c[0], c[0], c[1], c[1], c[2], c[2]];\r\n    }\r\n    c = '0x' + c.join('');\r\n    return 'rgba(' + [(c >> 16) & 255, (c >> 8) & 255, c & 255].join(',') + ',0.5)';\r\n  }\r\n  throw new Error('Bad Hex');\r\n}\r\n","import {\r\n  isMobile,\r\n  isFirefox,\r\n  isChrome,\r\n  browserName,\r\n  engineName,\r\n} from \"react-device-detect\";\r\n\r\n\r\nconst emojiRegexRGI = require('emoji-regex');\r\n// const emojiRegexRGI = require('emoji-regex/es2015/RGI_Emoji.js');\r\n// const emojiRegex = require('emoji-regex/es2015/index.js');\r\n// const emojiRegexText = require('emoji-regex/es2015/text.js');\r\n\r\nexport const emojiRegex = emojiRegexRGI()\r\n\r\nexport const emojiArr1 = `\r\n                                                   \r\n                   \r\n    `\r\nexport const emojiArr2 = `                          \r\n    `\r\nexport const emojiArr3 = `                                  \r\n                                     \r\n                                       \r\n                                              \r\n                                            \r\n                                   \r\n                            \r\n    `\r\nexport const emojiArr3Chrome = `                 \r\n                         \r\n                    \r\n                 \r\n                       \r\n                       \r\n                         \r\n    `\r\nexport const emojiArr4 = `                                                 `\r\nexport const emojiArr4Chrome = `                         `\r\n\r\nexport const emojiArr5 = `                                \r\n                           \r\n                               \r\n                           \r\n                              \r\n                                    \r\n                                    \r\n                                  \r\n                                   \r\n                    \r\n`\r\nexport const emojiArr6 = `                                \r\n                                      \r\n                                  \r\n                                \r\n                                       \r\n                                       \r\n                                       \r\n                                         \r\n           \r\n    `\r\n\r\nexport const emojiArr7 = `                                             \r\n                                                                    \r\n                                                                   \r\n                          `\r\n\r\nexport const emojiArr7Chrome = `                                \r\n                \r\n                                         \r\n                `\r\n\r\n\r\nexport const emojiArr8 = `                                                    \r\n                                                               \r\n             `\r\n\r\nexport const emojiArr8Chrome = `                      \r\n                                      `\r\n\r\n\r\nexport const emojiArr9 = `                                                      \r\n                                                             \r\n       `\r\n\r\nexport const emojiArr9Chrome = `         \r\n                          \r\n      `\r\n\r\n\r\nexport const emojiArr10 = `                                                        \r\n                                                                 \r\n             `\r\n\r\n\r\nexport const emojiArr10Chrome = `                   \r\n                                        \r\n            `\r\n\r\n\r\nexport const emojiArr11 = `                                                        \r\n                                                                        \r\n                                                                   \r\n                              \r\n    `\r\n\r\nexport const emojiArr11Chrome = `                                 \r\n                       \r\n                                           \r\n                       `\r\n\r\nexport const emojiArr12 = `                                                        \r\n                                                                   \r\n                           0 1 2 3 4 5 6 7 8 9   # *                             \r\n                                                                     \r\n                                        \r\n    `\r\nexport const emojiArr12Chrome = `                                                 \r\n                                                       \r\n                       0 1 2 3 4 5 6 7 8 9   # *                       \r\n                                               \r\n                         \r\n    `\r\nexport const emojiArr13 = `                                             \r\n                                                      `\r\n\r\nexport const emojiArr13Chrome = `                                             \r\n       `\r\n\r\nexport const emojiArr14 = `                                         \r\n                                                         \r\n                                                    \r\n                                                     \r\n                                              \r\n                        `\r\n\r\nexport const emojiArr14Chrome = `           \r\n                                \r\n                     \r\n                     \r\n                          \r\n       `\r\n\r\n const emojiArr = [\r\n // { symbolStr: \"\", category: \"\", slideOn: true },\r\n  { symbolStr: emojiArr1, category: \"\", },\r\n  { symbolStr: emojiArr2, category: \"\" },\r\n\r\n  isChrome ? { symbolStr: emojiArr3Chrome, category: \"\" } : { symbolStr: emojiArr3, category: \"\" },\r\n  isChrome ? { symbolStr: emojiArr4Chrome, category: \"\" } : { symbolStr: emojiArr4, category: \"\" },\r\n\r\n  !isChrome && { symbolStr: emojiArr5, category: \"\" },\r\n  !isChrome && { symbolStr: emojiArr6, category: \"\" },\r\n\r\n  isChrome ? { symbolStr: emojiArr7Chrome, category: \"\" } : { symbolStr: emojiArr7, category: \"\" },\r\n  isChrome ? { symbolStr: emojiArr8Chrome, category: \"\" } : { symbolStr: emojiArr8, category: \"\" },\r\n  isChrome ? { symbolStr: emojiArr9Chrome, category: \"\" } : { symbolStr: emojiArr9, category: \"\" },\r\n  isChrome ? { symbolStr: emojiArr10Chrome, category: \"\" } : { symbolStr: emojiArr10, category: \"\" },\r\n  isChrome ? { symbolStr: emojiArr11Chrome, category: \"\" } : { symbolStr: emojiArr11, category: \"\" },\r\n  isChrome ? { symbolStr: emojiArr12Chrome, category: \"\" } : { symbolStr: emojiArr12, category: \"\" },\r\n // isChrome ? { symbolStr: emojiArr13Chrome, category: \"\" } : { symbolStr: emojiArr13, category: \"\" },\r\n  isChrome ? { symbolStr: emojiArr14, category: \"\" } : { symbolStr: emojiArr14, category: \"\" },\r\n].filter(item => (Boolean(item)))\r\n\r\nexport default emojiArr\r\n\r\n\r\n","import React, { useState, useRef, useEffect, useLayoutEffect, useContext } from 'react';\r\n\r\nimport { EditorState, KeyBindingUtil, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, SelectionState, CharacterMetadata } from 'draft-js';\r\n\r\n\r\n// import { makeStyles, styled, useTheme, withStyles, withTheme } from '@material-ui/core/styles';\r\n// import { Typography, Button, ButtonGroup, Container, Paper, Avatar, IconButton, Box, Slide } from \"@material-ui/core\";\r\n\r\n// import { height } from '@material-ui/system';\r\n// import { withContext } from \"./ContextProvider\"\r\n\r\n// import classNames from \"classnames\"\r\n\r\n// import PropTypes from 'prop-types';\r\n// import SwipeableViews from 'react-swipeable-views';\r\n\r\n// import AppBar from '@material-ui/core/AppBar';\r\n// import Tabs from '@material-ui/core/Tabs';\r\n// import Tab from '@material-ui/core/Tab';\r\n\r\n// import { InsertEmoticon, PanToolOutlined, PeopleOutlined, BeachAccessOutlined } from \"@material-ui/icons\";\r\nimport { Button, CssBaseline, Switch, Paper, IconButton, Popover, Typography, Slide, Tabs, Tab, AppBar, Stack, Box, Divider } from '@mui/material';\r\nimport { EmojiEmotionsOutlined } from '@mui/icons-material';\r\nimport { blue, red } from '@mui/material/colors';\r\nimport {\r\n  isMobile,\r\n  isFirefox,\r\n  isChrome,\r\n  browserName,\r\n  engineName,\r\n} from \"react-device-detect\";\r\n\r\nimport emojiArr, { emojiRegex } from \"./EmojiConfig\";\r\nimport { useTheme } from '@mui/system';\r\nimport { Context } from \"./ContextProvider\";\r\n\r\n\r\nexport default function EmojiPanel({ insertEmoji, editorRef, typeName, ...props }) {\r\n\r\n  const theme = useTheme()\r\n  const { editorState, setEditorState, sizeObj } = useContext(Context)\r\n  const [anchorEl, setAnchorEl] = React.useState(null);\r\n\r\n  const handleClick = (event) => {\r\n    setAnchorEl(event.currentTarget);\r\n\r\n    //  if (typeName === \"SimpleDraft\"){\r\n    setTimeout(() => {\r\n      setEditorState(EditorState.forceSelection(editorState, editorState.getSelection()))\r\n    }, 0);\r\n    //   }\r\n\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setAnchorEl(null);\r\n\r\n\r\n    setTimeout(() => {\r\n\r\n      //     const a = EditorState.forceSelection(editorState, editorState.getSelection())\r\n      setEditorState(EditorState.forceSelection(editorState, editorState.getSelection()))\r\n    }, 0);\r\n\r\n\r\n  };\r\n\r\n  const open = Boolean(anchorEl);\r\n  const id = open ? 'simple-popover' : undefined;\r\n\r\n\r\n\r\n  const [tabValue, setTabValue] = React.useState(0);\r\n  const [dataArr, setDataArr] = useState(emojiArr)\r\n\r\n  const [emojiIndex, setEmojiIndex] = useState(0)\r\n\r\n\r\n  return (\r\n    <>\r\n\r\n\r\n      <IconButton size=\"small\" onClick={handleClick}\r\n\r\n        sx={{ ...(typeName !== \"SimpleDraft\") && { alignSelf: \"right\" } }}>\r\n\r\n        <EmojiEmotionsOutlined fontSize={typeName === \"SimpleDraft\" ? \"medium\" : \"large\"} />\r\n      </IconButton>\r\n\r\n      <Popover\r\n        id={id}\r\n        open={open}\r\n        anchorEl={anchorEl}\r\n        onClose={handleClose}\r\n        anchorOrigin={{\r\n          vertical: 'top',\r\n          horizontal: 'center',\r\n        }}\r\n        transformOrigin={{\r\n          vertical: 'bottom',\r\n          horizontal: 'center',\r\n\r\n        }}\r\n\r\n        sx={{ \"& .MuiPaper-root\": { height: \"300px\", width: isChrome ? \"28rem\" : \"33rem\", flexDirection: \"column\", display: \"flex\", overflow: \"hidden\" } }}\r\n      >\r\n        <Box style={{ width: \"100%\", height: \"10px\", display: \"block\", flexGrow: 1, wordBreak: \"break-all\", overflow: \"auto\" }} >\r\n          {\r\n            dataArr.map((item, index) => {\r\n              if (index !== emojiIndex) { return <React.Fragment key={index}></React.Fragment> }\r\n\r\n              let match;\r\n              const arr = [];\r\n              while (match = emojiRegex.exec(item.symbolStr)) {\r\n                const emoji = match[0];\r\n                arr.push(emoji)\r\n\r\n              }\r\n\r\n              return (\r\n                <React.Fragment key={index}>\r\n                  {/* <Typography variant=\"body2\" sx={{ fontSize: theme.sizeObj }}>dfsdf</Typography> */}\r\n                  {arr.map((item, index) => {\r\n\r\n                    return (\r\n                      <IconButton key={index}\r\n                        sx={{ fontSize: \"2rem\" }}\r\n\r\n                        onMouseDown={function () {\r\n                          insertEmoji(item)\r\n                        }}\r\n\r\n                      // className={allClassNames}\r\n                      // onClick={function () {\r\n                      //   if (index > 0) {\r\n                      //     setDataArr(pre => {\r\n                      //       pre[0].symbolStr = pre[0].symbolStr.replace(item + \" \", \"\")\r\n                      //       pre[0].symbolStr = item + \" \" + pre[0].symbolStr\r\n                      //       if (ctx) { setEmojiCtxStr(pre[0].symbolStr) }\r\n                      //       return pre\r\n                      //     })\r\n                      //   }\r\n                      //   insertEmoji(item)\r\n                      // }}\r\n                      >\r\n                        {item}\r\n                      </IconButton>\r\n                    )\r\n                  })}\r\n\r\n                </React.Fragment >\r\n              )\r\n            })\r\n          }\r\n        </Box>\r\n\r\n        <Divider />\r\n\r\n        <Stack direction=\"row\" style={{}}>\r\n          {dataArr.map((item, index) => {\r\n\r\n            return <IconButton key={index} sx={{ fontSize: \"2rem\", width: \"2.5rem\", height: \"2.5rem\" }}\r\n              onClick={function () {\r\n                setEmojiIndex(index)\r\n              }}\r\n            >\r\n              {item.category}\r\n            </IconButton>\r\n          })}\r\n        </Stack>\r\n\r\n\r\n      </Popover>\r\n\r\n    </>\r\n  )\r\n\r\n\r\n}\r\n\r\n\r\n","import React, { useState, useRef, useEffect } from 'react';\r\n\r\nimport { EditorState, KeyBindingUtil, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, SelectionState, CharacterMetadata } from 'draft-js';\r\n\r\nimport EmojiPanel from \"./EmojiPanel\";\r\n\r\n\r\n\r\nexport default function createImagePlugin() {\r\n\r\n  let editorState = null\r\n  let setEditorState = null\r\n  let newContent = null\r\n\r\n\r\n  function emojiStrategy(contentBlock, callback, contentState) {\r\n\r\n    contentBlock.findEntityRanges(\r\n      function (character) {\r\n        const entityKey = character.getEntity();\r\n        return (\r\n          entityKey !== null &&\r\n          contentState.getEntity(entityKey).getType() === \"EMOJI\"\r\n\r\n        );\r\n      },\r\n      callback\r\n    );\r\n  };\r\n\r\n  function taggingEmoji() {\r\n\r\n\r\n\r\n    const oldSelection = editorState.getSelection();\r\n    newContent = editorState.getCurrentContent();\r\n    let newSelection = editorState.getSelection();\r\n\r\n\r\n\r\n    editorState = EditorState.push(editorState, newContent, \"apply-entity\");\r\n    editorState = EditorState.acceptSelection(editorState, oldSelection);\r\n    return editorState\r\n  }\r\n\r\n  function Emoji(props) {\r\n\r\n    return props.children\r\n  }\r\n\r\n  function insertEmoji(text) {\r\n\r\n    const [anchorKey, anchorOffset, focusKey, focusOffset, isBackward, hasfocus] = editorState.getSelection().toArray()\r\n    const [anchorStartKey, anchorStartOffset, anchorFocusKey, anchorFocusOffset, isAnchorBackward, isAnchorFocused]\r\n      = [!isBackward ? anchorKey : focusKey, !isBackward ? anchorOffset : focusOffset, isBackward ? anchorKey : focusKey, isBackward ? anchorOffset : focusOffset,]\r\n\r\n\r\n    let newContent = Modifier.replaceText(\r\n      editorState.getCurrentContent(),\r\n      editorState.getSelection(),\r\n      text,\r\n    )\r\n\r\n\r\n    let newSelection = editorState.getSelection().merge({\r\n\r\n      anchorKey: anchorStartKey,\r\n      anchorOffset: anchorStartOffset + text.length,\r\n      focusKey: anchorStartKey,\r\n      focusOffset: anchorStartOffset + text.length,\r\n      isBackward: false,\r\n      hasFocus: true,\r\n    })\r\n\r\n    editorState = EditorState.push(editorState, newContent, \"insert-characters\");\r\n    editorState = EditorState.acceptSelection(editorState, newSelection)\r\n\r\n    setEditorState(editorState)\r\n\r\n    // setTimeout(() => {\r\n    //   editorState = EditorState.push(editorState, newContent, \"insert-characters\");\r\n    //   editorState = EditorState.forceSelection(editorState, newSelection)\r\n    //   setEditorState(editorState)\r\n    // }, 0);\r\n\r\n  }\r\n\r\n  function setFocus(editorState) {\r\n\r\n\r\n\r\n    setTimeout(() => {\r\n\r\n      editorState = EditorState.forceSelection(editorState, editorState.getSelection())\r\n      setEditorState(editorState)\r\n    }, 0);\r\n  }\r\n\r\n\r\n\r\n  function EmojiComp({ editorRef, typeName, ...props }) {\r\n\r\n    return <EmojiPanel insertEmoji={insertEmoji} editorRef={editorRef} setFocus={setFocus} typeName={typeName} />\r\n\r\n\r\n  }\r\n\r\n\r\n\r\n  return {\r\n\r\n    emojiPlugin: {\r\n\r\n      onChange: function (newState, { setEditorState: setEditorState_ }) {\r\n        editorState = newState\r\n        setEditorState = setEditorState_\r\n        newContent = newState.getCurrentContent()\r\n\r\n        //  editorState = taggingEmoji()\r\n\r\n        return editorState\r\n      },\r\n      decorators: [{\r\n\r\n        strategy: emojiStrategy,\r\n        component: Emoji\r\n      }],\r\n\r\n    },\r\n    EmojiComp,\r\n\r\n\r\n\r\n  }\r\n}","export const createImage = (url) =>\r\n  new Promise((resolve, reject) => {\r\n    const image = new Image()\r\n    image.addEventListener('load', () => resolve(image))\r\n    image.addEventListener('error', (error) => reject(error))\r\n    image.setAttribute('crossOrigin', 'anonymous') // needed to avoid cross-origin issues on CodeSandbox\r\n    image.src = url\r\n  })\r\n\r\nexport function getRadianAngle(degreeValue) {\r\n  return (degreeValue * Math.PI) / 180\r\n}\r\n\r\n/**\r\n * Returns the new bounding area of a rotated rectangle.\r\n */\r\nexport function rotateSize(width, height, rotation) {\r\n  const rotRad = getRadianAngle(rotation)\r\n\r\n  return {\r\n    width:\r\n      Math.abs(Math.cos(rotRad) * width) + Math.abs(Math.sin(rotRad) * height),\r\n    height:\r\n      Math.abs(Math.sin(rotRad) * width) + Math.abs(Math.cos(rotRad) * height),\r\n  }\r\n}\r\n\r\n/**\r\n * This function was adapted from the one in the ReadMe of https://github.com/DominicTobias/react-image-crop\r\n */\r\nexport default async function getCroppedImg(\r\n  imageSrc,\r\n  pixelCrop,\r\n  rotation = 0,\r\n  flip = { horizontal: false, vertical: false }\r\n) {\r\n  const image = await createImage(imageSrc)\r\n  const canvas = document.createElement('canvas')\r\n  const ctx = canvas.getContext('2d')\r\n\r\n  if (!ctx) {\r\n    return null\r\n  }\r\n\r\n  const rotRad = getRadianAngle(rotation)\r\n\r\n  // calculate bounding box of the rotated image\r\n  const { width: bBoxWidth, height: bBoxHeight } = rotateSize(\r\n    image.width,\r\n    image.height,\r\n    rotation\r\n  )\r\n\r\n  // set canvas size to match the bounding box\r\n  canvas.width = bBoxWidth\r\n  canvas.height = bBoxHeight\r\n\r\n  // translate canvas context to a central location to allow rotating and flipping around the center\r\n  ctx.translate(bBoxWidth / 2, bBoxHeight / 2)\r\n  ctx.rotate(rotRad)\r\n  ctx.scale(flip.horizontal ? -1 : 1, flip.vertical ? -1 : 1)\r\n  ctx.translate(-image.width / 2, -image.height / 2)\r\n\r\n  // draw rotated image\r\n  ctx.drawImage(image, 0, 0)\r\n\r\n  // croppedAreaPixels values are bounding box relative\r\n  // extract the cropped image using these values\r\n  const data = ctx.getImageData(\r\n    pixelCrop.x,\r\n    pixelCrop.y,\r\n    pixelCrop.width,\r\n    pixelCrop.height\r\n  )\r\n\r\n  // set canvas width to final desired crop size - this will clear existing context\r\n  let picW = pixelCrop.width\r\n  let picH = pixelCrop.height\r\n\r\n  // const dimension = 600\r\n\r\n  // if (pixelCrop.width * pixelCrop.height >= dimension * dimension) {\r\n\r\n  //   if (pixelCrop.width >= pixelCrop.height) {\r\n\r\n  //     picW = dimension\r\n  //     picH = pixelCrop.height * (dimension / pixelCrop.width)\r\n  //   }\r\n  //   else {\r\n  //     picH = dimension\r\n  //     picW = pixelCrop.width * (dimension / pixelCrop.height)\r\n  //   }\r\n\r\n  // }\r\n\r\n\r\n\r\n\r\n  canvas.width = picW\r\n  canvas.height = picH\r\n\r\n  // paste generated rotate image at the top left corner\r\n  ctx.putImageData(data, 0, 0)\r\n\r\n  // As Base64 string\r\n  // return canvas.toDataURL('image/jpeg');\r\n\r\n  // As a blob\r\n  return new Promise((resolve, reject) => {\r\n\r\n    canvas.toBlob((file) => {\r\n      //  console.log(file)\r\n      resolve(URL.createObjectURL(file))\r\n    }, 'image/jpeg')\r\n  })\r\n}","import React, { useEffect, useState, useRef, useMemo, useContext, useCallback } from 'react';\r\nimport { EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, AtomicBlockUtils } from 'draft-js';\r\n\r\nimport { ThemeProvider, useTheme, createTheme } from '@mui/material/styles';\r\n// import { makeStyles, useTheme } from '@material-ui/core/styles';\r\n// import ImageList from '@material-ui/core/ImageList';\r\n// import ImageListItem from '@material-ui/core/ImageListItem';\r\n// import AddIcon from '@material-ui/icons/Add';\r\n// import DeleteIcon from '@material-ui/icons/Close';\r\n// import KeyboardArrowDownIcon from '@material-ui/icons/KeyboardArrowDown';\r\n// import { EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, AtomicBlockUtils } from 'draft-js';\r\n\r\n\r\n// import KeyboardArrowUpIcon from '@material-ui/icons/KeyboardArrowUp';\r\n\r\n// import KeyboardArrowLeftIcon from '@material-ui/icons/KeyboardArrowLeft';\r\n\r\n// import KeyboardArrowRightIcon from '@material-ui/icons/KeyboardArrowRight';\r\n\r\n// import useResizeObserver from '@react-hook/resize-observer';\r\n// import { IconButton, Zoom } from '@material-ui/core';\r\nimport { Container, Grid, Paper, IconButton, ButtonGroup, Stack, Box, Button, Typography, Slider, } from '@mui/material';\r\nimport { KeyboardArrowUpIcon } from \"@mui/icons-material\"\r\n\r\nimport { Context } from \"./ContextProvider\";\r\nimport Cropper from 'react-easy-crop';\r\nimport getCroppedImg from './cropImage';\r\n\r\nimport { Crop, DoneRounded, Close, AddCircleOutline } from '@mui/icons-material';\r\n\r\n\r\nimport useResizeObserver from '@react-hook/resize-observer';\r\n\r\nconst useSize = (target) => {\r\n  const [size, setSize] = React.useState()\r\n  React.useLayoutEffect(() => {\r\n    setSize(target.current.getBoundingClientRect())\r\n  }, [target])\r\n  // Where the magic happens\r\n  useResizeObserver(target, (entry) => setSize(entry.contentRect))\r\n  return size\r\n}\r\n\r\n\r\nconst arr = [\r\n  [\r\n    { gridColumn: \"1/3\", gridRow: \"1/3\" }\r\n  ],\r\n  [\r\n    { gridColumn: \"1/2\", gridRow: \"1/3\" },\r\n    { gridColumn: \"2/3\", gridRow: \"1/3\" },\r\n  ],\r\n  [\r\n    // { gridColumn: \"1/2\", gridRow: \"1/3\" },\r\n    // { gridColumn: \"2/3\", gridRow: \"1/2\" },\r\n    // { gridColumn: \"2/3\", gridRow: \"2/3\" },\r\n    { gridColumn: \"1/2\", gridRow: \"1/2\" },\r\n    { gridColumn: \"2/3\", gridRow: \"1/2\" },\r\n    { gridColumn: \"3/4\", gridRow: \"1/2\" },\r\n\r\n  ],\r\n  [\r\n    { gridColumn: \"1/2\", gridRow: \"1/2\" },\r\n    { gridColumn: \"2/3\", gridRow: \"1/2\" },\r\n    { gridColumn: \"1/2\", gridRow: \"2/3\" },\r\n    { gridColumn: \"2/3\", gridRow: \"2/3\" },\r\n  ]\r\n]\r\n\r\nexport default function ImageBlock({ ...props }) {\r\n\r\n\r\n  const theme = useTheme()\r\n\r\n  const { imageObj, setImageObj, editorState, setEditorState } = useContext(Context)\r\n  const { blockKey, markingImageBlock } = props.blockProps\r\n\r\n  const target = useRef(null)\r\n  const size = useSize(target)\r\n  const inputRef = useRef()\r\n  const numOfImage = Boolean(imageObj[blockKey]) ? imageObj[blockKey].length : 0\r\n\r\n  const height = useMemo(function () {\r\n    const width = size ? size.width : 0\r\n    return [width / 16 * 9, width / 16 * 9, width / 2, width / 3, width / 16 * 9][numOfImage]\r\n  }, [size, numOfImage])\r\n\r\n\r\n\r\n  const baseGrid = [\r\n    {\r\n      gridTemplateColumns: \"1fr\",\r\n      gridTemplateRows: \"1fr\",\r\n    },\r\n    {\r\n      gridTemplateColumns: \"1fr\",\r\n      gridTemplateRows: \"1fr\",\r\n    },\r\n    {\r\n      gridTemplateColumns: \"1fr 1fr\",\r\n      gridTemplateRows: \"1fr\",\r\n    },\r\n    {\r\n      gridTemplateColumns: \"1fr 1fr 1fr\",\r\n      gridTemplateRows: \"1fr 1fr\",\r\n    },\r\n    {\r\n      gridTemplateColumns: \"1fr 1fr\",\r\n      gridTemplateRows: \"1fr 1fr\",\r\n    },\r\n  ][numOfImage]\r\n\r\n\r\n\r\n\r\n  //const width = size ? size.width : 0\r\n  const imageHeight = size\r\n    ? [{ height: 0 }, { height: size.width / 16 * 9 }, { height: size.width / 2 }, { height: size.width / 3 }, { height: size.width / 16 * 9 / 2 }][numOfImage]\r\n    : { height: 0 }\r\n\r\n\r\n  const cssObj = {\r\n    display: 'grid',\r\n    ...baseGrid,\r\n    // gridTemplateColumns: \"1fr 1fr\",\r\n    // gridTemplateRows: \"1fr 1fr\",\r\n    gridGap: \"2px\",\r\n\r\n\r\n    //   marginTop: \"2px\",\r\n    //  marginBottom: \"2px\",\r\n    justifyContent: 'space-around',\r\n    overflow: 'hidden',\r\n\r\n    width: \"100%\",\r\n    height,\r\n\r\n\r\n    ...numOfImage > 0 && {\r\n      \"& > *:nth-type(1)\": {\r\n        position: \"relative\",\r\n        ...arr[numOfImage - 1][0],\r\n      }\r\n    },\r\n    ...numOfImage > 1 && {\r\n      \"& > *:nth-type(2)\": {\r\n        position: \"relative\",\r\n        backgroundColor: \"#ffa\",\r\n        ...arr[numOfImage - 1][1]\r\n      }\r\n    },\r\n    ...numOfImage > 2 && {\r\n      \"& > *:nth-type(3)\": {\r\n        position: \"relative\",\r\n        backgroundColor: \"#afa\",\r\n        ...arr[numOfImage - 1][2]\r\n      }\r\n    },\r\n    ...numOfImage > 3 && {\r\n      \"& > *:nth-type(4)\": {\r\n        position: \"relative\",\r\n        backgroundColor: \"#aaf\",\r\n        ...arr[numOfImage - 1][3]\r\n      }\r\n    },\r\n    ...numOfImage > 4 && {\r\n      \"& > *:nth-type( n + 5 )\": {\r\n        display: \"none\",\r\n      }\r\n    },\r\n\r\n  }\r\n\r\n\r\n\r\n\r\n  function update(e) {\r\n    e.preventDefault()\r\n    e.stopPropagation()\r\n    if (e.currentTarget.files[0].name.trim().match(/\\.(gif|jpe?g|tiff|png|webp|bmp)$/i)) {\r\n\r\n      const files = e.currentTarget.files\r\n     \r\n      const newFileArr = [\r\n        files[0] && URL.createObjectURL(files[0]),\r\n        files[1] && URL.createObjectURL(files[1]),\r\n        files[2] && URL.createObjectURL(files[2]),\r\n        files[3] && URL.createObjectURL(files[3]),\r\n\r\n      ]\r\n        .filter(item => Boolean(item))\r\n        .filter((item, index) => { return index < 4 })\r\n        .map(file => {\r\n       \r\n          return { imgId: Math.random(), imgUrl: file, imgSnap: file, isEditing: false }\r\n        })\r\n\r\n      setImageObj(pre => {\r\n        const preBlock = pre[blockKey] ? pre[blockKey] : []\r\n\r\n        return {\r\n          ...pre,\r\n          [blockKey]: [...preBlock, ...newFileArr],\r\n\r\n        }\r\n\r\n      })\r\n\r\n\r\n      //console.log(imageObj)\r\n\r\n    }\r\n\r\n\r\n  }\r\n\r\n\r\n\r\n  return (\r\n\r\n    <>\r\n\r\n      <input ref={inputRef} type=\"file\" multiple={true} style={{ display: \"none\" }}  accept=\"image/*\"\r\n        onClick={function (e) { e.currentTarget.value = null; }}\r\n        onChange={update}\r\n      />\r\n\r\n      <Box sx={{ //backgroundColor: \"wheat\", \r\n        width: \"100%\", position: \"relative\",\r\n        ...numOfImage === 0 && {\r\n          backgroundColor: theme.palette.mode === \"light\" ? \"lightgray\" : \"darkgray\",\r\n\r\n          // transform: \"scale(1)\",\r\n          // boxShadow: 0,\r\n          // \"&:hover\": {\r\n          //   transform: \"scale(1.03)\",\r\n          //   boxShadow: 3,\r\n          // },\r\n          // transition: \"box-shadow,transform, 300ms\"\r\n        }\r\n      }}>\r\n        <Box contentEditable={false} sx={cssObj} ref={target} >\r\n\r\n          {numOfImage >= 1 && numOfImage < 4 && <IconButton sx={{\r\n            fontSize: \"2rem\", width: \"2.5rem\", height: \"2.5rem\",\r\n            position: \"absolute\", right: 0, transform: \"translateX(100%)\",\r\n\r\n            zIndex: 80,\r\n          }}\r\n            size=\"small\"\r\n            contentEditable={false} suppressContentEditableWarning={true}\r\n            onClick={function () {\r\n              if ((!imageObj[blockKey]) || imageObj[blockKey].length < 4) {\r\n                inputRef.current.click()\r\n              }\r\n            }}\r\n          >\r\n            <AddCircleOutline fontSize=\"large\" sx={{ \"&:hover\": { bgcolor: \"rgba(255,255,255,0.5)\", borderRadius: \"1000px\" } }} />\r\n          </IconButton>\r\n          }\r\n\r\n          {numOfImage === 0 && <IconButton sx={{\r\n            fontSize: \"2rem\", width: \"2.5rem\", height: \"2.5rem\",\r\n            position: \"absolute\", left: \"50%\", top: \"50%\", transform: \"translateX(-50%) translateY(-50%) scale(3)\",\r\n\r\n            zIndex: 80,\r\n          }}\r\n            size=\"small\"\r\n            contentEditable={false} suppressContentEditableWarning={true}\r\n            onClick={function () {\r\n              if ((!imageObj[blockKey]) || imageObj[blockKey].length < 4) {\r\n                inputRef.current.click()\r\n              }\r\n            }}\r\n          >\r\n            <AddCircleOutline fontSize=\"large\" sx={{ \"&:hover\": { bgcolor: \"rgba(255,255,255,0.5)\", borderRadius: \"1000px\" } }} />\r\n          </IconButton>\r\n          }\r\n\r\n\r\n\r\n          {numOfImage === 0 && <IconButton sx={{\r\n            fontSize: \"2rem\", width: \"2.5rem\", height: \"2.5rem\",\r\n            position: \"absolute\", right: 0, // transform: \"translateX(180%)\",\r\n\r\n            zIndex: 80,\r\n          }}\r\n            size=\"small\"\r\n            contentEditable={false} suppressContentEditableWarning={true}\r\n            onClick={function () {\r\n\r\n              markingImageBlock(blockKey, true)\r\n              setImageObj(pre => {\r\n\r\n                delete pre[blockKey]\r\n                return { ...pre }\r\n\r\n              })\r\n              // setTimeout(() => {\r\n              //   setEditorState(EditorState.forceSelection(editorState, editorState.getSelection()))\r\n              // }, 1000);\r\n\r\n\r\n            }}\r\n          >\r\n            <Close fontSize=\"large\" sx={{ \"&:hover\": { bgcolor: \"rgba(255,255,255,0.5)\", borderRadius: \"1000px\" } }} />\r\n          </IconButton>\r\n          }\r\n\r\n\r\n\r\n\r\n\r\n          {Array.isArray(imageObj[blockKey]) && imageObj[blockKey].map((item, index) => {\r\n\r\n            return (\r\n\r\n              <React.Fragment key={index}>\r\n                <Box style={{\r\n                  // backgroundColor: \"pink\",\r\n                  width: \"100%\",\r\n                  ...imageHeight,\r\n                  display: \"block\",\r\n                  position: \"relative\"\r\n                }}\r\n                  key={index}\r\n                >\r\n                  {item.isEditing\r\n                    ? <ImageAdjuster\r\n                      imageUrl={item.imgUrl} imageSnap={item.imgSnap} imageId={item.imgId} image={item.imgSnap}\r\n                      imageId={item.imgId}\r\n                      blockKey={blockKey} numOfImage={numOfImage}\r\n                    />\r\n                    : <ImageSnap imageUrl={item.imgUrl} imageSnap={item.imgSnap} imageId={item.imgId} image={item.imgSnap}\r\n                      imageId={item.imgId}\r\n                      blockKey={blockKey}\r\n                      numOfImage={numOfImage}\r\n                    />\r\n                  }\r\n                </Box>\r\n              </React.Fragment>\r\n\r\n\r\n            )\r\n          })}\r\n\r\n      \r\n        </Box>\r\n      </Box >\r\n    </>\r\n  )\r\n\r\n}\r\n\r\n\r\nfunction ImageSnap({ imageUrl, imageId, imageSnap, blockKey, numOfImage, ...props }) {\r\n\r\n  const { imageObj, setImageObj } = useContext(Context)\r\n\r\n  function setIsEidting() {\r\n\r\n    setImageObj(pre => {\r\n\r\n\r\n      const arr = pre[blockKey].map(item => {\r\n        if (item.imgId !== imageId) {\r\n          return item\r\n        }\r\n        else {\r\n          return { ...item, isEditing: true }\r\n        }\r\n      })\r\n\r\n      return { ...pre, [blockKey]: arr }\r\n\r\n    })\r\n  }\r\n\r\n  function closeImage() {\r\n\r\n    setImageObj(pre => {\r\n      const arr = pre[blockKey].filter(item => {\r\n        return item.imgId !== imageId\r\n      })\r\n      return { ...pre, [blockKey]: arr }\r\n    })\r\n\r\n  }\r\n\r\n\r\n\r\n  return (\r\n    <>\r\n      <IconButton sx={{\r\n        fontSize: \"2rem\", width: \"2.5rem\", height: \"2.5rem\",\r\n        position: \"absolute\", left: 0,\r\n        zIndex: 80,\r\n        bgcolor: \"rgba(255,255,255,0.3)\"\r\n      }}\r\n        size=\"small\"\r\n        contentEditable={false} suppressContentEditableWarning={true}\r\n        onClick={function () {\r\n          //   alert(\"Fdsf\")\r\n          setIsEidting()\r\n          // showCroppedImage()\r\n        }}\r\n      >\r\n        <Crop fontSize=\"large\" sx={{ \"&:hover\": { bgcolor: \"rgba(255,255,255,0.5)\", borderRadius: \"1000px\" } }} />\r\n      </IconButton>\r\n\r\n      <IconButton sx={{\r\n        fontSize: \"2rem\", width: \"2.5rem\", height: \"2.5rem\",\r\n        position: \"absolute\", right: 0,\r\n        zIndex: 80,\r\n        bgcolor: \"rgba(255,255,255,0.3)\"\r\n      }}\r\n        size=\"small\"\r\n\r\n        contentEditable={false} suppressContentEditableWarning={true}\r\n        onClick={function () {\r\n          closeImage()\r\n        }}\r\n \r\n      >\r\n        <Close fontSize=\"large\" sx={{ \"&:hover\": { bgcolor: \"rgba(255,255,255,0.5)\", borderRadius: \"1000px\" } }} />\r\n      </IconButton>\r\n\r\n\r\n\r\n\r\n      <img src={imageSnap} style={{ objectFit: \"cover\", width: \"100%\", height: \"100%\" }} />\r\n    </>\r\n  )\r\n\r\n}\r\n\r\n\r\nfunction ImageAdjuster({ imageUrl, imageId, imageSnap, blockKey, numOfImage, ...props }) {\r\n\r\n\r\n  const { imageObj, setImageObj } = useContext(Context)\r\n  const [crop, setCrop] = useState({ x: 0, y: 0 })\r\n  const [rotation, setRotation] = useState(0)\r\n  const [zoom, setZoom] = useState(1)\r\n  const [croppedAreaPixels, setCroppedAreaPixels] = useState(null)\r\n\r\n\r\n  const onCropComplete = useCallback((croppedArea, croppedAreaPixels) => {\r\n    setCroppedAreaPixels(croppedAreaPixels)\r\n  }, [])\r\n\r\n  const aspectArr = [1 / 1, 16 / 9, 1 / 1, 1 / 1, 16 / 9]\r\n\r\n\r\n\r\n  async function setIsEidting() {\r\n\r\n    const croppedImage = await getCroppedImg(\r\n      // dogImg,\r\n      imageUrl,\r\n      croppedAreaPixels,\r\n      rotation,\r\n    )\r\n\r\n    setImageObj(pre => {\r\n\r\n\r\n      const arr = pre[blockKey].map(item => {\r\n        if (item.imgId !== imageId) {\r\n          return item\r\n        }\r\n        else { return { ...item, isEditing: false, imgSnap: croppedImage } }\r\n         \r\n       \r\n      })\r\n\r\n      return { ...pre, [blockKey]: arr }\r\n\r\n    })\r\n  }\r\n\r\n  function closeImage() {\r\n\r\n    setImageObj(pre => {\r\n      const arr = pre[blockKey].filter(item => {\r\n        return item.imgId !== imageId\r\n      })\r\n      return { ...pre, [blockKey]: arr }\r\n    })\r\n\r\n  }\r\n\r\n\r\n\r\n  return (\r\n\r\n    <>\r\n\r\n      <IconButton sx={{\r\n        fontSize: \"2rem\", width: \"2.5rem\", height: \"2.5rem\",\r\n        position: \"absolute\", left: 0,\r\n        zIndex: 80,\r\n        bgcolor: \"rgba(255,255,255,0.3)\"\r\n      }}\r\n        size=\"small\"\r\n\r\n        contentEditable={false} suppressContentEditableWarning={true}\r\n        onClick={function () {\r\n          setIsEidting()\r\n          // showCroppedImage()\r\n        }}\r\n\r\n      >\r\n\r\n        <DoneRounded fontSize=\"large\" sx={{ \"&:hover\": { bgcolor: \"rgba(255,255,255,0.5)\", borderRadius: \"1000px\" } }} />\r\n\r\n\r\n\r\n      </IconButton>\r\n\r\n      <IconButton sx={{\r\n        fontSize: \"2rem\", width: \"2.5rem\", height: \"2.5rem\",\r\n        position: \"absolute\", right: 0,\r\n        zIndex: 80,\r\n        bgcolor: \"rgba(255,255,255,0.3)\"\r\n      }}\r\n        size=\"small\"\r\n\r\n        contentEditable={false} suppressContentEditableWarning={true}\r\n        onClick={function () {\r\n          closeImage()\r\n        }}\r\n\r\n      >\r\n        <Close fontSize=\"large\" sx={{ \"&:hover\": { bgcolor: \"rgba(255,255,255,0.5)\", borderRadius: \"1000px\" } }} />\r\n      </IconButton>\r\n\r\n      <Cropper image={imageUrl}  //\"https://img.huffingtonpost.com/asset/5ab4d4ac2000007d06eb2c56.jpeg?cache=sih0jwle4e&ops=1910_1000\"\r\n        aspect={aspectArr[numOfImage]}\r\n        crop={crop}\r\n        rotation={rotation}\r\n        zoom={zoom}\r\n\r\n        onCropChange={setCrop}\r\n        onRotationChange={setRotation}\r\n        onCropComplete={onCropComplete}\r\n        onZoomChange={setZoom}\r\n      />\r\n\r\n      {/* <Typography\r\n        sx={{ position: \"absolute\", bottom: 0 }}\r\n      // variant=\"overline\"\r\n      // classes={{ root: classes.sliderLabel }}\r\n      >Zoom\r\n      </Typography> */}\r\n      <Slider\r\n        size=\"medium\"\r\n        value={zoom}\r\n        min={1}\r\n        max={3}\r\n        step={0.1}\r\n        aria-labelledby=\"Zoom\"\r\n        //  classes={{ root: classes.slider }}\r\n        onChange={(e, zoom) => setZoom(zoom)}\r\n        sx={{\r\n          //  padding: '22px 0px',\r\n          //  marginLeft: \"\",\r\n          marginLeft: \"20px\",\r\n          marginRight: \"20px\",\r\n          position: \"absolute\",\r\n          bottom: 0,\r\n          left: 0,\r\n          right: 0,\r\n          margin: \"auto\",\r\n          width: \"90%\",\r\n          color: \"skyblue\",\r\n\r\n        }}\r\n      />\r\n\r\n\r\n    </>\r\n  )\r\n\r\n}","\r\n\r\nimport { useContext } from 'react';\r\nimport { EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, AtomicBlockUtils } from 'draft-js';\r\nimport { Container, Grid, Paper, Typography, Box, Avatar } from '@mui/material';\r\nimport PeopleList from './PeopleList';\r\n\r\n//import multiavatar from '@multiavatar/multiavatar';\r\nimport { Context } from \"./ContextProvider\"\r\nimport { useTheme } from '@mui/private-theming';\r\n\r\nimport { AvatarChip } from \"./PeopleList\";\r\n\r\n\r\nexport default function createLinkPlugin() {\r\n\r\n  let editorState = null\r\n  let setEditorState = null\r\n  let newContent = null\r\n  const entityKeyObj = {}\r\n\r\n\r\n  let tagStartPos = 0\r\n  let tagEndPos = 0\r\n\r\n  function linkStrategy(contentBlock, callback, contentState) {\r\n    contentBlock.findEntityRanges(\r\n      function (character) {\r\n        const entityKey = character.getEntity();\r\n        return entityKey !== null && contentState.getEntity(entityKey).getType().indexOf(\"linkTag\") >= 0\r\n      },\r\n      callback\r\n    );\r\n  }\r\n\r\n  //  function LinkComp() { return <h1>aaa</h1> }\r\n\r\n  function conditionWrap({ editorState, searchAllBlock = true }) {\r\n\r\n    return searchAllBlock\r\n      ? editorState.getCurrentContent().getBlockMap()\r\n      : [editorState.getCurrentContent().getBlockForKey(editorState.getSelection().getStartKey())]\r\n\r\n  }\r\n\r\n  function taggingLink() {\r\n    const [anchorKey, anchorOffset, focusKey, focusOffset, isBackward, hasfocus] = editorState.getSelection().toArray()\r\n    const [anchorStartKey, anchorStartOffset, anchorFocusKey, anchorFocusOffset, isAnchorBackward, isAnchorFocused]\r\n      = [!isBackward ? anchorKey : focusKey, !isBackward ? anchorOffset : focusOffset, isBackward ? anchorKey : focusKey, isBackward ? anchorOffset : focusOffset,]\r\n    const regx = /\\s([a-zA-Z]{1,10}:\\/\\/)(([a-zA-Z0-9-_]+\\.?)+(:\\d{0,6})?)(\\/[^\\s\\r\\n\\/]+){0,7}(\\/)?/g\r\n\r\n    const oldSelection = editorState.getSelection();\r\n    let newContent = editorState.getCurrentContent();\r\n    let newSelection = editorState.getSelection();\r\n\r\n    conditionWrap({ editorState, searchAllBlock: true }).forEach(function (block) {\r\n\r\n      const blockKey = block.getKey()\r\n      const blockText = block.getText()\r\n      const metaArr = block.getCharacterList()\r\n\r\n      metaArr.forEach(function (item, index) {\r\n        const styleArr = item.getStyle().toArray()\r\n     \r\n\r\n        if (styleArr && styleArr.length > 0) {\r\n          if (styleArr.includes(\"linkTagOn\") || styleArr.includes(\"linkTagOff\")) {\r\n            newSelection = newSelection.merge({\r\n              anchorKey: blockKey,\r\n              anchorOffset: index,\r\n              focusKey: blockKey,\r\n              focusOffset: index + 1,\r\n              isBackward: false,\r\n              hasFocus: false,\r\n            })\r\n            newContent = Modifier.removeInlineStyle(newContent, newSelection, \"linkTagOn\")\r\n            newContent = Modifier.removeInlineStyle(newContent, newSelection, \"linkTagOff\")\r\n          }\r\n        }\r\n      })\r\n\r\n      let matchArr;\r\n      while ((matchArr = regx.exec(blockText)) !== null) {\r\n\r\n        const start = matchArr.index;\r\n        const end = matchArr.index + matchArr[0].length;\r\n        const contentLenth = end - start;\r\n        const contentFocusAt = anchorFocusOffset - start;\r\n\r\n        const mentionOn = hasfocus && (blockKey === anchorFocusKey) && (contentFocusAt > 0) && (contentFocusAt <= contentLenth)\r\n        const mentionOff = !mentionOn\r\n\r\n        if (mentionOn) {\r\n\r\n          tagStartPos = start\r\n          tagEndPos = end\r\n\r\n          newSelection = newSelection.merge({\r\n            anchorKey: blockKey,\r\n            focusKey: blockKey,\r\n            anchorOffset: start + 1,\r\n            focusOffset: end,//  start + 2,\r\n            isBackward: false,\r\n            hasFocus: false,\r\n          })\r\n          newContent = Modifier.applyInlineStyle(newContent, newSelection, \"linkTagOn\")\r\n        }\r\n        else if (mentionOff) {\r\n          tagStartPos = start\r\n          tagEndPos = end\r\n\r\n          newSelection = newSelection.merge({\r\n            anchorKey: blockKey,\r\n            focusKey: blockKey,\r\n            anchorOffset: start + 1,\r\n            focusOffset: end,//start + 2,\r\n            isBackward: false,\r\n            hasFocus: false,\r\n          })\r\n          newContent = Modifier.applyInlineStyle(newContent, newSelection, \"linkTagOff\")\r\n        }\r\n      }\r\n    })\r\n\r\n    editorState = EditorState.push(editorState, newContent, \"change-inline-style\");\r\n    editorState = EditorState.acceptSelection(editorState, oldSelection);\r\n    return editorState\r\n\r\n  }\r\n\r\n\r\n  return {\r\n\r\n\r\n    linkPlugin: {\r\n\r\n      onChange: function (newState, { setEditorState: setEditorState_ }) {\r\n        //   alert(\"Ff\")\r\n        editorState = newState\r\n        setEditorState = setEditorState_\r\n        newContent = newState.getCurrentContent()\r\n\r\n        editorState = taggingLink()\r\n        return editorState\r\n      },\r\n\r\n\r\n      // decorators: [\r\n      //   {\r\n      //     strategy: linkStrategy,\r\n      //     component: LinkComp,\r\n      //   }\r\n      // ],\r\n\r\n    }\r\n  }\r\n}\r\n\r\n\r\n\r\n","import React, { useEffect, useState, useRef, useMemo, useContext, useCallback } from 'react';\r\nimport { EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, AtomicBlockUtils } from 'draft-js';\r\n\r\nimport { ThemeProvider, useTheme, createTheme } from '@mui/material/styles';\r\n\r\nimport { Container, Grid, Paper, IconButton, ButtonGroup, Stack, Box, Button, Typography, Slider, TextField, Select, Popover, MenuItem, FormControl, InputLabel, FormHelperText } from '@mui/material';\r\nimport { HourglassBottomRounded, KeyboardArrowUpIcon } from \"@mui/icons-material\"\r\n\r\nimport { Context } from \"./ContextProvider\";\r\nimport Cropper from 'react-easy-crop';\r\nimport getCroppedImg from './cropImage';\r\n\r\nimport { Crop, DoneRounded, Close, AddCircleOutline, RemoveCircleOutline, } from '@mui/icons-material';\r\n\r\n\r\nimport useResizeObserver from '@react-hook/resize-observer';\r\n\r\n// Array.prototype.insert = function (index, item) {\r\n//   this.splice(index, 0, item);\r\n//   return this\r\n// };  //NEVER declear or USE IT , CONFLICT WITH mulitavatar !!!\r\n\r\n\r\nexport default function VoteBlock(props) {\r\n\r\n\r\n  const theme = useTheme()\r\n  const { editorState, setEditorState, voteArr, setVoteArr, voteTopic, setVoteTopic } = useContext(Context)\r\n\r\n  const { readOnly, setReadOnly, markingVoteBlock } = props.blockProps\r\n\r\n  useEffect(function () {\r\n    if (voteArr.length === 0) {\r\n      setVoteArr([\"\"])\r\n    }\r\n\r\n\r\n  }, [])\r\n\r\n\r\n  return (\r\n    <Box sx={{\r\n      // bgcolor: \"pink\", \r\n      display: \"flex\", justifyContent: \"flex-start\", flexDirection: \"column\",\r\n      alignItems: \"flex-start\",\r\n      gap: \"8px\",\r\n\r\n\r\n      backgroundColor: theme.palette.action.disabledBackground,\r\n\r\n      position: \"relative\",\r\n\r\n      \"& label\": { fontSize: theme.scaleSizeObj(0.8) },\r\n      \"& input\": { fontSize: theme.sizeObj },\r\n      \"& textarea\": { fontSize: theme.sizeObj },\r\n    }} >\r\n\r\n      <IconButton sx={{\r\n        fontSize: \"2rem\", width: \"2.5rem\", height: \"2.5rem\",\r\n        position: \"absolute\",\r\n        right: 0,\r\n        zIndex: 100,\r\n      }}\r\n        size=\"small\"\r\n        contentEditable={false} suppressContentEditableWarning={true}\r\n        onClick={function () {\r\n          markingVoteBlock(props.block.getKey(), true)\r\n        }}\r\n      >\r\n        <Close fontSize=\"large\" sx={{ \"&:hover\": { bgcolor: \"rgba(255,255,255,0.5)\", borderRadius: \"1000px\" } }} />\r\n      </IconButton>\r\n\r\n      <TextField contentEditable={false} suppressContentEditableWarning={true}\r\n        id=\"outlined-textarea\"\r\n        label={voteTopic ? \"\" : \"Eneter Topic\"}\r\n        multiline={true}\r\n        value={voteTopic}\r\n        onChange={function (e) {\r\n          setVoteTopic(e.target.value)\r\n        }}\r\n        placeholder=\"Enter Topic\"\r\n        sx={{\r\n          width: \"100%\",\r\n          bgcolor: theme.palette.background.default,\r\n          alignItems: \"center\",\r\n          \"& > div\": { width: \"100%\" },\r\n        }}\r\n        variant=\"filled\"\r\n        onFocus={function (e) {\r\n          setReadOnly(true)\r\n          const newSelection = editorState.getSelection().merge({\r\n            hasFocus: false,\r\n          })\r\n          setTimeout(function () {\r\n            setEditorState(EditorState.acceptSelection(editorState, newSelection))\r\n          }, 0)\r\n\r\n        }}\r\n        onBlur={function (e) {\r\n          setReadOnly(false)\r\n        }}\r\n      />\r\n\r\n      {voteArr.map(function (item, index, arr) {\r\n\r\n        return (\r\n          <Box sx={{\r\n            width: \"100%\", //bgcolor: \"orange\",\r\n            display: \"flex\", alignItems: \"center\",\r\n          }} key={index}>\r\n            <TextField contentEditable={false} suppressContentEditableWarning={true}\r\n              id={\"outlined-textarea\" + index}\r\n              label={\"Choice \" + (index + 1)}\r\n              onKeyDown={function (e) {\r\n\r\n                if (e.code === \"Enter\" || e.code === \"NumpadEnter\") {\r\n                  voteArr.splice(index + 1, 0, \"\")\r\n                  setVoteArr(pre => {\r\n                    return [...voteArr]\r\n                  })\r\n                  setTimeout(() => {\r\n                    document.getElementById(\"outlined-textarea\" + (index + 1)).focus()\r\n                  }, 0);\r\n                }\r\n                else if (e.code === \"ArrowUp\") {\r\n                  setTimeout(() => {\r\n                    document.getElementById(\"outlined-textarea\" + (Math.max(0, index - 1))).focus()\r\n                  }, 0);\r\n                }\r\n                else if (e.code === \"ArrowDown\") {\r\n                  setTimeout(() => {\r\n                    document.getElementById(\"outlined-textarea\" + (Math.min(voteArr.length - 1, index + 1))).focus()\r\n                  }, 0);\r\n                }\r\n                else if (e.code === \"Backspace\") {\r\n\r\n                  if ((!e.target.value) && (voteArr.length > 1)) {\r\n                    voteArr.splice(index, 1)\r\n                    setVoteArr(voteArr)\r\n                    setTimeout(() => {\r\n                      document.getElementById(\"outlined-textarea\" + (Math.max(0, index - 1))).focus()\r\n                    }, 0);\r\n                  }\r\n\r\n                }\r\n              }}\r\n              sx={{\r\n                width: \"90%\",\r\n                transform: \"translateX(8px)\",\r\n                //   bgcolor: \"skyblue\", \r\n                bgcolor: theme.palette.background.default,\r\n                alignItems: \"center\",\r\n                \"& > div\": { width: \"100%\" },\r\n\r\n\r\n              }}\r\n              placeholder={\"Choice \" + (index + 1)}\r\n              value={voteArr[index]}\r\n              onFocus={function (e) {\r\n                setReadOnly(true)\r\n                const newSelection = editorState.getSelection().merge({\r\n                  hasFocus: false,\r\n                })\r\n                setTimeout(function () {\r\n                  setEditorState(EditorState.acceptSelection(editorState, newSelection))\r\n                }, 0)\r\n\r\n              }}\r\n              onBlur={function (e) {\r\n                setReadOnly(false)\r\n              }}\r\n              onChange={function (e) {\r\n\r\n            \r\n                setVoteArr(pre => {\r\n                  pre[index] = e.target.value\r\n                  return [...pre]\r\n                })\r\n              }}\r\n            />\r\n\r\n            {voteArr.length !== 1 && <IconButton sx={{\r\n              fontSize: \"2rem\", width: \"2.5rem\", height: \"2.5rem\",\r\n              position: \"absolute\",\r\n              right: 0,\r\n            }}\r\n              disabled={voteArr.length <= 1}\r\n              size=\"small\"\r\n              contentEditable={false} suppressContentEditableWarning={true}\r\n              onClick={function () {\r\n\r\n                setVoteArr(pre => {\r\n                  return pre.filter((item, pos) => {\r\n                    return pos !== index\r\n                  })\r\n                })\r\n\r\n\r\n\r\n              }}\r\n            >\r\n\r\n              <RemoveCircleOutline fontSize=\"large\" sx={{ \"&:hover\": { bgcolor: \"rgba(255,255,255,0.5)\", borderRadius: \"1000px\" } }} />\r\n\r\n\r\n            </IconButton>\r\n            }\r\n\r\n            {voteArr.length - 1 === index &&\r\n              <IconButton sx={{\r\n                fontSize: \"2rem\", width: \"2.5rem\", height: \"2.5rem\",\r\n                //margin:\"auto auto\",\r\n\r\n                position: \"absolute\", right: 0,\r\n\r\n                transform: `translateX(${voteArr.length === 1 ? \"0\" : \"100%\"})`,\r\n\r\n\r\n              }}\r\n                size=\"small\"\r\n                contentEditable={false} suppressContentEditableWarning={true}\r\n                onClick={function () {\r\n                  setVoteArr(pre => {\r\n                    return [...pre, \"\"]\r\n                  })\r\n\r\n                }}\r\n              >\r\n                <AddCircleOutline fontSize=\"large\" sx={{ \"&:hover\": { bgcolor: \"rgba(255,255,255,0.5)\", borderRadius: \"1000px\" } }} />\r\n\r\n\r\n\r\n              </IconButton>\r\n            }\r\n\r\n          </Box>\r\n        )\r\n      })}\r\n\r\n      <TimeBar />\r\n\r\n\r\n\r\n    </Box >\r\n  )\r\n\r\n\r\n}\r\n\r\n\r\nfunction TimeBar() {\r\n\r\n  // const theme = useTheme()\r\n  const { pollDuration, setPollDuration } = useContext(Context)\r\n\r\n\r\n\r\n\r\n  return (\r\n\r\n\r\n\r\n\r\n    <Box sx={{\r\n      width: \"100%\", height: \"5rem\",\r\n      display: \"flex\",\r\n      justifyContent: \"space-around\", alignItems: \"center\",\r\n      overflow: \"hidden\",\r\n      transition: \"height, 300ms\",\r\n      // bgcolor: \"yellow\",\r\n      position: \"relative\",\r\n    }}>\r\n      <Typography variant='h6' sx={{\r\n        position: \"absolute\", transform: \"translateY(-50%)\",\r\n        right: 10, color: \"text.secondary\",\r\n\r\n      }}>Poll duration {`${pollDuration.d}d${pollDuration.h}h${pollDuration.m}m`}</Typography>\r\n      <Slider\r\n        size=\"medium\"\r\n        valueLabelDisplay=\"auto\"\r\n        //       value={zoom}\r\n        valueLabelFormat={function (numOfMins_) {\r\n          return numOfMins_ + \"days\"\r\n        }}\r\n        onChange={(e, value) => { setPollDuration(pre => { return { ...pre, d: value } }) }}\r\n        min={0}\r\n        max={7}\r\n        step={1}\r\n        marks={true}\r\n        value={pollDuration.d}\r\n        //   value={200}\r\n        aria-labelledby=\"Zoom\"\r\n        //  classes={{ root: classes.slider }}\r\n        //  onChange={(e, zoom) => setZoom(zoom)}\r\n        sx={{\r\n\r\n          m: \"auto, auto\",\r\n          width: \"20%\",\r\n          color: \"skyblue\",\r\n          transform: \"translateY(10px)\"\r\n\r\n        }}\r\n      />\r\n\r\n\r\n      <Slider\r\n        size=\"medium\"\r\n        valueLabelDisplay=\"auto\"\r\n        //       value={zoom}\r\n        valueLabelFormat={function (numOfMins_) {\r\n          return numOfMins_ + \" hours\"\r\n        }}\r\n        onChange={(e, value) => { setPollDuration(pre => { return { ...pre, h: value } }) }}\r\n        min={0}\r\n        max={23}\r\n        step={1}\r\n        marks={true}\r\n        value={pollDuration.h}\r\n        //   value={200}\r\n        aria-labelledby=\"Zoom\"\r\n        //  classes={{ root: classes.slider }}\r\n        //  onChange={(e, zoom) => setZoom(zoom)}\r\n        sx={{\r\n\r\n          m: \"auto, auto\",\r\n          width: \"30%\",\r\n          color: \"skyblue\",\r\n          transform: \"translateY(10px)\"\r\n\r\n        }}\r\n      />\r\n\r\n      <Slider\r\n        size=\"medium\"\r\n        valueLabelDisplay=\"auto\"\r\n        //       value={zoom}\r\n        valueLabelFormat={function (numOfMins_) {\r\n          return numOfMins_ + \"mins\"\r\n        }}\r\n        onChange={(e, value) => { setPollDuration(pre => { return { ...pre, m: value } }) }}\r\n        min={0}\r\n        max={59}\r\n        step={1}\r\n        marks={true}\r\n        value={pollDuration.m}\r\n        //   value={200}\r\n        aria-labelledby=\"Zoom\"\r\n        //  classes={{ root: classes.slider }}\r\n        //  onChange={(e, zoom) => setZoom(zoom)}\r\n        sx={{\r\n\r\n          m: \"auto, auto\",\r\n          width: \"40%\",\r\n          color: \"skyblue\",\r\n          transform: \"translateY(10px)\"\r\n\r\n        }}\r\n      />\r\n\r\n\r\n\r\n    </Box>\r\n  )\r\n\r\n\r\n\r\n}\r\n\r\n\r\nfunction removeItemOnce(arr, value) {\r\n  var index = arr.indexOf(value);\r\n  if (index > -1) {\r\n    arr.splice(index, 1);\r\n  }\r\n  return arr;\r\n}","import React, { useState, useRef, useEffect, useLayoutEffect, useContext, useCallback, createContext, useMemo } from 'react';\r\n\r\nimport { Context } from \"./ContextProvider\"\r\n\r\nimport {\r\n  EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw,\r\n  RichUtils, Modifier, convertFromHTML, AtomicBlockUtils, getDefaultKeyBinding, KeyBindingUtil\r\n} from 'draft-js';\r\n\r\nimport EditingBlock from \"./EditingBlock\"\r\n\r\n\r\nimport { Container, Grid, Paper, IconButton, ButtonGroup, Stack, Button, Switch, Box, Hidden } from '@mui/material';\r\nimport { ThemeProvider, useTheme, createTheme } from '@mui/material/styles';\r\n\r\nimport { EmojiEmotions, FormatSize, FormatAlignLeft, FormatAlignCenter, FormatAlignRight, StackedBarChart, HorizontalSplitOutlined } from '@mui/icons-material';\r\n\r\nimport { blue, red } from '@mui/material/colors';\r\n\r\nimport Editor from \"draft-js-plugins-editor\";\r\nimport Immutable from 'immutable';\r\n\r\nimport createMentionPlugin from './MentionPlugin';\r\nimport createPersonPlugin from './PersonPlugin';\r\n\r\nimport createEmojiPlugin from './EmojiPlugin';\r\nimport createImagePlugin from './ImagePlugin';\r\nimport createLinkPlugin from './LinkPlugin';\r\nimport createVotePlugin from './VotePlugin';\r\n\r\nimport axios from \"axios\";\r\nimport { url, toPreHtml } from \"./config\";\r\n\r\n//console.log(createVotePlugin())\r\n\r\nconst { hasCommandModifier } = KeyBindingUtil;\r\n\r\nconst { mentionPlugin, taggingMention, checkShowing } = createMentionPlugin()\r\nconst { personPlugin } = createPersonPlugin()\r\nconst { emojiPlugin, EmojiComp } = createEmojiPlugin()\r\nconst { imagePlugin, markingImageBlock, ImageBlock } = createImagePlugin()\r\nconst { linkPlugin } = createLinkPlugin()\r\nconst { votePlugin, markingVoteBlock, VoteBlock } = createVotePlugin()\r\n\r\n\r\nexport default function DraftEditor({ userName, ...props }) {\r\n\r\n  const theme = useTheme()\r\n  const { editorState, setEditorState, currentBlockKey, setCurrentBlockKey, imageObj, setImageObj, onSubmit } = useContext(Context)\r\n\r\n  const editorRef = useRef()\r\n\r\n  const frameRef = useRef()\r\n\r\n  const [shadowValue, setShadowValue] = useState(1)\r\n\r\n  // const [currentBlockKey, setCurrentBlockKey] = useState(null)\r\n  const specialBakcSpace = useRef(false)\r\n\r\n  // console.log(theme.isLight)\r\n\r\n  const [readOnly, setReadOnly] = useState(false)\r\n\r\n  const [postDisable, setPostDisable] = useState(false)\r\n\r\n\r\n  const [autoFocused, setAutoFocused] = useState(false)\r\n\r\n  useEffect(function () {\r\n\r\n\r\n    setTimeout(function () {\r\n\r\n      if (!autoFocused) {\r\n        setAutoFocused(true)\r\n        setEditorState(EditorState.forceSelection(editorState, editorState.getSelection()))\r\n\r\n      }\r\n\r\n    }, 0)\r\n\r\n  }, [editorState])\r\n\r\n  return (\r\n    <Box>\r\n      <Stack direction=\"row\" sx={{ //backgroundColor: theme.isLight ? \"rgba(167, 202, 237,1)\" : \"rgba(72, 101, 124,1)\",\r\n        position: \"sticky\", bottom: 0, justifyContent: \"space-between\"\r\n      }}>\r\n\r\n        <Stack direction=\"row\" sx={{ width: \"10px\", flexGrow: 1, /*bgcolor: \"pink\",*/ }}>\r\n          <Hidden smDown={true}>\r\n            <EmojiComp editorRef={editorRef} />\r\n          </Hidden>\r\n          <IconButton size=\"small\" onClick={function (e) {\r\n            e.preventDefault()\r\n            e.stopPropagation()\r\n\r\n\r\n            const blockType = editorState.getCurrentContent().getBlockForKey(currentBlockKey).getType()\r\n            if (blockType === \"imageBlock\") { return }\r\n\r\n\r\n            const data = editorState.getCurrentContent().getBlockForKey(currentBlockKey).getData().toObject()\r\n\r\n\r\n\r\n            const newContent = Modifier.setBlockData(\r\n              editorState.getCurrentContent(),\r\n              SelectionState.createEmpty(currentBlockKey),//  editorState.getSelection(), // SelectionState.createEmpty(currentBlockKey),\r\n              Immutable.Map({ isSmallFont: !Boolean(data.isSmallFont) })\r\n            )\r\n\r\n\r\n            const es = EditorState.push(editorState, newContent, 'change-block-data');\r\n            setEditorState(es)\r\n\r\n          }} >\r\n            <FormatSize fontSize=\"large\" />\r\n          </IconButton>\r\n\r\n\r\n          <IconButton size=\"small\" onClick={function () {\r\n            const es = RichUtils.toggleBlockType(\r\n              editorState, // write type to editorState\r\n              \"unstyled\"\r\n            )\r\n            setTimeout(() => {\r\n              setEditorState(EditorState.forceSelection(es, es.getSelection()))\r\n            }, 0);\r\n\r\n          }}>\r\n            <FormatAlignLeft fontSize=\"large\" />\r\n          </IconButton>\r\n\r\n          <IconButton size=\"small\" onClick={function () {\r\n            const es = RichUtils.toggleBlockType(\r\n              editorState, // write type to editorState\r\n              \"centerBlock\"\r\n            )\r\n            setTimeout(() => {\r\n              setEditorState(EditorState.forceSelection(es, es.getSelection()))\r\n            }, 0);\r\n          }}>\r\n            <FormatAlignCenter fontSize=\"large\" />\r\n          </IconButton>\r\n\r\n          <IconButton size=\"small\" onClick={function () {\r\n            const es = RichUtils.toggleBlockType(\r\n              editorState, // write type to editorState\r\n              \"rightBlock\"\r\n            )\r\n            setTimeout(() => {\r\n              setEditorState(EditorState.forceSelection(es, es.getSelection()))\r\n            }, 0);\r\n          }}>\r\n            <FormatAlignRight fontSize=\"large\" />\r\n          </IconButton>\r\n\r\n          <IconButton size=\"small\" onClick={function () {\r\n            setEditorState(addEmptyBlock(editorState))\r\n            // const es = RichUtils.toggleBlockType(\r\n            //   editorState, // write type to editorState\r\n            //   \"rightBlock\"\r\n            // )\r\n            // setTimeout(() => {\r\n            //   setEditorState(EditorState.forceSelection(es, es.getSelection()))\r\n            // }, 0);\r\n          }}>\r\n            <HorizontalSplitOutlined fontSize=\"large\" />\r\n          </IconButton>\r\n\r\n          <Switch\r\n            sx={{ position: \"absolute\", right: -10 }}\r\n            checked={!theme.isLight}\r\n            onChange={function (event) {\r\n              event.target.checked\r\n                ? theme.setMode(\"dark\")\r\n                : theme.setMode(\"light\")\r\n            }}\r\n          />\r\n\r\n\r\n        </Stack>\r\n\r\n      </Stack>\r\n\r\n\r\n      <Paper\r\n        id=\"frame-editor\"\r\n        ref={frameRef}\r\n        style={{\r\n          position: \"relative\", wordBreak: \"break-all\", //top: \"5vh\"\r\n          //  minHeight: \"8rem\"\r\n        }}\r\n\r\n        onClick={function () {\r\n          // setTimeout(function () {\r\n          //   const es = EditorState.forceSelection(editorState, editorState.getSelection())\r\n          //   setEditorState(es)\r\n          // }, 0)\r\n        }}\r\n        sx={{\r\n          //  fontSize: theme.sizeObj,\r\n          bgcolor: 'background.default',\r\n          boxShadow: shadowValue\r\n        }}\r\n      >\r\n\r\n        <Editor\r\n\r\n          ref={function (element) { editorRef.current = element; }}\r\n          readOnly={readOnly}\r\n          editorState={editorState}\r\n          onChange={(newState) => {\r\n            //  taggingMention()\r\n            //  newState = taggingMention(showHint, newState)\r\n            newState.getCurrentContent()\r\n\r\n            const selection = newState.getSelection()\r\n            const isCollapsed = selection.isCollapsed()\r\n            const startKey = selection.getStartKey()\r\n\r\n            if (specialBakcSpace.current) {\r\n              const newContentState = Modifier.replaceText(newState.getCurrentContent(), newState.getSelection(), \"\")\r\n              newState = EditorState.push(newState, newContentState, \"insert-characters\")\r\n              specialBakcSpace.current = false\r\n            }\r\n\r\n\r\n\r\n            isCollapsed && setCurrentBlockKey(startKey)\r\n            //   isCollapsed && tabValue === 3 && setTabValue(false)\r\n\r\n\r\n            //    setShowFontBar(!newState.getSelection().isCollapsed())\r\n\r\n\r\n\r\n            setEditorState(newState)\r\n\r\n\r\n\r\n          }}\r\n          onFocus={function () {\r\n            //setShadowValue(10)\r\n            setShadowValue(5)\r\n          }}\r\n          onBlur={function () {\r\n            setShadowValue(3)\r\n\r\n          }}\r\n          plugins={[\r\n\r\n\r\n            emojiPlugin,\r\n            imagePlugin,\r\n            linkPlugin,\r\n            votePlugin,\r\n            mentionPlugin,\r\n            personPlugin,\r\n          ]}\r\n\r\n          customStyleFn={function (style, block) {\r\n            const styleNameArr = style.toArray();\r\n            const styleObj = {}\r\n\r\n            styleNameArr.forEach(item => {\r\n              if (item === \"linkTagOn\") {\r\n                styleObj.color = blue[500]\r\n                styleObj.textDecoration = \"underline\"\r\n              }\r\n              if (item === \"linkTagOff\") {\r\n                styleObj.color = blue[500]\r\n              }\r\n            })\r\n            if (styleNameArr.length > 0) {\r\n              return styleObj\r\n            }\r\n\r\n          }}\r\n\r\n          blockRendererFn={function (block) {\r\n\r\n            const text = block.getText()\r\n            const data = block.getData().toObject()\r\n            const type = block.getType()\r\n            const blockKey = block.getKey()\r\n            const selection = editorState.getSelection()\r\n\r\n            if (type === \"imageBlock\") {\r\n              return {\r\n                component: ImageBlock,\r\n                editable: false,\r\n                props: {\r\n                  blockKey,\r\n                  markingImageBlock,\r\n                },\r\n              }\r\n            }\r\n            else if (type === \"voteBlock\") {\r\n              return {\r\n                component: VoteBlock,\r\n                editable: false,\r\n                props: {\r\n                  blockKey,\r\n                  markingVoteBlock,\r\n                  readOnly,\r\n                  setReadOnly,\r\n                },\r\n              }\r\n            }\r\n\r\n\r\n          }}\r\n\r\n\r\n\r\n          blockRenderMap={\r\n            Immutable.Map({\r\n\r\n              \"unstyled\": {\r\n                element: \"div\",\r\n                wrapper: <EditingBlock\r\n                  editorRef={editorRef}\r\n                  markingImageBlock={markingImageBlock}\r\n                  markingVoteBlock={markingVoteBlock}\r\n                  VoteBlock={VoteBlock}\r\n                  readOnly={readOnly}\r\n                  setReadOnly={setReadOnly}\r\n                />\r\n              },\r\n            })\r\n          }\r\n\r\n          blockStyleFn={function (block) {\r\n            const blockText = block.getText()\r\n            const blockData = block.getData().toObject()\r\n            const blockType = block.getType()\r\n            const blockKey = block.getKey()\r\n            const startKey = editorState.getSelection().getStartKey()\r\n\r\n            if (blockType === \"unstyled\") {\r\n              return \"unstyled-block\"\r\n            }\r\n            // else if (blockType === \"smallFontBlock\") {\r\n            //   return \"small-font-block\"\r\n            // }\r\n\r\n          }}\r\n\r\n\r\n\r\n          keyBindingFn={function (e, { getEditorState, setEditorState, ...obj }) {\r\n            //return undefined to carry on\r\n            const editorState = getEditorState()\r\n            const selection = editorState.getSelection();\r\n\r\n            const startKey = selection.getStartKey()\r\n            const startOffset = selection.getStartOffset()\r\n\r\n            const endKey = selection.getEndKey()\r\n            const endOffset = selection.getEndOffset()\r\n\r\n            const anchorKey = selection.getAnchorKey()\r\n            const anchorOffset = selection.getAnchorOffset()\r\n            const focusKey = selection.getFocusKey()\r\n            const focusOffset = selection.getFocusOffset()\r\n\r\n            const isCollapsed = selection.isCollapsed()\r\n            const isInOrder = !selection.getIsBackward()\r\n            const hasFocus = selection.getHasFocus()\r\n\r\n            // console.log(startKey, startOffset, endKey, endOffset, anchorKey, anchorOffset, focusKey, focusOffset, isCollapsed, isInOrder, hasFocus)\r\n\r\n\r\n            const contentState = editorState.getCurrentContent();\r\n            const allBlocks = contentState.getBlockMap()\r\n\r\n            const block = contentState.getBlockForKey(startKey);\r\n            const blockText = block.getText()\r\n\r\n            const keyBefore = contentState.getKeyBefore(startKey)\r\n            const blockBefore = contentState.getBlockBefore(startKey)\r\n\r\n            const firstBlockKey = allBlocks.slice(0, 1).toArray().shift().getKey()\r\n\r\n\r\n            if ((e.keyCode === 8) && (isCollapsed) && (blockText.length === 0) && (startOffset === 0) && (startKey !== firstBlockKey)) {\r\n\r\n              let newContentState = Modifier.replaceText(contentState, selection, \"#\")\r\n              let es = EditorState.push(editorState, newContentState, \"insert-characters\")\r\n\r\n\r\n              es = deleteBlock2(es, startKey, setEditorState)\r\n              let newSelection = es.getSelection()\r\n\r\n              newSelection = newSelection.merge({\r\n\r\n                anchorOffset: newSelection.getAnchorOffset() + 0,  //hilight +0   ,not hilight +1\r\n                focusOffset: newSelection.getFocusOffset() + 1\r\n              })\r\n\r\n              es = EditorState.forceSelection(es, newSelection)\r\n\r\n              specialBakcSpace.current = true\r\n\r\n              setCurrentBlockKey(es.getSelection().getStartKey())\r\n              setEditorState(es)\r\n\r\n              return \"dummy\"\r\n            }\r\n            else if ((e.keyCode === 8) && (isCollapsed) && (startOffset === 0) && (startKey !== firstBlockKey)) {\r\n              deleteBlock1(editorState, startKey, setEditorState)\r\n              return (\"done\")\r\n            }\r\n            else if (checkShowing() && e.keyCode === 38) {\r\n              return undefined\r\n            }\r\n            else if (checkShowing() && e.keyCode === 40) {\r\n              return undefined\r\n            }\r\n\r\n            // if ((block.getType() === \"imageBlock\")) {\r\n            //   return \"cancel-delete\"\r\n            // }\r\n\r\n            else if (e.shiftKey || hasCommandModifier(e) || e.altKey) {\r\n              return getDefaultKeyBinding(e);\r\n            }\r\n            return undefined\r\n\r\n          }}\r\n\r\n          handleKeyCommand={function (command, editorState, evenTimeStamp, { getEditorState }) {\r\n            // return undefiend and return not-handled will be igonred in handleKeyCommand\r\n\r\n            //  const newState = RichUtils.handleKeyCommand(editorState, command);\r\n\r\n            if (command === \"deletemore\") {\r\n              alert(\"fff\")\r\n              //RichUtils.handleKeyCommand(editorState, \"deletemore\")\r\n              return editorState\r\n              //  alert(\"dfdf\")\r\n            }\r\n\r\n            // if (command === \"backspace\") {    //builtin command when hit backspace if not binded in keypress\r\n            //   //   RichUtils.handleKeyCommand(editorState, \"deletemore\")\r\n            // }\r\n\r\n\r\n            if (command === \"moveUp\" || command === \"moveDown\") {\r\n              const selection = editorState.getSelection();\r\n              const startKey = selection.getStartKey();\r\n              const endKey = selection.getEndKey();\r\n              const isCollapsed = selection.isCollapsed()\r\n\r\n\r\n              const upperBlockKey = editorState.getCurrentContent().getKeyBefore(startKey)\r\n              const block = editorState.getCurrentContent().getBlockForKey(command === \"moveUp\" ? startKey : endKey)\r\n              const lowerBlockKey = editorState.getCurrentContent().getKeyAfter(endKey)\r\n\r\n              if ((command === \"moveUp\" && upperBlockKey) || ((command === \"moveDown\" && lowerBlockKey))) {\r\n\r\n                const adjacentBlock = command === \"moveUp\"\r\n                  ? editorState.getCurrentContent().getBlockBefore(startKey)\r\n                  : editorState.getCurrentContent().getBlockAfter(endKey)\r\n                const text = adjacentBlock.getText()\r\n\r\n                let newSelection = selection.merge({\r\n\r\n                  ...isCollapsed && { anchorKey: adjacentBlock.getKey() },\r\n                  ...isCollapsed && { anchorOffset: text ? text.length : 0 },\r\n\r\n                  focusKey: adjacentBlock.getKey(),\r\n                  focusOffset: adjacentBlock.getKey() ? text.length : 0,\r\n\r\n                  isBackward: false,\r\n                  hasFocus: true,\r\n                })\r\n                //  externalES = EditorState.push(externalES, newContent, \"insert-characters\");\r\n                let es = EditorState.forceSelection(editorState, newSelection)\r\n                setEditorState(es)\r\n              }\r\n              else if ((command === \"moveUp\" && !upperBlockKey) || ((command === \"moveDown\" && !lowerBlockKey))) {\r\n\r\n                const text = block.getText()\r\n\r\n                let newSelection = selection.merge({\r\n                  anchorKey: block.getKey(),\r\n                  anchorOffset: command === \"moveUp\" ? 0 : text ? text.length : 0,\r\n                  focusKey: block.getKey(),\r\n                  focusOffset: command === \"moveUp\" ? 0 : text ? text.length : 0,\r\n                  isBackward: false,\r\n                  hasFocus: true,\r\n                })\r\n                let es = EditorState.forceSelection(editorState, newSelection)\r\n                setEditorState(es)\r\n              }\r\n            }\r\n\r\n\r\n            if (command === \"bold\") {\r\n\r\n              setEditorState(RichUtils.handleKeyCommand(editorState, command))\r\n            }\r\n            if (command === \"italic\") {\r\n\r\n              setEditorState(RichUtils.handleKeyCommand(editorState, command))\r\n            }\r\n            if (command === \"underline\") {\r\n\r\n              setEditorState(RichUtils.handleKeyCommand(editorState, command))\r\n            }\r\n            return 'not-handled';\r\n\r\n          }}\r\n\r\n          handleBeforeInput={function (aaa, editorState) {\r\n\r\n\r\n          }}\r\n\r\n          handleReturn={function (e, newState, { getEditorState, setEditorState }) {\r\n            const editorState = newState;// getEditorState()\r\n            const selectionState = editorState.getSelection();\r\n            let contentState = newState.getCurrentContent();\r\n            const block = contentState.getBlockForKey(selectionState.getStartKey());\r\n            //    console.log(block.getType())\r\n            if (block.getType() === \"imageBlock\") {\r\n              return \"handled\"\r\n            }\r\n            else if (block.getType() === \"voteBlock\") {\r\n              return \"handled\"\r\n            }\r\n            // else if (checkShowing()) {\r\n            //   return \"handled\"\r\n            // }\r\n\r\n          }}\r\n\r\n        />\r\n\r\n\r\n\r\n\r\n      </Paper>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n      <Button sx={{ width: \"100%\", my: \"8px\" }} disabled={postDisable}\r\n\r\n        onClick={function () {\r\n\r\n          setTimeout(function () {\r\n            setPostDisable(true)\r\n          }, 0)\r\n\r\n\r\n          const preHtml = toPreHtml(editorState, theme)\r\n\r\n\r\n          const ownerName = userName || (\"User\" + String(Math.random()).substring(3, 6))\r\n          const postID = \"post\" + ownerName + \"-\" + Date.now()\r\n\r\n          const blockTypeArr = []\r\n          const stepPromiseArr = []\r\n          let voteBlockKey = null\r\n          let voteBlockData = null\r\n\r\n\r\n\r\n\r\n\r\n          editorState.getCurrentContent().getBlocksAsArray().forEach(block => {\r\n            blockTypeArr.push(block.getType())\r\n            if (block.getType() === \"voteBlock\") {\r\n              voteBlockKey = block.getKey()\r\n              voteBlockData = block.getData().toObject()\r\n            }\r\n          })\r\n\r\n          if (blockTypeArr.includes(\"imageBlock\")) {\r\n            const data = new FormData();\r\n            const data2 = new FormData();\r\n            const promiseArr = [];\r\n            const promiseArr2 = [];\r\n\r\n            const fileNameArr = []\r\n            const fileNameArr2 = []\r\n\r\n\r\n            Object.keys(imageObj).forEach(itemKey => {\r\n              imageObj[itemKey].forEach(img => {\r\n\r\n                promiseArr.push(fetch(img.imgSnap)\r\n                  .then(res => {\r\n                    const filename = (String(img.imgSnap).substr(String(img.imgSnap).lastIndexOf(\"/\") + 1)) + \"-snap\"\r\n                    fileNameArr.push({ filename })\r\n                    return res.blob()\r\n                  })\r\n                )\r\n                promiseArr2.push(fetch(img.imgUrl)\r\n                  .then(res => {\r\n                    const filename = (String(img.imgUrl).substr(String(img.imgUrl).lastIndexOf(\"/\") + 1))\r\n                    console.log(filename)\r\n                    fileNameArr2.push({ filename })\r\n                    return res.blob()\r\n                  })\r\n                )\r\n              })\r\n            })\r\n\r\n            const promise = Promise.all(promiseArr)\r\n              .then(blobArr => {\r\n                blobArr.forEach((file, index) => {\r\n                  data.append(\"file\", new File([file], fileNameArr[index].filename, { type: \"image/jpeg\" }))\r\n                })\r\n                const obj = { ownerName, postID };\r\n                data.append('obj', JSON.stringify(obj));\r\n\r\n                return axios.post(`${url}/api/picture/uploadPicture`, data, {\r\n                  headers: { 'content-type': 'multipart/form-data' },\r\n                })\r\n              })\r\n              .then(response => {\r\n                console.log(response.data)\r\n                return Promise.all(promiseArr2)\r\n              })\r\n              .then(blobArr => {\r\n                blobArr.forEach((file, index) => {\r\n                  data2.append(\"file\", new File([file], fileNameArr2[index].filename, { type: \"image/jpeg\" }))\r\n                })\r\n                const obj = { ownerName, postID };\r\n                data2.append('obj', JSON.stringify(obj));\r\n\r\n                return axios.post(`${url}/api/picture/uploadPicture2`, data2, {\r\n                  headers: { 'content-type': 'multipart/form-data' },\r\n                })\r\n              })\r\n\r\n            stepPromiseArr.push(promise)\r\n\r\n\r\n\r\n\r\n          }\r\n\r\n          if (blockTypeArr.includes(\"voteBlock\")) {\r\n\r\n\r\n            const promise = axios.post(`${url}/api/voteBlock`, { ...voteBlockData.voteDataObj, postID, ownerName, }).then(response => {\r\n\r\n              //    console.log(response.data)\r\n\r\n\r\n            })\r\n            stepPromiseArr.push(promise)\r\n\r\n          }\r\n\r\n\r\n          Promise.all(stepPromiseArr).then(function () {\r\n            setPostDisable(false)\r\n            //   const preHtml = toPreHtml(editorState, theme)\r\n\r\n\r\n            setPostDisable(false)\r\n\r\n            onSubmit({\r\n              ownerName,\r\n              content: preHtml,\r\n              postID,\r\n              postingTime: new Date(),\r\n            }, function () {\r\n              setImageObj({})\r\n              setEditorState(EditorState.createEmpty())\r\n            })\r\n\r\n\r\n\r\n\r\n\r\n            axios.post(`${url}/api/article`,\r\n              {\r\n                ownerName,\r\n\r\n                content: preHtml,\r\n                postID,\r\n                postingTime: Date.now(),\r\n              }).then(response => {\r\n\r\n\r\n                // setImageObj({})\r\n                // setEditorState(EditorState.createEmpty())\r\n\r\n\r\n\r\n              })\r\n\r\n\r\n          })\r\n\r\n        }}\r\n\r\n\r\n      > Post</Button>\r\n\r\n\r\n      {/* <div style={{ whiteSpace: \"pre-wrap\", display: \"flex\", fontSize: 15 }}>\r\n        <div>{JSON.stringify(editorState.getCurrentContent(), null, 2)}</div>\r\n        <hr />\r\n        <div>{JSON.stringify(convertToRaw(editorState.getCurrentContent()), null, 2)}</div>\r\n      </div> */}\r\n    </Box>\r\n\r\n  )\r\n\r\n\r\n\r\n}\r\n\r\n\r\n\r\nfunction markingBlockType({ blockKey, blockTypeName, editorState, setEditorState }) {\r\n\r\n  let newSelection = SelectionState.createEmpty(blockKey)\r\n  newSelection = newSelection.merge({\r\n    focusKey: blockKey,\r\n    focusOffset: 0,\r\n    anchorOffset: blockKey,\r\n    anchorOffset: 0,\r\n    hasFocus: false\r\n  });\r\n\r\n\r\n\r\n  const newContent = Modifier.setBlockType(\r\n    editorState.getCurrentContent(),\r\n    newSelection,\r\n    blockTypeName,\r\n  );\r\n\r\n  editorState = EditorState.push(editorState, newContent, 'change-block-type');\r\n\r\n  // if (isDeleting) {\r\n  //   setTimeout(() => {\r\n  //     setEditorState(EditorState.forceSelection(editorState, editorState.getSelection()))\r\n  //   }, 0);\r\n\r\n  // }\r\n  //else {\r\n  return setEditorState(editorState)\r\n  //}\r\n\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nfunction deleteBlock1(store, blockKey, setEditorState) {\r\n  // const editorState = store.getEditorState();\r\n\r\n  const editorState = store;\r\n  let content = editorState.getCurrentContent();\r\n\r\n  const beforeKey = content.getKeyBefore(blockKey);\r\n  const beforeBlock = content.getBlockForKey(beforeKey);\r\n  const beforeBlockText = beforeBlock && beforeBlock.getText();\r\n  // Note: if the focused block is the first block then it is reduced to an\r\n  // unstyled block with no character\r\n  if (beforeBlock === undefined) {\r\n    const targetRange = new SelectionState({\r\n      anchorKey: blockKey,\r\n      anchorOffset: 0,\r\n      focusKey: blockKey,\r\n      focusOffset: 1,\r\n    });\r\n    // change the blocktype and remove the characterList entry with the sticker\r\n    content = Modifier.removeRange(content, targetRange, 'backward');\r\n    content = Modifier.setBlockType(\r\n      content,\r\n      targetRange,\r\n      'unstyled'\r\n    );\r\n    const newState = EditorState.push(editorState, content, 'remove-block');\r\n\r\n    // force to new selection\r\n    const newSelection = new SelectionState({\r\n      anchorKey: blockKey,\r\n      anchorOffset: 0,\r\n      focusKey: blockKey,\r\n      focusOffset: 0,\r\n    });\r\n    return EditorState.forceSelection(newState, newSelection);\r\n  }\r\n\r\n\r\n  //alert(`beforeTextLength ${beforeBlock.getText().length}  anchorKey ${beforeKey}  anchorOffset: ${beforeBlock.getLength()}   focusKey ${blockKey}  `)\r\n\r\n  const targetRange = new SelectionState({\r\n    anchorKey: beforeKey,\r\n    anchorOffset: beforeBlock.getLength(),//beforeBlockText && beforeBlockText.length || 0,// beforeBlock.getLength(),\r\n    focusKey: blockKey,\r\n    focusOffset: 0,   // one in colorblock or editingBlock\r\n  });\r\n\r\n  content = Modifier.removeRange(content, targetRange, 'backward');\r\n  const newState = EditorState.push(editorState, content, 'remove-block');\r\n\r\n\r\n\r\n  // force to new selection\r\n\r\n  const newSelection = new SelectionState({\r\n    anchorKey: beforeKey,\r\n    anchorOffset: beforeBlock.getLength(),\r\n    focusKey: beforeKey,\r\n    focusOffset: beforeBlock.getLength(),\r\n  });\r\n\r\n\r\n  setEditorState(EditorState.forceSelection(newState, newSelection))\r\n\r\n\r\n\r\n  // return EditorState.acceptSelection(newState, newSelection);\r\n}\r\n\r\n\r\nfunction deleteBlock2(store, blockKey) {\r\n  // const editorState = store.getEditorState();\r\n\r\n  const editorState = store;\r\n  let content = editorState.getCurrentContent();\r\n\r\n  const beforeKey = content.getKeyBefore(blockKey);\r\n  const beforeBlock = content.getBlockForKey(beforeKey);\r\n  const beforeBlockText = beforeBlock && beforeBlock.getText();\r\n  // Note: if the focused block is the first block then it is reduced to an\r\n  // unstyled block with no character\r\n  if (beforeBlock === undefined) {\r\n    const targetRange = new SelectionState({\r\n      anchorKey: blockKey,\r\n      anchorOffset: 0,\r\n      focusKey: blockKey,\r\n      focusOffset: 1,\r\n    });\r\n    // change the blocktype and remove the characterList entry with the sticker\r\n    content = Modifier.removeRange(content, targetRange, 'backward');\r\n    content = Modifier.setBlockType(\r\n      content,\r\n      targetRange,\r\n      'unstyled'\r\n    );\r\n    const newState = EditorState.push(editorState, content, 'remove-block');\r\n\r\n    // force to new selection\r\n    const newSelection = new SelectionState({\r\n      anchorKey: blockKey,\r\n      anchorOffset: 0,\r\n      focusKey: blockKey,\r\n      focusOffset: 0,\r\n    });\r\n    return EditorState.forceSelection(newState, newSelection);\r\n  }\r\n\r\n\r\n  //alert(`beforeTextLength ${beforeBlock.getText().length}  anchorKey ${beforeKey}  anchorOffset: ${beforeBlock.getLength()}   focusKey ${blockKey}  `)\r\n\r\n  const targetRange = new SelectionState({\r\n    anchorKey: beforeKey,\r\n    anchorOffset: beforeBlock.getLength(),//beforeBlockText && beforeBlockText.length || 0,// beforeBlock.getLength(),\r\n    focusKey: blockKey,\r\n    focusOffset: 0,   // one in colorblock or editingBlock\r\n  });\r\n\r\n  content = Modifier.removeRange(content, targetRange, 'backward');\r\n  const newState = EditorState.push(editorState, content, 'remove-block');\r\n\r\n\r\n\r\n  // force to new selection\r\n\r\n  const newSelection = new SelectionState({\r\n    anchorKey: beforeKey,\r\n    anchorOffset: beforeBlock.getLength(),\r\n    focusKey: beforeKey,\r\n    focusOffset: beforeBlock.getLength(),\r\n  });\r\n\r\n\r\n  //setEditorState(EditorState.forceSelection(newState, newSelection))\r\n\r\n\r\n\r\n  return EditorState.forceSelection(newState, newSelection);\r\n}\r\n\r\n\r\n\r\n\r\n\r\nconst addEmptyBlock = (editorState) => {\r\n  const newBlock = new ContentBlock({\r\n    key: \"m\" + String(Math.random()).substring(2, 6),\r\n    type: 'unstyled',\r\n    text: '',\r\n    characterList: Immutable.List()\r\n  })\r\n\r\n  // console.log(newBlock.key)\r\n  const contentState = editorState.getCurrentContent()\r\n  const newBlockMap = contentState.getBlockMap().set(newBlock.key, newBlock)\r\n\r\n  return EditorState.push(\r\n    editorState,\r\n    ContentState\r\n      .createFromBlockArray(newBlockMap.toArray())\r\n      .set('selectionBefore', contentState.getSelectionBefore())\r\n      .set('selectionAfter', contentState.getSelectionAfter())\r\n  )\r\n}","import { useContext } from 'react';\r\nimport { EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, AtomicBlockUtils } from 'draft-js';\r\nimport { Container, Grid, Paper, Typography, Box } from '@mui/material';\r\nimport PeopleList from './PeopleList';\r\n\r\n\r\nimport { Context } from \"./ContextProvider\"\r\nimport { useTheme } from '@mui/private-theming';\r\nimport ImageBlock from \"./ImageBlock\";\r\n\r\n\r\nexport default function createMentionPlugin() {\r\n\r\n  let editorState = null\r\n  let setEditorState = null\r\n  let newContent = null\r\n\r\n  function markingImageBlock(blockKey, isDeleting = false) {\r\n\r\n    let newSelection = SelectionState.createEmpty(blockKey)\r\n    newSelection = newSelection.merge({\r\n      focusKey: blockKey,\r\n      focusOffset: 0,\r\n      anchorOffset: blockKey,\r\n      anchorOffset: 0,\r\n      hasFocus: false\r\n    });\r\n\r\n    const newContent = Modifier.setBlockType(\r\n      editorState.getCurrentContent(),\r\n      newSelection,\r\n      isDeleting ? \"unstyled\" : \"imageBlock\"\r\n    );\r\n\r\n    editorState = EditorState.push(editorState, newContent, 'change-block-type');\r\n    // EditorState.forceSelection(externalES, newSelection)\r\n    if (isDeleting) {\r\n      setTimeout(() => {\r\n        setEditorState(EditorState.forceSelection(editorState, editorState.getSelection()))\r\n      }, 0);\r\n\r\n    }\r\n    else {\r\n      return setEditorState(editorState)\r\n    }\r\n\r\n  };\r\n\r\n\r\n\r\n  return {\r\n    imagePlugin: {\r\n\r\n      onChange: function (newState, { setEditorState: setEditorState_ }) {\r\n\r\n        editorState = newState\r\n        setEditorState = setEditorState_\r\n        newContent = newState.getCurrentContent()\r\n        return editorState\r\n\r\n      }\r\n    },\r\n\r\n    ImageBlock,\r\n\r\n    markingImageBlock,\r\n  }\r\n\r\n\r\n}","import { useContext } from 'react';\r\nimport { EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, AtomicBlockUtils } from 'draft-js';\r\nimport { Container, Grid, Paper, Typography, Box } from '@mui/material';\r\n\r\n\r\n\r\nimport { Context } from \"./ContextProvider\"\r\n\r\nimport VoteBlock from \"./VoteBlock\";\r\n\r\n\r\nexport default function createVotePlugin() {\r\n\r\n  let editorState = null\r\n  let setEditorState = null\r\n  let newContent = null\r\n\r\n  function markingVoteBlock(blockKey, isDeleting = false) {\r\n\r\n    let newSelection = SelectionState.createEmpty(blockKey)\r\n    newSelection = newSelection.merge({\r\n      focusKey: blockKey,\r\n      focusOffset: 0,\r\n      anchorOffset: blockKey,\r\n      anchorOffset: 0,\r\n      hasFocus: false\r\n    });\r\n\r\n    const newContent = Modifier.setBlockType(\r\n      editorState.getCurrentContent(),\r\n      newSelection,\r\n      isDeleting ? \"unstyled\" : \"voteBlock\"\r\n    );\r\n\r\n    editorState = EditorState.push(editorState, newContent, 'change-block-type');\r\n    // EditorState.forceSelection(externalES, newSelection)\r\n    if (isDeleting) {\r\n      setTimeout(() => {\r\n        setEditorState(EditorState.forceSelection(editorState, editorState.getSelection()))\r\n      }, 0);\r\n\r\n    }\r\n    else {\r\n      return setEditorState(editorState)\r\n    }\r\n\r\n  };\r\n\r\n\r\n\r\n\r\n  return {\r\n\r\n\r\n   \r\n\r\n    votePlugin: {\r\n      onChange: function (newState, { setEditorState: setEditorState_ }) {\r\n\r\n        editorState = newState\r\n        setEditorState = setEditorState_\r\n        newContent = newState.getCurrentContent()\r\n        return editorState\r\n\r\n      }\r\n    },\r\n     VoteBlock,\r\n     markingVoteBlock,\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n}","import React, { useState, useRef, useEffect, useLayoutEffect, useContext, useCallback, createContext, useMemo } from 'react';\r\n\r\nimport { Context } from \"./ContextProvider\"\r\n\r\nimport {\r\n  EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw,\r\n  RichUtils, Modifier, convertFromHTML, AtomicBlockUtils, getDefaultKeyBinding, KeyBindingUtil\r\n} from 'draft-js';\r\n\r\nimport EditingBlock from \"./EditingBlock\"\r\n\r\n\r\nimport { Container, Grid, Paper, IconButton, ButtonGroup, Stack, Button, Box } from '@mui/material';\r\nimport { ThemeProvider, useTheme, createTheme } from '@mui/material/styles';\r\n\r\nimport {\r\n  EmojiEmotions, FormatSize, FormatAlignLeft, FormatAlignCenter, FormatAlignRight, StackedBarChart, HorizontalSplitOutlined,\r\n  Send,\r\n\r\n} from '@mui/icons-material';\r\n\r\nimport { blue, red } from '@mui/material/colors';\r\n\r\nimport Editor from \"draft-js-plugins-editor\";\r\nimport Immutable from 'immutable';\r\n\r\nimport createMentionPlugin from './MentionPlugin';\r\nimport createPersonPlugin from './PersonPlugin';\r\n\r\nimport createEmojiPlugin from './EmojiPlugin';\r\n//import createImagePlugin from './ImagePlugin';\r\nimport createLinkPlugin from './LinkPlugin';\r\n//import createVotePlugin from './VotePlugin';\r\n\r\nimport axios from \"axios\";\r\nimport { url, toPreHtml } from \"./config\";\r\n\r\n//console.log(createVotePlugin())\r\n\r\nconst { hasCommandModifier } = KeyBindingUtil;\r\n\r\nconst { mentionPlugin, taggingMention, checkShowing } = createMentionPlugin()\r\nconst { personPlugin } = createPersonPlugin()\r\nconst { emojiPlugin, EmojiComp } = createEmojiPlugin()\r\n//const { imagePlugin, markingImageBlock, ImageBlock } = createImagePlugin()\r\nconst { linkPlugin } = createLinkPlugin()\r\n//const { votePlugin, markingVoteBlock, VoteBlock } = createVotePlugin()\r\n\r\n\r\nexport default function SimpleDraft({ postID, commentID, userName, typeName, openEditor, bgcolor, onSubmit, subCommentEditor, ...props }) {\r\n\r\n  const theme = useTheme()\r\n  const { editorState, setEditorState, currentBlockKey, setCurrentBlockKey, imageObj, setImageObj } = useContext(Context)\r\n\r\n\r\n  //const [editorState, setEditorState] = useState(EditorState.createEmpty())\r\n\r\n  const editorRef = useRef()\r\n\r\n  const [shadowValue, setShadowValue] = useState(0)\r\n\r\n  // const [currentBlockKey, setCurrentBlockKey] = useState(null)\r\n  const specialBakcSpace = useRef(false)\r\n\r\n  // console.log(theme.isLight)\r\n\r\n  const [readOnly, setReadOnly] = useState(false)\r\n\r\n  const [postDisable, setPostDisable] = useState(false)\r\n\r\n  const [isOnFocus, setIsOnFocus] = useState(false)\r\n\r\n\r\n  const [autoFocused, setAutoFocused] = useState(false)\r\n\r\n  useEffect(function () {\r\n\r\n\r\n    setTimeout(function () {\r\n\r\n      if (!autoFocused) {\r\n        setAutoFocused(true)\r\n        setEditorState(EditorState.forceSelection(editorState, editorState.getSelection()))\r\n\r\n      }\r\n\r\n    }, 0)\r\n\r\n  }, [editorState,autoFocused])\r\n\r\n\r\n\r\n  useEffect(function () {\r\n    if (openEditor) {\r\n      setAutoFocused(false)\r\n      // setTimeout(() => {\r\n      //   setEditorState(EditorState.forceSelection(editorState, editorState.getSelection()))\r\n      // }, 0);\r\n    }\r\n  }, [openEditor])\r\n\r\n  return (\r\n    <>\r\n      <Box style={{\r\n        position: \"relative\", wordBreak: \"break-all\", //top: \"5vh\"\r\n        boxShadow: theme.shadows[shadowValue],\r\n        // border: `${isOnFocus?\"1px\":\"0px\"} solid ${blue[500]}`,\r\n        paddingLeft: \"4px\"\r\n      }}\r\n\r\n        sx={{\r\n          //  fontSize: theme.sizeObj, \r\n          bgcolor: 'background.default',\r\n          // boxShadow: shadowValue,\r\n          //  border: `${isOnFocus?\"1px\":\"0px\"} solid ${blue[500]}`,\r\n          // bgcolor: \"transparent\",\r\n\r\n        }}\r\n      >\r\n\r\n        <Editor\r\n\r\n          ref={function (element) { editorRef.current = element; }}\r\n          readOnly={readOnly}\r\n          editorState={editorState}\r\n          onChange={(newState) => {\r\n\r\n            //  newState = taggingMention(showHint, newState)\r\n            newState.getCurrentContent()\r\n\r\n            const selection = newState.getSelection()\r\n            const isCollapsed = selection.isCollapsed()\r\n            const startKey = selection.getStartKey()\r\n\r\n            if (specialBakcSpace.current) {\r\n              const newContentState = Modifier.replaceText(newState.getCurrentContent(), newState.getSelection(), \"\")\r\n              newState = EditorState.push(newState, newContentState, \"insert-characters\")\r\n              specialBakcSpace.current = false\r\n            }\r\n\r\n\r\n\r\n            isCollapsed && setCurrentBlockKey(startKey)\r\n            //   isCollapsed && tabValue === 3 && setTabValue(false)\r\n\r\n\r\n            //    setShowFontBar(!newState.getSelection().isCollapsed())\r\n\r\n\r\n\r\n            setEditorState(newState)\r\n\r\n\r\n\r\n          }}\r\n          onFocus={function () {\r\n            setIsOnFocus(true)\r\n            //    setShadowValue(1)\r\n          }}\r\n          onBlur={function () {\r\n            setIsOnFocus(false)\r\n            //    setShadowValue(0)\r\n\r\n\r\n          }}\r\n          plugins={[\r\n            mentionPlugin,\r\n            personPlugin,\r\n            emojiPlugin,\r\n            // imagePlugin,\r\n            linkPlugin,\r\n            // votePlugin,\r\n\r\n\r\n          ]}\r\n\r\n          customStyleFn={function (style, block) {\r\n            const styleNameArr = style.toArray();\r\n            const styleObj = {}\r\n\r\n            styleNameArr.forEach(item => {\r\n              if (item === \"linkTagOn\") {\r\n                styleObj.color = blue[500]\r\n                styleObj.textDecoration = \"underline\"\r\n              }\r\n              if (item === \"linkTagOff\") {\r\n                styleObj.color = blue[500]\r\n              }\r\n            })\r\n            if (styleNameArr.length > 0) {\r\n              return styleObj\r\n            }\r\n\r\n          }}\r\n\r\n          blockRendererFn={function (block) {\r\n\r\n            const text = block.getText()\r\n            const data = block.getData().toObject()\r\n            const type = block.getType()\r\n            const blockKey = block.getKey()\r\n            const selection = editorState.getSelection()\r\n\r\n            // if (type === \"imageBlock\") {\r\n            //   return {\r\n            //     component: ImageBlock,\r\n            //     editable: false,\r\n            //     props: {\r\n            //       blockKey,\r\n            //       markingImageBlock,\r\n            //     },\r\n            //   }\r\n            // }\r\n            // else if (type === \"voteBlock\") {\r\n            //   return {\r\n            //     component: VoteBlock,\r\n            //     editable: false,\r\n            //     props: {\r\n            //       blockKey,\r\n            //       markingVoteBlock,\r\n            //       readOnly,\r\n            //       setReadOnly,\r\n            //     },\r\n            //   }\r\n            // }\r\n\r\n\r\n          }}\r\n\r\n\r\n\r\n          // blockRenderMap={\r\n          //   Immutable.Map({\r\n\r\n          //     \"unstyled\": {\r\n          //       element: \"div\",\r\n          //       wrapper: <EditingBlock\r\n          //         editorRef={editorRef}\r\n          //         markingImageBlock={markingImageBlock}\r\n          //         markingVoteBlock={markingVoteBlock}\r\n          //         VoteBlock={VoteBlock}\r\n          //         readOnly={readOnly}\r\n          //         setReadOnly={setReadOnly}\r\n          //       />\r\n          //     },\r\n          //   })\r\n          // }\r\n\r\n          blockStyleFn={function (block) {\r\n            const blockText = block.getText()\r\n            const blockData = block.getData().toObject()\r\n            const blockType = block.getType()\r\n            const blockKey = block.getKey()\r\n            const startKey = editorState.getSelection().getStartKey()\r\n\r\n            if (blockType === \"unstyled\") {\r\n              return \"unstyled-block\"\r\n            }\r\n            // else if (blockType === \"smallFontBlock\") {\r\n            //   return \"small-font-block\"\r\n            // }\r\n\r\n          }}\r\n\r\n\r\n\r\n          keyBindingFn={function (e, { getEditorState, setEditorState, ...obj }) {\r\n            //return undefined to carry on\r\n            const editorState = getEditorState()\r\n            const selection = editorState.getSelection();\r\n\r\n            const startKey = selection.getStartKey()\r\n            const startOffset = selection.getStartOffset()\r\n\r\n            const endKey = selection.getEndKey()\r\n            const endOffset = selection.getEndOffset()\r\n\r\n            const anchorKey = selection.getAnchorKey()\r\n            const anchorOffset = selection.getAnchorOffset()\r\n            const focusKey = selection.getFocusKey()\r\n            const focusOffset = selection.getFocusOffset()\r\n\r\n            const isCollapsed = selection.isCollapsed()\r\n            const isInOrder = !selection.getIsBackward()\r\n            const hasFocus = selection.getHasFocus()\r\n\r\n            // console.log(startKey, startOffset, endKey, endOffset, anchorKey, anchorOffset, focusKey, focusOffset, isCollapsed, isInOrder, hasFocus)\r\n\r\n\r\n            const contentState = editorState.getCurrentContent();\r\n            const allBlocks = contentState.getBlockMap()\r\n\r\n            const block = contentState.getBlockForKey(startKey);\r\n            const blockText = block.getText()\r\n\r\n            const keyBefore = contentState.getKeyBefore(startKey)\r\n            const blockBefore = contentState.getBlockBefore(startKey)\r\n\r\n            const firstBlockKey = allBlocks.slice(0, 1).toArray().shift().getKey()\r\n\r\n\r\n            if ((e.keyCode === 8) && (isCollapsed) && (blockText.length === 0) && (startOffset === 0) && (startKey !== firstBlockKey)) {\r\n\r\n              let newContentState = Modifier.replaceText(contentState, selection, \"#\")\r\n              let es = EditorState.push(editorState, newContentState, \"insert-characters\")\r\n\r\n\r\n              es = deleteBlock2(es, startKey, setEditorState)\r\n              let newSelection = es.getSelection()\r\n\r\n              newSelection = newSelection.merge({\r\n\r\n                anchorOffset: newSelection.getAnchorOffset() + 0,  //hilight +0   ,not hilight +1\r\n                focusOffset: newSelection.getFocusOffset() + 1\r\n              })\r\n\r\n              es = EditorState.forceSelection(es, newSelection)\r\n\r\n              specialBakcSpace.current = true\r\n\r\n              setCurrentBlockKey(es.getSelection().getStartKey())\r\n              setEditorState(es)\r\n\r\n              return \"dummy\"\r\n            }\r\n            else if ((e.keyCode === 8) && (isCollapsed) && (startOffset === 0) && (startKey !== firstBlockKey)) {\r\n              deleteBlock1(editorState, startKey, setEditorState)\r\n              return (\"done\")\r\n            }\r\n            else if (checkShowing() && e.keyCode === 38) {\r\n              return undefined\r\n            }\r\n            else if (checkShowing() && e.keyCode === 40) {\r\n              return undefined\r\n            }\r\n\r\n            // if ((block.getType() === \"imageBlock\")) {\r\n            //   return \"cancel-delete\"\r\n            // }\r\n\r\n            else if (e.shiftKey || hasCommandModifier(e) || e.altKey) {\r\n              return getDefaultKeyBinding(e);\r\n            }\r\n            return undefined\r\n\r\n          }}\r\n\r\n          handleKeyCommand={function (command, editorState, evenTimeStamp, { getEditorState }) {\r\n            // return undefiend and return not-handled will be igonred in handleKeyCommand\r\n\r\n            //  const newState = RichUtils.handleKeyCommand(editorState, command);\r\n\r\n            if (command === \"deletemore\") {\r\n              alert(\"fff\")\r\n              //RichUtils.handleKeyCommand(editorState, \"deletemore\")\r\n              return editorState\r\n              //  alert(\"dfdf\")\r\n            }\r\n\r\n            // if (command === \"backspace\") {    //builtin command when hit backspace if not binded in keypress\r\n            //   //   RichUtils.handleKeyCommand(editorState, \"deletemore\")\r\n            // }\r\n\r\n\r\n            if (command === \"moveUp\" || command === \"moveDown\") {\r\n              const selection = editorState.getSelection();\r\n              const startKey = selection.getStartKey();\r\n              const endKey = selection.getEndKey();\r\n              const isCollapsed = selection.isCollapsed()\r\n\r\n\r\n              const upperBlockKey = editorState.getCurrentContent().getKeyBefore(startKey)\r\n              const block = editorState.getCurrentContent().getBlockForKey(command === \"moveUp\" ? startKey : endKey)\r\n              const lowerBlockKey = editorState.getCurrentContent().getKeyAfter(endKey)\r\n\r\n              if ((command === \"moveUp\" && upperBlockKey) || ((command === \"moveDown\" && lowerBlockKey))) {\r\n\r\n                const adjacentBlock = command === \"moveUp\"\r\n                  ? editorState.getCurrentContent().getBlockBefore(startKey)\r\n                  : editorState.getCurrentContent().getBlockAfter(endKey)\r\n                const text = adjacentBlock.getText()\r\n\r\n                let newSelection = selection.merge({\r\n\r\n                  ...isCollapsed && { anchorKey: adjacentBlock.getKey() },\r\n                  ...isCollapsed && { anchorOffset: text ? text.length : 0 },\r\n\r\n                  focusKey: adjacentBlock.getKey(),\r\n                  focusOffset: adjacentBlock.getKey() ? text.length : 0,\r\n\r\n                  isBackward: false,\r\n                  hasFocus: true,\r\n                })\r\n                //  externalES = EditorState.push(externalES, newContent, \"insert-characters\");\r\n                let es = EditorState.forceSelection(editorState, newSelection)\r\n                setEditorState(es)\r\n              }\r\n              else if ((command === \"moveUp\" && !upperBlockKey) || ((command === \"moveDown\" && !lowerBlockKey))) {\r\n\r\n                const text = block.getText()\r\n\r\n                let newSelection = selection.merge({\r\n                  anchorKey: block.getKey(),\r\n                  anchorOffset: command === \"moveUp\" ? 0 : text ? text.length : 0,\r\n                  focusKey: block.getKey(),\r\n                  focusOffset: command === \"moveUp\" ? 0 : text ? text.length : 0,\r\n                  isBackward: false,\r\n                  hasFocus: true,\r\n                })\r\n                let es = EditorState.forceSelection(editorState, newSelection)\r\n                setEditorState(es)\r\n              }\r\n            }\r\n\r\n\r\n            if (command === \"bold\") {\r\n\r\n              setEditorState(RichUtils.handleKeyCommand(editorState, command))\r\n            }\r\n            if (command === \"italic\") {\r\n\r\n              setEditorState(RichUtils.handleKeyCommand(editorState, command))\r\n            }\r\n            if (command === \"underline\") {\r\n\r\n              setEditorState(RichUtils.handleKeyCommand(editorState, command))\r\n            }\r\n            return 'not-handled';\r\n\r\n          }}\r\n\r\n          handleBeforeInput={function (aaa, editorState) {\r\n\r\n\r\n          }}\r\n\r\n          handleReturn={function (e, newState, { getEditorState, setEditorState }) {\r\n            const editorState = newState;// getEditorState()\r\n            const selectionState = editorState.getSelection();\r\n            let contentState = newState.getCurrentContent();\r\n            const block = contentState.getBlockForKey(selectionState.getStartKey());\r\n            //    console.log(block.getType())\r\n            // if (block.getType() === \"imageBlock\") {\r\n            //   return \"handled\"\r\n            // }\r\n            // else if (block.getType() === \"voteBlock\") {\r\n            //   return \"handled\"\r\n            // }\r\n            // else if (checkShowing()) {\r\n            //   return \"handled\"\r\n            // }\r\n\r\n          }}\r\n\r\n        />\r\n        <Box sx={{ //bgcolor,\r\n\r\n          position: \"relative\", transform: \"translateX(-4px)\", width: \"calc( 100% + 4px )\"\r\n        }}>\r\n\r\n          <EmojiComp editorRef={editorRef} typeName=\"SimpleDraft\" />\r\n\r\n          <IconButton size=\"small\" sx={{\r\n            position: \"absolute\", right: 0, bottom: 0,\r\n          }}\r\n\r\n            onClick={function () {\r\n              // alert(postID + userName)\r\n              // console.log(toPreHtml(editorState, theme))\r\n              if (!subCommentEditor) {\r\n                axios.post(`${url}/api/comment`,\r\n                  {\r\n                    postID,\r\n                    ownerName: userName,\r\n                    content: toPreHtml(editorState, theme),\r\n                    commentID: \"comment\" + userName + \"-\" + Date.now()\r\n\r\n\r\n                  })\r\n                  .then(response => {\r\n\r\n                    setEditorState(EditorState.createEmpty())\r\n                    onSubmit(response.data)\r\n                  })\r\n              }\r\n              else {\r\n                axios.post(`${url}/api/subComment`,\r\n                {\r\n                  postID,\r\n                  commentID,\r\n                  ownerName: userName,\r\n                  content: toPreHtml(editorState, theme),\r\n                  subCommentID:\"subComment\" + userName + \"-\" + Date.now()\r\n\r\n                })\r\n                .then(response => {\r\n\r\n                  setEditorState(EditorState.createEmpty())\r\n                  onSubmit(response.data)\r\n                })\r\n\r\n\r\n              }\r\n\r\n            }}\r\n          >\r\n            <Send fontSize=\"medium\" />\r\n          </IconButton>\r\n        </Box>\r\n\r\n\r\n\r\n      </Box>\r\n\r\n\r\n      {/* <div style={{ whiteSpace: \"pre-wrap\", display: \"flex\", fontSize: 15 }}>\r\n        <div>{JSON.stringify(editorState.getCurrentContent(), null, 2)}</div>\r\n        <hr />\r\n        <div>{JSON.stringify(convertToRaw(editorState.getCurrentContent()), null, 2)}</div>\r\n      </div> */}\r\n    </>\r\n\r\n  )\r\n\r\n\r\n\r\n}\r\n\r\n\r\n\r\nfunction markingBlockType({ blockKey, blockTypeName, editorState, setEditorState }) {\r\n\r\n  let newSelection = SelectionState.createEmpty(blockKey)\r\n  newSelection = newSelection.merge({\r\n    focusKey: blockKey,\r\n    focusOffset: 0,\r\n    anchorOffset: blockKey,\r\n    anchorOffset: 0,\r\n    hasFocus: false\r\n  });\r\n\r\n\r\n\r\n  const newContent = Modifier.setBlockType(\r\n    editorState.getCurrentContent(),\r\n    newSelection,\r\n    blockTypeName,\r\n  );\r\n\r\n  editorState = EditorState.push(editorState, newContent, 'change-block-type');\r\n\r\n  // if (isDeleting) {\r\n  //   setTimeout(() => {\r\n  //     setEditorState(EditorState.forceSelection(editorState, editorState.getSelection()))\r\n  //   }, 0);\r\n\r\n  // }\r\n  //else {\r\n  return setEditorState(editorState)\r\n  //}\r\n\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nfunction deleteBlock1(store, blockKey, setEditorState) {\r\n  // const editorState = store.getEditorState();\r\n\r\n  const editorState = store;\r\n  let content = editorState.getCurrentContent();\r\n\r\n  const beforeKey = content.getKeyBefore(blockKey);\r\n  const beforeBlock = content.getBlockForKey(beforeKey);\r\n  const beforeBlockText = beforeBlock && beforeBlock.getText();\r\n  // Note: if the focused block is the first block then it is reduced to an\r\n  // unstyled block with no character\r\n  if (beforeBlock === undefined) {\r\n    const targetRange = new SelectionState({\r\n      anchorKey: blockKey,\r\n      anchorOffset: 0,\r\n      focusKey: blockKey,\r\n      focusOffset: 1,\r\n    });\r\n    // change the blocktype and remove the characterList entry with the sticker\r\n    content = Modifier.removeRange(content, targetRange, 'backward');\r\n    content = Modifier.setBlockType(\r\n      content,\r\n      targetRange,\r\n      'unstyled'\r\n    );\r\n    const newState = EditorState.push(editorState, content, 'remove-block');\r\n\r\n    // force to new selection\r\n    const newSelection = new SelectionState({\r\n      anchorKey: blockKey,\r\n      anchorOffset: 0,\r\n      focusKey: blockKey,\r\n      focusOffset: 0,\r\n    });\r\n    return EditorState.forceSelection(newState, newSelection);\r\n  }\r\n\r\n\r\n  //alert(`beforeTextLength ${beforeBlock.getText().length}  anchorKey ${beforeKey}  anchorOffset: ${beforeBlock.getLength()}   focusKey ${blockKey}  `)\r\n\r\n  const targetRange = new SelectionState({\r\n    anchorKey: beforeKey,\r\n    anchorOffset: beforeBlock.getLength(),//beforeBlockText && beforeBlockText.length || 0,// beforeBlock.getLength(),\r\n    focusKey: blockKey,\r\n    focusOffset: 0,   // one in colorblock or editingBlock\r\n  });\r\n\r\n  content = Modifier.removeRange(content, targetRange, 'backward');\r\n  const newState = EditorState.push(editorState, content, 'remove-block');\r\n\r\n\r\n\r\n  // force to new selection\r\n\r\n  const newSelection = new SelectionState({\r\n    anchorKey: beforeKey,\r\n    anchorOffset: beforeBlock.getLength(),\r\n    focusKey: beforeKey,\r\n    focusOffset: beforeBlock.getLength(),\r\n  });\r\n\r\n\r\n  setEditorState(EditorState.forceSelection(newState, newSelection))\r\n\r\n\r\n\r\n  // return EditorState.acceptSelection(newState, newSelection);\r\n}\r\n\r\n\r\nfunction deleteBlock2(store, blockKey) {\r\n  // const editorState = store.getEditorState();\r\n\r\n  const editorState = store;\r\n  let content = editorState.getCurrentContent();\r\n\r\n  const beforeKey = content.getKeyBefore(blockKey);\r\n  const beforeBlock = content.getBlockForKey(beforeKey);\r\n  const beforeBlockText = beforeBlock && beforeBlock.getText();\r\n  // Note: if the focused block is the first block then it is reduced to an\r\n  // unstyled block with no character\r\n  if (beforeBlock === undefined) {\r\n    const targetRange = new SelectionState({\r\n      anchorKey: blockKey,\r\n      anchorOffset: 0,\r\n      focusKey: blockKey,\r\n      focusOffset: 1,\r\n    });\r\n    // change the blocktype and remove the characterList entry with the sticker\r\n    content = Modifier.removeRange(content, targetRange, 'backward');\r\n    content = Modifier.setBlockType(\r\n      content,\r\n      targetRange,\r\n      'unstyled'\r\n    );\r\n    const newState = EditorState.push(editorState, content, 'remove-block');\r\n\r\n    // force to new selection\r\n    const newSelection = new SelectionState({\r\n      anchorKey: blockKey,\r\n      anchorOffset: 0,\r\n      focusKey: blockKey,\r\n      focusOffset: 0,\r\n    });\r\n    return EditorState.forceSelection(newState, newSelection);\r\n  }\r\n\r\n\r\n  //alert(`beforeTextLength ${beforeBlock.getText().length}  anchorKey ${beforeKey}  anchorOffset: ${beforeBlock.getLength()}   focusKey ${blockKey}  `)\r\n\r\n  const targetRange = new SelectionState({\r\n    anchorKey: beforeKey,\r\n    anchorOffset: beforeBlock.getLength(),//beforeBlockText && beforeBlockText.length || 0,// beforeBlock.getLength(),\r\n    focusKey: blockKey,\r\n    focusOffset: 0,   // one in colorblock or editingBlock\r\n  });\r\n\r\n  content = Modifier.removeRange(content, targetRange, 'backward');\r\n  const newState = EditorState.push(editorState, content, 'remove-block');\r\n\r\n\r\n\r\n  // force to new selection\r\n\r\n  const newSelection = new SelectionState({\r\n    anchorKey: beforeKey,\r\n    anchorOffset: beforeBlock.getLength(),\r\n    focusKey: beforeKey,\r\n    focusOffset: beforeBlock.getLength(),\r\n  });\r\n\r\n\r\n  //setEditorState(EditorState.forceSelection(newState, newSelection))\r\n\r\n\r\n\r\n  return EditorState.forceSelection(newState, newSelection);\r\n}\r\n\r\n\r\n\r\n\r\n\r\nconst addEmptyBlock = (editorState) => {\r\n  const newBlock = new ContentBlock({\r\n    key: \"m\" + String(Math.random()).substring(2, 6),\r\n    type: 'unstyled',\r\n    text: '',\r\n    characterList: Immutable.List()\r\n  })\r\n\r\n  // console.log(newBlock.key)\r\n  const contentState = editorState.getCurrentContent()\r\n  const newBlockMap = contentState.getBlockMap().set(newBlock.key, newBlock)\r\n\r\n  return EditorState.push(\r\n    editorState,\r\n    ContentState\r\n      .createFromBlockArray(newBlockMap.toArray())\r\n      .set('selectionBefore', contentState.getSelectionBefore())\r\n      .set('selectionAfter', contentState.getSelectionAfter())\r\n  )\r\n}","import React, { createContext, useEffect, useState, useReducer, useRef, useMemo, useCallback, useLayoutEffect, useContext, Component } from 'react';\r\nimport {\r\n  EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw,\r\n  RichUtils, Modifier, convertFromHTML, AtomicBlockUtils\r\n} from 'draft-js';\r\n\r\nimport { ThemeProvider, useTheme, createTheme } from '@mui/material/styles';\r\n\r\nimport { Button, CssBaseline, Switch, Slider } from '@mui/material';\r\nimport DraftEditor from './DraftEditor';\r\nimport SimpleDraft from './SimpleDraft';\r\n\r\nimport Immutable from \"immutable\";\r\n\r\nimport { url, toPreHtml, hexToRGB, hexToRGB2, colorArr, colorIndexArr } from \"./config\";\r\nimport axios from 'axios';\r\n\r\nexport const Context = createContext();\r\n\r\n\r\n\r\n\r\nexport function useEditorState(savedEditorState) {\r\n  const [editorState, setEditorState] = useState(savedEditorState || EditorState.createEmpty())\r\n\r\n\r\n\r\n  return [editorState, setEditorState]\r\n}\r\n\r\nfunction usePeopleListState() {\r\n\r\n  const [peopleList, setPeopleList] = useState([\"UweF23\", \"UweF22\", \"TonyCerl\", \"JimWil\", \"\", \"Jimberg\", \"mGsd\"])\r\n\r\n  useEffect(function () {\r\n    axios.get(`${url}/api/user/getAllUser`).then(response => {\r\n\r\n      setPeopleList(response.data.map(item => item.userName))\r\n\r\n    })\r\n\r\n  }, [])\r\n\r\n\r\n  return [peopleList, setPeopleList]\r\n}\r\n\r\n\r\n\r\nexport function ContextProvider({ //editorState: editorStateProp, setEditorState: setEditorStateProp,\r\n  userName,\r\n  onSubmit = function (preHtml) { },\r\n  open,\r\n\r\n  savedImageObj,\r\n  setSavedImageObj,\r\n  savedEditorState,\r\n  setSavedEditorState,\r\n\r\n  savedVoteArr, setSavedVoteArr,\r\n  savedVoteTopic, setSavedVoteTopic,\r\n  savedPollDuration, setSavedPollDuration,\r\n\r\n  ...props }) {\r\n\r\n\r\n  let [editorState, setEditorState] = useEditorState(savedEditorState)\r\n\r\n  const [imageObj, setImageObj] = useState(savedImageObj || {})\r\n\r\n\r\n  const [voteArr, setVoteArr] = useState(savedVoteArr || [])\r\n  const [voteTopic, setVoteTopic] = useState(savedVoteTopic || \"\")\r\n  const [pollDuration, setPollDuration] = useState(savedPollDuration || { d: 3, h: 0, m: 0 })\r\n\r\n\r\n\r\n  const [peopleList, setPeopleList] = usePeopleListState()                  //useState([\"TonyCerl\", \"JimWil\", \"\", \"Jimberg\", \"mGsd\"])\r\n\r\n\r\n\r\n\r\n  const [currentBlockKey, setCurrentBlockKey] = useState(\"ddd\")\r\n\r\n\r\n\r\n\r\n  const imageBlockNum = editorState.getCurrentContent().getBlocksAsArray().filter(block => block.getType() === \"imageBlock\").length\r\n\r\n  useEffect(function () {\r\n\r\n\r\n    editorState.getCurrentContent().getBlocksAsArray().forEach(block => {\r\n\r\n\r\n\r\n      if (block.getType() === \"voteBlock\") {\r\n        const blockKey = block.getKey()\r\n\r\n\r\n\r\n        let es = null\r\n\r\n        const contentState = editorState.getCurrentContent();\r\n        const currentBlock = contentState.getBlockForKey(blockKey);\r\n        let newSelection = SelectionState.createEmpty(blockKey)\r\n        newSelection = newSelection.merge({\r\n          focusKey: blockKey,\r\n          focusOffset: 0,\r\n          anchorOffset: blockKey,\r\n          anchorOffset: 0,\r\n          hasFocus: false\r\n        });\r\n\r\n\r\n        const newContent = Modifier.setBlockData(\r\n          editorState.getCurrentContent(),\r\n          newSelection,//  SelectionState.createEmpty(newKey),\r\n          Immutable.Map({ voteDataObj: { voteArr, voteTopic, pollDuration } })\r\n        )\r\n\r\n        es = EditorState.push(es || editorState, newContent, 'change-block-data');\r\n        if (es) {\r\n          setEditorState(es)\r\n        }\r\n      }\r\n\r\n    })\r\n\r\n\r\n\r\n\r\n\r\n  }, [voteArr, voteTopic, pollDuration])\r\n\r\n\r\n\r\n\r\n  useEffect(function () {\r\n    let es = null\r\n\r\n    Object.keys(imageObj).forEach(blockKey => {\r\n\r\n      if (imageObj[blockKey]) {\r\n        //  console.log(editorState.getCurrentContent().getBlockForKey(blockKey))\r\n\r\n        const contentState = editorState.getCurrentContent();\r\n        const currentBlock = contentState.getBlockForKey(blockKey);\r\n        let newSelection = SelectionState.createEmpty(blockKey)\r\n        newSelection = newSelection.merge({\r\n          focusKey: blockKey,\r\n          focusOffset: 0,\r\n          anchorOffset: blockKey,\r\n          anchorOffset: 0,\r\n          hasFocus: false\r\n        });\r\n\r\n\r\n        const newContent = Modifier.setBlockData(\r\n          editorState.getCurrentContent(),\r\n          newSelection,//  SelectionState.createEmpty(newKey),\r\n          Immutable.Map({ imgDataArr: imageObj[blockKey] })\r\n        )\r\n\r\n        es = EditorState.push(es || editorState, newContent, 'change-block-data');\r\n      }\r\n    })\r\n    if (es) {\r\n      setEditorState(es)\r\n    }\r\n\r\n\r\n  }, [imageObj])\r\n\r\n  useEffect(function () {\r\n    if (!open) {\r\n      setSavedImageObj(imageObj)\r\n      setSavedEditorState(editorState)\r\n\r\n      setSavedVoteArr(voteArr)\r\n      setSavedVoteTopic(voteTopic)\r\n      setSavedPollDuration(pollDuration)\r\n\r\n\r\n    }\r\n\r\n\r\n  }, [open])\r\n\r\n\r\n\r\n\r\n  return (\r\n\r\n    <Context.Provider value={{\r\n      editorState, setEditorState,\r\n      // sizeObj, setSizeObj,\r\n      peopleList, setPeopleList,\r\n      currentBlockKey, setCurrentBlockKey,\r\n      imageObj, setImageObj,\r\n\r\n\r\n      voteArr, setVoteArr,\r\n      voteTopic, setVoteTopic,\r\n      pollDuration, setPollDuration,\r\n      imageBlockNum,\r\n      onSubmit,\r\n    }}>\r\n      {/* <Switch\r\n        sx={{ left: \"92%\" }}\r\n        onChange={function (event) {\r\n          event.target.checked\r\n            ? theme.setMode(\"dark\")\r\n            : theme.setMode(\"light\")\r\n        }}\r\n      /> */}\r\n\r\n      {/* <Slider\r\n        valueLabelDisplay=\"auto\"\r\n        min={1}\r\n        max={2}\r\n        step={0.25}\r\n        marks={true}\r\n        value={scaleValue}\r\n        onChange={(e, value) => {\r\n\r\n          theme.setSizeObj({ xs: value + \"rem\", sm: value + \"rem\", md: value + \"rem\", lg: value + \"rem\", xl: value + \"rem\" })\r\n          setScaleValue(value)\r\n        }}\r\n        valueLabelFormat={function (numOfMins_) {\r\n          return numOfMins_ + \"rem\"\r\n        }}\r\n      /> */}\r\n\r\n      <DraftEditor userName={userName} />\r\n\r\n\r\n    </Context.Provider>\r\n\r\n  )\r\n\r\n\r\n\r\n}\r\n\r\n\r\nexport function SimpleDraftProvider({ postID, commentID, userName, openEditor, bgcolor, onSubmit, subCommentEditor }) {\r\n\r\n  const [peopleList, setPeopleList] = usePeopleListState()\r\n  const [editorState, setEditorState] = useEditorState()\r\n  const [currentBlockKey, setCurrentBlockKey] = useState(\"ddd\")\r\n\r\n  return (\r\n    <Context.Provider value={{\r\n      peopleList, setPeopleList,\r\n      editorState, setEditorState,\r\n      currentBlockKey, setCurrentBlockKey\r\n    }}>\r\n\r\n      <SimpleDraft postID={postID} commentID={commentID} userName={userName} typeName=\"SimpleDraft\"\r\n        openEditor={openEditor} bgcolor={bgcolor} onSubmit={onSubmit} subCommentEditor={subCommentEditor} />\r\n\r\n\r\n    </Context.Provider>\r\n\r\n\r\n  )\r\n\r\n}","import React, { createContext, useEffect, useState, useReducer, useRef, useMemo, useCallback, useLayoutEffect, useContext, Component } from 'react';\r\n\r\nimport { EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw, RichUtils, Modifier, convertFromHTML, AtomicBlockUtils } from 'draft-js';\r\n\r\nimport { stateToHTML } from 'draft-js-export-html';\r\nimport ReactHtmlParser, { processNodes, convertNodeToElement, htmlparser2, } from 'react-html-parser';\r\nimport reactElementToJSXString from 'react-element-to-jsx-string';\r\n\r\n\r\nimport { ThemeProvider, useTheme, createTheme, styled, } from '@mui/material/styles';\r\n\r\nimport Immutable from \"immutable\"\r\n\r\nimport { AvatarChip } from \"./PeopleList\"\r\n\r\nimport {\r\n  Container, Grid, Paper, Typography, Box, Chip, Avatar, Link, Button, LinearProgress, Stack, IconButton, Divider, Collapse, Badge,\r\n\r\n  CircularProgress, Hidden\r\n} from '@mui/material'\r\nimport {\r\n  EmojiEmotions, FormatSize, FormatAlignLeft, FormatAlignCenter, FormatAlignRight, StackedBarChart, HorizontalSplitOutlined,\r\n  ChatBubbleOutline, Edit, DeleteOutline, AspectRatioOutlined\r\n} from '@mui/icons-material';\r\n\r\nimport Dialog from '@mui/material/Dialog';\r\nimport DialogActions from '@mui/material/DialogActions';\r\nimport DialogContent from '@mui/material/DialogContent';\r\nimport DialogContentText from '@mui/material/DialogContentText';\r\nimport DialogTitle from '@mui/material/DialogTitle';\r\n\r\nimport useResizeObserver from '@react-hook/resize-observer';\r\n\r\n\r\nimport { blue, red, grey } from '@mui/material/colors';\r\nimport Lightbox from 'react-image-lightbox';\r\nimport 'react-image-lightbox/style.css';\r\n\r\n\r\nimport axios from \"axios\";\r\nimport { url, toPreHtml, hexToRGB, hexToRGB2, useScreenState, uniqByKeepFirst, colorArr, colorIndexArr, getColor, getColor3 } from \"./config\";\r\nimport { compareAsc, format, formatDistanceToNow } from 'date-fns';\r\nimport { zhCN } from \"date-fns/locale\";\r\nimport Countdown from \"react-countdown\";\r\nimport multiavatar from \"@multiavatar/multiavatar\";\r\nimport useAppContext from './useAppContext';\r\n\r\nimport CommentSector from './CommentSector';\r\n\r\nimport Masonry from 'react-masonry-css';\r\nimport { SimpleDraftProvider } from './ContextProvider';\r\n\r\nimport { useInView } from 'react-intersection-observer';\r\n\r\nimport { BrowserRouter, Route, Routes, useRoutes, Link as LinkRoute, useParams, matchPath, useLocation, useNavigate, Outlet } from \"react-router-dom\";\r\n\r\n\r\n\r\n\r\nexport const ContentContext = createContext()\r\nfunction useContentContext() {\r\n\r\n  return useContext(ContentContext)\r\n\r\n\r\n}\r\n\r\n\r\n\r\nfunction toHtml(preHtml, { theme, target, size, setSize, avatarColor, postID, setLightBoxOn, ownerName }) {\r\n\r\n  // console.log(preHtml)\r\n\r\n  const allImageArr = []\r\n\r\n  return ReactHtmlParser(preHtml, {\r\n    transform: function transformFn(node, index) {\r\n\r\n      if (node.name === \"div\" && node.attribs[\"small-font\"]) {\r\n\r\n        const element = node.children.map((child, index) => {\r\n\r\n          if (child.name === \"object\" && child.attribs[\"data-type\"] === \"person-tag\") {\r\n\r\n            const avatarElement = convertNodeToElement(child)\r\n            const personName = reactElementToJSXString(<>{avatarElement}</>).replace(/(<([^>]*)>)/ig, '').replace(/\\s/g, '')\r\n\r\n            return <AvatarChip name={personName} key={index} avatarScale={0.8} textScale={0.8} boxShadow={0} />\r\n          }\r\n          else if (child.name === \"span\" && child.attribs[\"data-type\"] === \"link\") {\r\n            const element = convertNodeToElement(child)\r\n            const linkAdd = reactElementToJSXString(<>{element}</>).replace(/(<([^>]*)>)/ig, '').replace(/\\s/g, '')\r\n\r\n            // return <a href={linkAdd} style={{ color: blue[800], textDecoration:\"none\" }} >{linkAdd}</a >\r\n            return <LinkTag linkAdd={linkAdd} key={index} />\r\n          }\r\n\r\n          return convertNodeToElement(child, index, transformFn)\r\n        })\r\n\r\n        //  toHtml(reactElementToJSXString(<>{element}</>),theme,target)\r\n\r\n        //  console.log(reactElementToJSXString(<>{element}</>))\r\n\r\n\r\n        return <Box\r\n          key={index}\r\n          sx={{\r\n            fontSize: theme.scaleSizeObj(0.8),\r\n\r\n            ...(node.attribs[\"text-align\"]) && { textAlign: node.attribs[\"text-align\"] }\r\n          }} >\r\n          {/* {toHtml(reactElementToJSXString(<div>{element}</div>), theme, target)} */}\r\n          {element}\r\n        </Box>\r\n\r\n      }\r\n      else if (node.name === \"span\" && node.attribs[\"data-type\"] === \"link\") {\r\n        const element = convertNodeToElement(node)\r\n        const linkAdd = reactElementToJSXString(<>{element}</>).replace(/(<([^>]*)>)/ig, '').replace(/\\s/g, '')\r\n\r\n        // return <a href={linkAdd} style={{ color: blue[800], textDecoration:\"none\" }} >{linkAdd}</a >\r\n        return <LinkTag linkAdd={linkAdd} key={index} />\r\n      }\r\n      else if (node.name === \"object\" && node.attribs[\"data-type\"] === \"image-block\") {\r\n        // console.log(node.attribs[\"data-bgiamge\"], index)\r\n\r\n\r\n\r\n        const data = JSON.parse(unescape(node.attribs[\"data-block_data\"]))\r\n\r\n\r\n        if (data.imgDataArr) {\r\n          data.imgDataArr.forEach(img => {\r\n            //     console.log(img)\r\n            allImageArr.push(img)\r\n          })\r\n        }\r\n\r\n        // console.log(data)\r\n        // arr.push({ bg: node.attribs[\"data-bgiamge\"], row: index, node })\r\n        //  console.log(data)\r\n\r\n        if (Array.isArray(data.imgDataArr) && data.imgDataArr.length > 0) {\r\n          return <Images key={index} imgDataArr={data.imgDataArr} allImageArr={allImageArr} target={target} size={size} setSize={setSize} postID={postID}\r\n            setLightBoxOn={setLightBoxOn}\r\n\r\n          />\r\n        }\r\n        else {\r\n          return null\r\n        }\r\n\r\n      }\r\n      else if (node.name === \"object\" && node.attribs[\"data-type\"] === \"mention-tag\") {\r\n\r\n        const element = convertNodeToElement(node)\r\n        const personName = reactElementToJSXString(<>{element}</>).replace(/(<([^>]*)>)/ig, '').replace(/\\s/g, '')\r\n\r\n        return <Typography variant=\"body2\" key={index}\r\n          sx={{ display: \"inline\", }}\r\n        >{personName}</Typography>\r\n      }\r\n      else if (node.name === \"object\" && node.attribs[\"data-type\"] === \"person-tag\") {\r\n\r\n        const element = convertNodeToElement(node)\r\n        const personName = reactElementToJSXString(<>{element}</>).replace(/(<([^>]*)>)/ig, '').replace(/\\s/g, '')\r\n        return <AvatarChip name={personName} key={index} avatarScale={1.2} textScale={0.8} boxShadow={0} />\r\n      }\r\n      else if (node.name === \"object\" && node.attribs[\"data-type\"] === \"vote-block\") {\r\n\r\n        const data = node.attribs[\"data-block_data\"] ? JSON.parse(unescape(node.attribs[\"data-block_data\"])) : null\r\n        const blockKey = node.attribs[\"data-block_key\"]\r\n\r\n\r\n        //  console.log(data, blockKey)\r\n        return <VoteFrame data={data} blockKey={blockKey} avatarColor={avatarColor} postID={postID} key={index} ownerName={ownerName} />\r\n      }\r\n\r\n      //  return null\r\n    }\r\n  })\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\nexport default function ContentPerson({ ...props }) {\r\n\r\n  const theme = useTheme()\r\n  const { userName, savedPostArr, setSavedPostArr, postArr: allPostArr, setPostArr: setAllPostArr } = useAppContext()\r\n\r\n\r\n  const [postArr, setPostArr] = useState([])\r\n\r\n  const [size, setSize] = useState()\r\n  const [dialogSize, setDialogSize] = useState()\r\n\r\n  const breakpointColumnsObj = {\r\n    [theme.breakpoints.values.xs]: 1,\r\n    [theme.breakpoints.values.sm]: 1,\r\n    [theme.breakpoints.values.md]: 2,\r\n    [theme.breakpoints.values.lg]: 3,\r\n    [theme.breakpoints.values.xl]: 4,\r\n    2000: 4, 3000: 5, 4000: 6, 5000: 7, 6000: 8, 7000: 9, 9999999: 10,\r\n  };\r\n\r\n  const [isFull, setIsFull] = useState(false)\r\n  const { ref, inView, entry } = useInView({\r\n    /* Optional options */\r\n    threshold: 0.8,\r\n    triggerOnce: false,\r\n    initialInView: true,\r\n    rootMargin: \"0px 0px 0px 0px\"\r\n  });\r\n\r\n\r\n\r\n  const { personName } = useParams()\r\n\r\n  useEffect(function () {\r\n\r\n    setPostArr([])\r\n\r\n  }, [personName])\r\n\r\n  function getSinglePost() {\r\n\r\n    if (inView) {\r\n      const beforeTime = postArr.length > 0 ? postArr[postArr.length - 1].postingTime : \"\"\r\n\r\n\r\n      axios.get(`${url}/api/article/getPersonOne/${personName}/${beforeTime}`).then(response => {\r\n\r\n        response.data.length === 0\r\n          ? setIsFull(true)\r\n          : setPostArr(pre => { return uniqByKeepFirst([...pre, ...response.data].filter(post => post.ownerName === personName), (item) => item.postID) })\r\n\r\n      })\r\n    }\r\n  }\r\n\r\n  useEffect(function () {\r\n\r\n\r\n    setIsFull(false)\r\n\r\n  }, [personName])\r\n\r\n\r\n\r\n  useEffect(function () {\r\n\r\n\r\n    if (inView && (!isFull)) {\r\n      getSinglePost()\r\n    }\r\n\r\n\r\n  }, [isFull, inView, postArr])\r\n\r\n\r\n  const [openIndex, setOpenIndex] = useState(-1);\r\n  const [lightBoxOn, setLightBoxOn] = useState(false)\r\n\r\n\r\n  return (\r\n    <ContentContext.Provider value={{ /*votedArr, setVotedArr, commentChangeArr, setCommentChangeArr*/ }}>\r\n\r\n\r\n      <Box sx={{\r\n        display: \"flex\",\r\n        justifyContent: \"center\",\r\n        fontSize: theme.sizeObj,\r\n        \"& p\": { fontSize: theme.sizeObj }\r\n      }}\r\n\r\n      >\r\n\r\n\r\n        <Masonry\r\n          breakpointCols={breakpointColumnsObj}\r\n          className=\"my-masonry-grid\"\r\n          columnClassName=\"my-masonry-grid_column\"\r\n        >\r\n\r\n          {postArr.map((item, index) => {\r\n\r\n            const { content, postID, ownerName, newKey } = item\r\n            return (\r\n              <PostFrame\r\n                key={newKey || postID}\r\n                postID={postID}\r\n                item={item}\r\n                size={size}\r\n                setSize={setSize}\r\n                isFirstOne={index === 0}\r\n\r\n                index={index}\r\n                setOpen={setOpenIndex}\r\n                setLightBoxOn={setLightBoxOn}\r\n\r\n                userName={userName}\r\n                setPostArr={setPostArr}\r\n              />\r\n            )\r\n          })}\r\n        </Masonry>\r\n\r\n\r\n\r\n\r\n      </Box >\r\n\r\n      <Box\r\n        ref={ref}\r\n        style={{\r\n          padding: theme.spacing(1), margin: \"auto\", backgroundColor: theme.palette.background.default, width: \"100%\",\r\n          opacity: Boolean(!isFull) && inView ? 1 : 0,\r\n          display: \"flex\", justifyContent: \"center\", alignItems: \"center\",\r\n          ...(isFull) && { display: \"none\" }\r\n        }}>\r\n        <CircularProgress size=\"3rem\" sx={{ color: theme.palette.text.secondary }} />\r\n      </Box>\r\n\r\n      <Dialog\r\n\r\n\r\n        onBackdropClick={function () {\r\n          setOpenIndex(-1);\r\n        }}\r\n        fullWidth={true}\r\n        //  fullScreen={true}\r\n        open={openIndex >= 0}\r\n        onClose={function () {\r\n\r\n          if (postArr[openIndex].postID) {\r\n            axios.get(`${url}/api/article/findOne/${postArr[openIndex].postID}`).then((response) => {\r\n\r\n              setPostArr(pre => {\r\n                return pre.map((post, index) => {\r\n                  if (index !== openIndex) { return post }\r\n                  else {\r\n                    console.log(response.data)\r\n                    return { ...response.data, newKey: Math.random() }\r\n                  }\r\n                })\r\n\r\n              })\r\n            })\r\n          }\r\n\r\n\r\n\r\n        }}\r\n        scroll={lightBoxOn ? \"paper\" : \"body\"}\r\n        sx={{\r\n          bgcolor: \"rgba(0,0,0,0.7)\",\r\n          ...lightBoxOn && { bgcolor: \"transparent\", display: `none` },\r\n          \"& > div > div > div\": { marginBottom: 0 }\r\n        }}\r\n      >\r\n\r\n        {postArr[openIndex] && <PostFrame\r\n          key={postArr[openIndex].newKey || postArr[openIndex].postID}\r\n          postID={postArr[openIndex].postID}\r\n          item={postArr[openIndex]}\r\n          size={dialogSize}\r\n          setSize={setDialogSize}\r\n          isFirstOne={true}\r\n\r\n          setOpen={setOpenIndex}\r\n\r\n          setLightBoxOn={setLightBoxOn}\r\n          userName={userName}\r\n          setPostArr={setPostArr}\r\n\r\n        />}\r\n      </Dialog>\r\n\r\n\r\n    </ContentContext.Provider>\r\n  )\r\n\r\n\r\n}\r\n\r\n\r\n\r\nexport function PostFrame({ preHtml, item, size, setSize, isFirstOne, userName, setPostArr, setOpen, index = -1, setLightBoxOn, ...props }) {\r\n  const theme = useTheme()\r\n  const target = useRef(null)\r\n  const currentSize = useRef(0)\r\n\r\n  const { content, postID, ownerName, postingTime, commentNum, newKey } = item\r\n\r\n  const [commentCount, setCommentCount] = useState(commentNum)\r\n\r\n  const avatarString = multiavatar(ownerName)\r\n\r\n\r\n  let avatarColor = avatarString.match(/#[a-zA-z0-9]*/)[0]\r\n\r\n  if (avatarColor.length < 7) {\r\n    avatarColor = \"#\" + avatarColor[1] + avatarColor[1] + avatarColor[2] + avatarColor[2] + avatarColor[3] + avatarColor[3]\r\n    //  avatarColor = \"#fffaf6\"\r\n  }\r\n\r\n  const { needUpdateArr, needReduceArr, setNeedReduceArr, userInfoArr, userColor, setNeedUpdateArr, postArr: allPostArr } = useAppContext()\r\n\r\n\r\n  const bgcolor = getColor({ name: ownerName, userName, userInfoArr, userColor, theme })\r\n\r\n  //const bgcolor = theme.isLight ? hexToRGB(avatarColor, 0.2) : hexToRGB2(avatarColor, 0.6)\r\n\r\n\r\n  useEffect(function () {\r\n    if (isFirstOne) {\r\n      const resizeObserver = new ResizeObserver(entries => {\r\n        if (currentSize.current !== entries[0].contentRect.width) {\r\n          currentSize.current = entries[0].contentRect.width\r\n          setSize(entries[0].contentRect)\r\n        }\r\n      })\r\n\r\n      resizeObserver.observe(target.current)\r\n\r\n      return function () { resizeObserver.disconnect() }\r\n    }\r\n\r\n\r\n  }, [])\r\n\r\n\r\n  const [height, setHeight] = useState(\"auto\")\r\n\r\n\r\n  const [preHtmlEditor, setPreHtmlEditor] = useState()\r\n  const [openEditor, setOpenEditor] = useState(false)\r\n  const [unmountEditor, setUnmountEditor] = useState(true)\r\n\r\n  const [openComment, setOpenComment] = useState(false)\r\n  const [unmountComment, setUnmountComment] = useState(true)\r\n\r\n\r\n\r\n  //const { needUpdateArr, setNeedUpdateArr, postArr: allPostArr } = useAppContext()\r\n\r\n  return (\r\n    <Box\r\n      id={postID}\r\n\r\n      sx={{\r\n\r\n        boxShadow: 3,\r\n        \"& > div > div:not(.image-frame):not(.vote-frame):not(.title-line):not(.comment-sector):not(.MuiCollapse-wrapper.MuiCollapse-vertical)\": {\r\n          paddingLeft: \"4px\",\r\n          paddingRight: \"4px\",\r\n        },\r\n\r\n        transition: \"all, 300ms\",\r\n        wordWrap: \"break-word\",\r\n        height,\r\n        overflow: \"visible\",\r\n        position: \"relative\",\r\n\r\n        marginBottom: \"8px\",\r\n      }}\r\n\r\n      onClick={function () {\r\n\r\n        //  setHeight(pre => { return Number(100 + Math.random() * 600).toFixed(0) + \"px\" })\r\n\r\n      }}\r\n\r\n      ref={target}>\r\n\r\n      <Box sx={{\r\n        bgcolor,\r\n      }}>\r\n\r\n\r\n        {toHtml(content, { theme, target, size, setSize, avatarColor, postID, setLightBoxOn, ownerName })}\r\n\r\n\r\n        <Box sx={{ display: \"flex\", alignItems: \"center\", justifyContent: \"space-between\" }}>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n          <Countdown date={Date.parse(postingTime)} intervalDelay={1 * 1000}\r\n            renderer={function ({ days, hours, minutes, seconds, completed, ...props }) {\r\n              return <PostTimeRender  {...{ days, hours, minutes, seconds, completed, ...props }} />\r\n            }}\r\n            overtime={true}\r\n          />\r\n\r\n          <Box>\r\n\r\n\r\n\r\n            <IconButton size=\"small\" onClick={function (e) {\r\n              e.preventDefault()\r\n              e.stopPropagation()\r\n              setOpenEditor(pre => !pre)\r\n              setUnmountEditor(false)\r\n\r\n            }}>\r\n              <Edit fontSize='medium' />\r\n\r\n            </IconButton>\r\n\r\n\r\n            <Hidden smDown={true}>\r\n              <IconButton size=\"small\" onClick={function (e) {\r\n                e.preventDefault()\r\n                e.stopPropagation()\r\n                if (index >= 0) {\r\n                  setOpen(index)\r\n                }\r\n\r\n              }}>\r\n                <AspectRatioOutlined fontSize='medium' sx={{ transform: \"scaleX(-1)\" }} />\r\n              </IconButton>\r\n            </Hidden>\r\n\r\n\r\n\r\n            <IconButton size=\"small\" onClick={function (e) {\r\n              e.preventDefault()\r\n              e.stopPropagation()\r\n              setOpenComment(pre => !pre)\r\n              setUnmountComment(false)\r\n            }}>\r\n\r\n              {/* <Badge badgeContent={commentCount}  sx={{ \"& > span\":{bgcolor:theme.palette.text.secondary,color:\"white\"}}}> */}\r\n              <ChatBubbleOutline fontSize='medium' />\r\n              {/* </Badge> */}\r\n\r\n              <Typography sx={{ fontSize: \"1rem !important\", color: theme.palette.text.secondary }}>&nbsp;{commentCount}</Typography>\r\n            </IconButton>\r\n          </Box>\r\n\r\n        </Box>\r\n\r\n      </Box>\r\n\r\n      {\r\n        (!unmountEditor) && <Collapse unmountOnExit={unmountEditor} in={openEditor} className=\"collapse\" sx={{ bgcolor, }}  >\r\n\r\n\r\n          <Box sx={{ width: \"calc(100% - 8px)\", marginRight: \"4px\", marginBottom: \"4px\", marginLeft: \"4px\", borderRadius: \"4px\", overflow: \"visible\", }}>\r\n\r\n            <SimpleDraftProvider openEditor={openEditor} postID={postID} userName={userName} bgcolor={bgcolor}\r\n              onSubmit={function (preHtml) {\r\n                //   alert(JSON.stringify(preHtml))\r\n                setPreHtmlEditor(preHtml)\r\n                setCommentCount(pre => pre + 1)\r\n\r\n                setOpenEditor(false)\r\n                setUnmountEditor(false)\r\n\r\n                setOpenComment(true)\r\n                setUnmountComment(false)\r\n\r\n                if (allPostArr.length > 0) {\r\n                  setNeedUpdateArr(pre => {\r\n                    return [...pre, postID]\r\n                  })\r\n\r\n                }\r\n                //  needUpdateArr.push(postID)\r\n\r\n              }}\r\n            />\r\n          </Box>\r\n\r\n\r\n\r\n        </Collapse>\r\n      }\r\n\r\n      {\r\n        (!unmountComment) && <Collapse unmountOnExit={unmountComment} in={openComment} className=\"collapse\">\r\n          <CommentSector item={item} avatarColor={avatarColor} toHtml={toHtml} PostingTime={PostingTime} commentCount={commentCount} setCommentCount={setCommentCount}\r\n            preHtmlEditor={preHtmlEditor}\r\n            setCommentCount={setCommentCount}\r\n          />\r\n        </Collapse>\r\n      }\r\n    </Box >\r\n  )\r\n\r\n}\r\n\r\nexport function LinkTag({ linkAdd }) {\r\n\r\n  const theme = useTheme()\r\n\r\n  // console.log(linkAdd.match(/(\\/\\/)([a-z0-9\\-._~%]+)/))\r\n\r\n\r\n\r\n\r\n  const [content, setContent] = useState(\"\")\r\n\r\n\r\n  return (\r\n    <Box\r\n      component=\"span\"\r\n      target=\"_blank\"\r\n      //  key={index}\r\n      sx={{\r\n        color: theme.isLight ? blue[600] : blue[800],\r\n        cursor: \"pointer\",\r\n        textDecoration: \"none\",\r\n        \"&:hover\": { textDecoration: \"underline\" }\r\n      }}\r\n\r\n      onClick={function (e) {\r\n        setContent(\r\n          <Link href={linkAdd} target=\"_blank\" rel=\"noopener\"\r\n            sx={{\r\n              color: theme.isLight ? blue[600] : blue[800],\r\n              cursor: \"pointer\",\r\n              textDecoration: \"none\",\r\n              \"&:hover\": { textDecoration: \"underline\" }\r\n            }}\r\n          >\r\n            {linkAdd}\r\n          </Link>\r\n        )\r\n      }}\r\n    >\r\n      {content || linkAdd.match(/(\\/\\/)([a-z0-9\\-._~%]+)/)[2]}\r\n    </Box >\r\n  )\r\n}\r\n\r\nexport function Images({ imgDataArr, allImageArr, target, size, setSize, postID, setLightBoxOn, ...props }) {\r\n\r\n  const theme = useTheme()\r\n  const numOfImage = imgDataArr ? imgDataArr.length : 0\r\n\r\n  const width = size ? size.width : 0\r\n  const height = [width / 16 * 9, width / 16 * 9, width / 2, width / 3, width / 16 * 9][numOfImage]\r\n\r\n\r\n\r\n  const baseGrid = [\r\n    {\r\n      gridTemplateColumns: \"1fr\",\r\n      gridTemplateRows: \"1fr\",\r\n    },\r\n    {\r\n      gridTemplateColumns: \"1fr\",\r\n      gridTemplateRows: \"1fr\",\r\n    },\r\n    {\r\n      gridTemplateColumns: \"1fr 1fr\",\r\n      gridTemplateRows: \"1fr\",\r\n    },\r\n    {\r\n      gridTemplateColumns: \"1fr 1fr 1fr\",\r\n      gridTemplateRows: \"1fr 1fr\",\r\n    },\r\n    {\r\n      gridTemplateColumns: \"1fr 1fr\",\r\n      gridTemplateRows: \"1fr 1fr\",\r\n    },\r\n  ][numOfImage]\r\n\r\n  const arr = [\r\n    [\r\n      { gridColumn: \"1/3\", gridRow: \"1/3\" }\r\n    ],\r\n    [\r\n      { gridColumn: \"1/2\", gridRow: \"1/3\" },\r\n      { gridColumn: \"2/3\", gridRow: \"1/3\" },\r\n    ],\r\n    [\r\n      { gridColumn: \"1/2\", gridRow: \"1/2\" },\r\n      { gridColumn: \"2/3\", gridRow: \"1/2\" },\r\n      { gridColumn: \"3/4\", gridRow: \"1/2\" },\r\n\r\n    ],\r\n    [\r\n      { gridColumn: \"1/2\", gridRow: \"1/2\" },\r\n      { gridColumn: \"2/3\", gridRow: \"1/2\" },\r\n      { gridColumn: \"1/2\", gridRow: \"2/3\" },\r\n      { gridColumn: \"2/3\", gridRow: \"2/3\" },\r\n    ]\r\n  ]\r\n\r\n  const imageHeight = size\r\n    ? [{ height: 0 }, { height: size.width / 16 * 9 }, { height: size.width / 2 }, { height: size.width / 3 }, { height: size.width / 16 * 9 / 2 }][numOfImage]\r\n    : { height: 0 }\r\n\r\n  const cssObj = {\r\n    display: 'grid',\r\n    ...baseGrid,\r\n    // gridTemplateColumns: \"1fr 1fr\",\r\n    // gridTemplateRows: \"1fr 1fr\",\r\n    gridGap: \"2px\",\r\n    position: \"relative\",\r\n\r\n    //   marginTop: \"2px\",\r\n    //  marginBottom: \"2px\",\r\n    justifyContent: 'space-around',\r\n    overflow: 'hidden',\r\n\r\n    width: \"100%\",\r\n    height,\r\n    // bgcolor: \"pink\",\r\n\r\n    ...numOfImage > 0 && {\r\n      \"& > *:nth-type(1)\": {\r\n        position: \"relative\",\r\n        ...arr[numOfImage - 1][0],\r\n      }\r\n    },\r\n    ...numOfImage > 1 && {\r\n      \"& > *:nth-type(2)\": {\r\n        position: \"relative\",\r\n        backgroundColor: \"#ffa\",\r\n        ...arr[numOfImage - 1][1]\r\n      }\r\n    },\r\n    ...numOfImage > 2 && {\r\n      \"& > *:nth-type(3)\": {\r\n        position: \"relative\",\r\n        backgroundColor: \"#afa\",\r\n        ...arr[numOfImage - 1][2]\r\n      }\r\n    },\r\n    ...numOfImage > 3 && {\r\n      \"& > *:nth-type(4)\": {\r\n        position: \"relative\",\r\n        backgroundColor: \"#aaf\",\r\n        ...arr[numOfImage - 1][3]\r\n      }\r\n    },\r\n    ...numOfImage > 4 && {\r\n      \"& > *:nth-type( n + 5 )\": {\r\n        display: \"none\",\r\n      }\r\n    },\r\n\r\n  }\r\n\r\n\r\n  const [photoIndex, setPhotoIndex] = useState(0)\r\n  const [isOpen, setIsOpen] = useState(false)\r\n  // useEffect(function () {\r\n\r\n  //   console.log(setLightBoxOn)\r\n  //   setTimeout(function () {\r\n  //     setLightBoxOn(isOpen)\r\n  //   }, 0)\r\n  //   // \r\n  // }, [isOpen])\r\n\r\n\r\n  const images = allImageArr.length > 0\r\n    ? allImageArr.map(img => {\r\n      return {\r\n        ...img,\r\n        imgSnap: `${url}/api/picture/downloadPicture/` + (String(img.imgSnap).substr(String(img.imgSnap).lastIndexOf(\"/\") + 1)) + \"-snap\",\r\n        imgUrl: `${url}/api/picture/downloadPicture/` + (String(img.imgUrl).substr(String(img.imgUrl).lastIndexOf(\"/\") + 1)) + \"\"\r\n      }\r\n    })\r\n    : []\r\n\r\n\r\n\r\n  // const lightBox = images.length > 0\r\n  //   ? <Lightbox\r\n  //     mainSrc={images[photoIndex]?.imgUrl}\r\n  //     nextSrc={images[(photoIndex + 1) % images.length]?.imgUrl}\r\n  //     prevSrc={images[(photoIndex + images.length - 1) % images.length]?.imgUrl}\r\n  //     onCloseRequest={() => {\r\n  //       setIsOpen(false);\r\n\r\n  //       setLightBoxOn(false)\r\n  //     }}\r\n  //     onMovePrevRequest={() =>\r\n  //       setPhotoIndex(\r\n  //         pre => (pre + images.length - 1) % images.length,\r\n  //       )\r\n  //     }\r\n  //     onMoveNextRequest={() =>\r\n  //       setPhotoIndex(\r\n  //         pre => (pre + images.length + 1) % images.length,\r\n  //       )\r\n  //     }\r\n  //     onAfterOpen={() => {\r\n\r\n\r\n  //       setLightBoxOn(true)\r\n  //     }\r\n  //     }\r\n\r\n  //   />\r\n  //   : <></>\r\n\r\n\r\n  return (\r\n\r\n    <Box className=\"image-frame\" sx={cssObj}>\r\n\r\n      {isOpen && <Lightbox\r\n        mainSrc={images[photoIndex]?.imgUrl}\r\n        nextSrc={images[(photoIndex + 1) % images.length]?.imgUrl}\r\n        prevSrc={images[(photoIndex + images.length - 1) % images.length]?.imgUrl}\r\n        onCloseRequest={() => {\r\n          setIsOpen(false);\r\n\r\n          setLightBoxOn(false)\r\n        }}\r\n        onMovePrevRequest={() =>\r\n          setPhotoIndex(\r\n            pre => (pre + images.length - 1) % images.length,\r\n          )\r\n        }\r\n        onMoveNextRequest={() =>\r\n          setPhotoIndex(\r\n            pre => (pre + images.length + 1) % images.length,\r\n          )\r\n        }\r\n        onAfterOpen={() => {\r\n\r\n\r\n          setLightBoxOn(true)\r\n        }\r\n        }\r\n\r\n      />}\r\n      {imgDataArr.map((pic, index) => {\r\n\r\n        //   const imageSnap = pic.imgSnap\r\n        const imageSnap = `${url}/api/picture/downloadPicture/` + (String(pic.imgSnap).substr(String(pic.imgSnap).lastIndexOf(\"/\") + 1)) + \"-snap\"\r\n\r\n\r\n        return (\r\n\r\n          <Box style={{\r\n            // backgroundColor: \"pink\",\r\n            width: \"100%\",\r\n            ...imageHeight,\r\n            display: \"block\",\r\n            position: \"relative\"\r\n          }}\r\n\r\n            key={index}\r\n          >\r\n\r\n\r\n            <img src={imageSnap} style={{ objectFit: \"cover\", width: \"100%\", height: \"100%\" }}\r\n              onClick={function (e) {\r\n\r\n\r\n                const pos = images.findIndex(function (img) {\r\n                  return img.imgSnap === imageSnap // e.target.src\r\n                })\r\n\r\n                if (pos >= 0) {\r\n                  setIsOpen(true)\r\n                  setPhotoIndex(pos)\r\n                }\r\n              }}\r\n            />\r\n          </Box>\r\n        )\r\n\r\n      })}\r\n\r\n    </Box>\r\n\r\n\r\n  )\r\n\r\n}\r\n\r\n\r\nexport function VoteFrame({ data, avatarColor, postID, ownerName, ...props }) {\r\n\r\n  const theme = useTheme()\r\n  const { userName, setUserName,\r\n\r\n    needUpdateArr, setNeedUpdateArr, needReduceArr, setNeedReduceArr, userInfoArr, userColor\r\n  } = useAppContext()\r\n\r\n  const { voteArr = [], voteTopic = null, pollDuration = null, } = data?.voteDataObj || {}\r\n\r\n  const [percentageArr, setPercentageArr] = useState([])\r\n  const [expireTime, setExpireTime] = useState(\"\")\r\n\r\n  const [isVotting, setIsVotting] = useState(false)\r\n  const [totalVotes, setTotalVotes] = useState(0)\r\n\r\n  //const [intervalDelay, setIntervalDelay] = useState(1 * 1000)\r\n\r\n  const voteCountRef = useRef()\r\n\r\n  useEffect(function () {\r\n\r\n\r\n    axios.get(`${url}/api/voteBlock/${postID}`).then(response => {\r\n\r\n      const { voteCountArr, expireTime, whoVoted } = response.data\r\n\r\n      voteCountRef.current = voteCountArr\r\n\r\n      setExpireTime(expireTime)\r\n      //  setIsVotting(((!whoVoted.includes(userName)) && (Date.parse(expireTime) - Date.now()) > 0) && (!votedArr.includes(postID)))\r\n      setIsVotting(((!whoVoted.includes(userName)) && (Date.parse(expireTime) - Date.now()) > 0))\r\n\r\n      const totalVotes = voteCountArr.reduce((current, next) => {\r\n\r\n        return current + next\r\n\r\n      })\r\n\r\n      setPercentageArr(\r\n        voteCountArr.map(item => {\r\n          return totalVotes === 0 ? 0 : Number(Number((item / totalVotes) * 100).toFixed(0))\r\n        })\r\n      )\r\n      setTotalVotes(totalVotes)\r\n\r\n    })\r\n\r\n  }, [])\r\n\r\n  // useEffect(function () {\r\n  //   setIsVotting(pre => pre && (!votedArr.includes(postID)))\r\n  // }, [votedArr])\r\n\r\n  const bgcolor = getColor3({ name: ownerName, userName, userInfoArr, userColor, theme })\r\n\r\n  return (\r\n    <Box className=\"vote-frame\" sx={{ \"& p\": { fontSize: theme.scaleSizeObj(1) }, \"& .count-down\": { fontSize: \"1rem\" } }} >\r\n      {voteTopic && <Typography variant='body2' sx={{ textAlign: \"center\" }} >{voteTopic || \"no\"}</Typography>}\r\n\r\n      {voteArr.map((choice, index) => {\r\n\r\n\r\n        return (\r\n          <Box sx={{\r\n            position: \"relative\",\r\n\r\n\r\n            ...isVotting && {\r\n              \"& > span\": { bgcolor: theme.palette.action.disabledBackground },\r\n              \"& > span > span\": {\r\n                bgcolor,\r\n                // bgcolor: hexToRGB(avatarColor, 0.5),\r\n                transition: \"all, 300ms\"\r\n              },\r\n\r\n\r\n              \"&:hover\": {\r\n                cursor: \"pointer\", transition: \"all, 300ms\",\r\n                \"& > span\": { bgcolor: theme.palette.action.disabled },\r\n                \"& > span > span\": {\r\n                  bgcolor,\r\n                  // bgcolor: hexToRGB(avatarColor, 1),\r\n                  transition: \"all, 300ms\"\r\n                },\r\n              }\r\n            },\r\n\r\n            ...!isVotting && {\r\n              \"& > span\": { bgcolor: \"rgba(0,0,0,0)\" },\r\n              \"& > span > span\": {\r\n                bgcolor,\r\n                //hexToRGB(avatarColor, 0.5), transition: \"all, 300ms\"\r\n              },\r\n            }\r\n\r\n\r\n\r\n\r\n\r\n          }} key={index}\r\n            onClick={function () {\r\n              //   isVotting && alert(\"fsdf\")\r\n              if (isVotting && voteCountRef.current) {\r\n\r\n                voteCountRef.current[index]++;\r\n                let totalVotes_ = totalVotes + 1\r\n\r\n                setPercentageArr(voteCountRef.current.map(item => {\r\n                  return Number(Number((item / totalVotes_) * 100).toFixed(0))\r\n                })\r\n                )\r\n                setTotalVotes(totalVotes_)\r\n                setIsVotting(false)\r\n                axios.put(`${url}/api/voteBlock`, { choicePos: index, userName, postID, })\r\n                //   setVotedArr(pre => [...pre, postID])\r\n              }\r\n\r\n            }}>\r\n            <LinearProgress key={index} variant=\"determinate\" value={percentageArr.length === 0 ? 0 : percentageArr[index]}  // value={Math.min(100, index * 15 + 20)}             //value={Number(Math.random() * 100).toFixed(0)}\r\n              sx={{\r\n                height: theme.scaleSizeObj(1.5), marginBottom: \"2px\",\r\n              }}\r\n            />\r\n\r\n            <Typography variant='body2'\r\n              alt=\"sdfsddf\"\r\n              sx={{\r\n                position: \"absolute\", top: \"50%\", left: 4, zIndex: 100, transform: \"translateY(-50%)\", display: \"block\", width: \"calc(100% - 64px )\",\r\n                //bgcolor: \"yellow\", \r\n                whiteSpace: \"nowrap\",\r\n                overflow: \"hidden\",\r\n                textOverflow: \"ellipsis\"\r\n              }}>\r\n              {(choice.length >= 25 ? choice.substring(0, 25) : choice)}\r\n            </Typography>\r\n            {/* <Typography variant='body2' sx={{ position: \"absolute\", top: \"50%\", right: 0, zIndex: 100, transform: \"translateY(-50%)\" }}>{Math.min(100, (index * 15 + 20)) + \"%\"}</Typography> */}\r\n            {\r\n              voteArr.length === 1 &&\r\n              <Typography variant='body2' sx={{ position: \"absolute\", top: \"50%\", right: 4, zIndex: 100, transform: \"translateY(-50%)\" }}>\r\n                {totalVotes} Votes\r\n              </Typography>\r\n            }\r\n            {\r\n              voteArr.length > 1 &&\r\n              <Typography variant='body2' sx={{ position: \"absolute\", top: \"50%\", right: 4, zIndex: 100, transform: \"translateY(-50%)\" }}>\r\n                {percentageArr.length === 0 ? 0 : percentageArr[index] + \"%\"}\r\n              </Typography>\r\n            }\r\n\r\n          </Box>\r\n        )\r\n\r\n      })}\r\n      {\r\n        expireTime && <Countdown date={Date.parse(expireTime)} intervalDelay={1 * 1000}\r\n          renderer={function ({ days, hours, minutes, seconds, completed, ...props }) {\r\n            return <TimeRender  {...{ days, hours, minutes, seconds, completed, expireTime, totalVotes, ...props }} />\r\n          }}\r\n\r\n          onComplete={function () {\r\n            setIsVotting(false)\r\n          }}\r\n          overtime={true}\r\n\r\n        />\r\n      }\r\n\r\n    </ Box >\r\n\r\n  )\r\n\r\n}\r\n\r\nfunction PostingTime({ postingTime }) {\r\n\r\n\r\n  return (\r\n\r\n    <Countdown date={Date.parse(postingTime)} intervalDelay={1 * 1000}\r\n      renderer={function ({ days, hours, minutes, seconds, completed, ...props }) {\r\n        return <PostTimeRender  {...{ days, hours, minutes, seconds, completed, ...props }} />\r\n      }}\r\n      overtime={true}\r\n    />\r\n\r\n  )\r\n\r\n}\r\n\r\n\r\n\r\nfunction PostTimeRender({ days, hours, minutes, seconds, completed, ...props }) {\r\n\r\n  const theme = useTheme()\r\n\r\n\r\n\r\n  const message = completed\r\n\r\n    ? days > 0\r\n      ? `${days}d`\r\n      : hours > 0\r\n        ? `${hours}h`\r\n        : minutes > 0\r\n          ? `${minutes}m`\r\n          : `0m`//`${seconds}s`//`Just now` //`${seconds} sec ago`\r\n    : days > 0\r\n      ? `Remaining ${days}+ days`\r\n      : hours > 0\r\n        ? `Remaining ${hours}+ hours`\r\n        : minutes > 0\r\n          ? `Remaining ${minutes}+ minutes`\r\n          : `Remaining ${seconds} seconds`\r\n\r\n  return <Typography variant='body2' className=\"count-down\" style={{ fontSize: \"1rem\" }} sx={{ color: theme.palette.text.secondary }}>{message} </Typography>\r\n\r\n}\r\n\r\nfunction TimeRender({ days, hours, minutes, seconds, completed, expireTime, totalVotes, ...props }) {\r\n\r\n  const theme = useTheme()\r\n\r\n\r\n\r\n  const message = completed\r\n    //  ? `Finished on ${format(Date.parse(expireTime), \"yyyy-MM-dd hh:mm\")}`\r\n    ? days > 0\r\n      ? `Closed ${days} days ago`\r\n      : hours > 0\r\n        ? `Closed ${hours} hours ago`\r\n        : minutes > 0\r\n          ? `Closed ${minutes} min ago`\r\n          : `Closed ${seconds} sec ago`\r\n    : days > 0\r\n      ? `${days}+ days Left`\r\n      : hours > 0\r\n        ? `${hours}+ hours Left`\r\n        : minutes > 0\r\n          ? `${minutes}+ min Left`\r\n          : `${seconds} sec Left`\r\n\r\n  return <Box sx={{ display: \"flex\", justifyContent: \"space-between\", paddingLeft: \"4px\", paddingRight: \"4px\" }}>\r\n    <Typography variant='body2' className=\"count-down\" sx={{ color: theme.palette.text.secondary }}>{message} </Typography>\r\n    <Typography variant='body2' className=\"count-down\" sx={{ color: theme.palette.text.secondary }}>Total {totalVotes} </Typography>\r\n    {/* <Typography variant='body2' className=\"count-down\" sx={{ color: theme.palette.text.secondary }}>{days} {hours} {minutes} {seconds}</Typography>\r\n    <Typography variant='body2' className=\"count-down\">{intervalDelay}</Typography> */}\r\n  </Box>\r\n\r\n\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import React, { useState, useRef, useEffect, useLayoutEffect, useContext, useCallback, createContext, useMemo } from 'react';\r\n\r\nimport logo from './logo.svg';\r\nimport './App.css';\r\n\r\n\r\nimport ThemeContextProvider from \"./ThemeContextProvider\";\r\nimport { ContextProvider as EditorCtx } from \"./ContextProvider\";\r\nimport Content, { InstantContent } from \"./Content\";\r\n\r\n\r\nimport { BrowserRouter, Route, Routes, Link, useNavigate, useHistory } from \"react-router-dom\";\r\n\r\n\r\nimport { Container, Grid, Paper, IconButton, ButtonGroup, Stack, Box, Chip, Avatar } from '@mui/material';\r\nimport Dialog from '@mui/material/Dialog';\r\nimport SettingsIcon from '@mui/icons-material/Settings';\r\n\r\nimport { AvatarChip } from \"./PeopleList\"\r\nimport useAppContext from './useAppContext'\r\nimport {\r\n  EditorState, ContentState, ContentBlock, CharacterMetadata, SelectionState, convertToRaw, convertFromRaw,\r\n  RichUtils, Modifier, convertFromHTML, AtomicBlockUtils\r\n} from 'draft-js';\r\nimport multiavatar from '@multiavatar/multiavatar'\r\nimport { url, toPreHtml, hexToRGB, hexToRGB2 } from \"./config\";\r\n\r\nimport { ThemeProvider, useTheme, createTheme, styled, } from '@mui/material/styles';\r\n\r\n\r\nexport default function MainPage() {\r\n\r\n\r\n  const { userName, setUserName, clickFn, setClickFn, isAnimiDone, setIsAnimiDone, savedPostArr, setSavedPostArr, postArr, setPostArr } = useAppContext()\r\n\r\n  const [open, setOpen] = useState(false)\r\n  const [savedEditorState, setSavedEditorState] = useState()\r\n  const [savedImageObj, setSavedImageObj] = useState()\r\n\r\n\r\n  const [savedVoteArr, setSavedVoteArr] = useState()\r\n  const [savedVoteTopic, setSavedVoteTopic] = useState()\r\n  const [savedPollDuration, setSavedPollDuration] = useState()\r\n\r\n\r\n\r\n  const userAvatarSrc = \"data:image/svg+xml;base64,\" + btoa(multiavatar(userName))\r\n  const avatarString = multiavatar(userName)\r\n  let avatarColor = avatarString.match(/#[a-zA-z0-9]*/)[0]\r\n  if (avatarColor.length < 7) {\r\n    avatarColor = \"#\" + avatarColor[1] + avatarColor[1] + avatarColor[2] + avatarColor[2] + avatarColor[3] + avatarColor[3]\r\n  }\r\n  const bgcolor = hexToRGB(avatarColor, 0.2)\r\n\r\n  const theme = useTheme()\r\n\r\n  const navigate = useNavigate()\r\n\r\n  //const [disableBtn, setDisableBtn] = useState(false)\r\n\r\n\r\n  useEffect(function () {\r\n\r\n    setClickFn(pre => (function () { setOpen(true) }))\r\n\r\n\r\n    return function () { setClickFn(null) }\r\n\r\n  }, [])\r\n\r\n  return (\r\n    <>\r\n\r\n\r\n      <Content postArr={postArr} setPostArr={setPostArr} userName={userName} />\r\n\r\n      <Dialog\r\n\r\n        onBackdropClick={function () { setOpen(false) }}\r\n        fullWidth={true}\r\n        //  fullScreen={true}\r\n        open={open}\r\n        onClose={function () { }}\r\n\r\n        scroll={\"body\"}\r\n\r\n        sx={{\r\n          // transform: `scale(${open ? 1 : 0})`,\r\n          // bgcolor:\"rgba(0,0,0,0.7)\",\r\n          // display: open ? \"block\" : \"none\",\r\n          \"& > div > div\": {\r\n            overflow: \"visible\",\r\n            paddingTop: \"8px\",\r\n            px: \"8px\",\r\n            //   bgcolor: \"red\",\r\n\r\n            // width: \"100%\",\r\n            width: { xs: \"95%\", sm: \"95%\", md: \"95%\", lg: \"95%\", xl: \"95%\" },\r\n            mx: 0,\r\n\r\n          },\r\n\r\n          \"& > div > div.MuiPaper-root\": {\r\n\r\n            maxWidth: \"600px\",\r\n          }\r\n          // \"& > div > div \": {\r\n          //   bgcolor:\"red\",\r\n          //   width:\"700px\",\r\n          // }\r\n\r\n        }}\r\n      >\r\n        <Grid container\r\n          direction=\"row\"\r\n          justifyContent=\"space-around\"\r\n          alignItems=\"flex-start\"\r\n          spacing={0}\r\n          sx={{}}\r\n        >\r\n          <Grid item xs={10} sm={10} md={10} lg={10} xl={10} sx={{}}>\r\n            <EditorCtx\r\n\r\n              userName={userName}\r\n              open={open}\r\n\r\n              savedImageObj={savedImageObj}\r\n              setSavedImageObj={setSavedImageObj}\r\n\r\n              savedEditorState={savedEditorState}\r\n              setSavedEditorState={setSavedEditorState}\r\n\r\n              {...{\r\n                savedVoteArr, setSavedVoteArr,\r\n                savedVoteTopic, setSavedVoteTopic,\r\n                savedPollDuration, setSavedPollDuration\r\n              }}\r\n\r\n              onSubmit={function (preHtml,callBack) {\r\n               \r\n                setPostArr(pre => { return [preHtml, ...pre] })\r\n                callBack()\r\n                setOpen(false)\r\n              }} />\r\n          </Grid>\r\n        </Grid>\r\n\r\n      </Dialog>\r\n    </>\r\n  )\r\n}","import React, { useState, useRef, useEffect, useLayoutEffect, useContext, useCallback, createContext, useMemo } from 'react';\n\nimport logo from './logo.svg';\nimport './App.css';\nimport axios from \"axios\";\nimport ThemeContextProvider from \"./ThemeContextProvider\";\nimport { ContextProvider as EditorCtx } from \"./ContextProvider\";\nimport Content, { InstantContent } from \"./Content\";\nimport ContentPerson from \"./ContentPerson\";\n\nimport MainPage from \"./MainPage\";\n\nimport {\n  BrowserRouter, Route, Routes, useRoutes, Link, useParams, matchPath, useLocation, useNavigate, Outlet\n\n} from \"react-router-dom\";\n\n\nimport {\n  Container, Grid, Paper, IconButton, ButtonGroup, Stack, Box, Button, Chip, Avatar, CssBaseline, Typography, Collapse, Switch, Divider,\n  Slider, TextField\n} from '@mui/material';\n\nimport { Crop, DoneRounded, Close, AddCircleOutline, AddAPhoto } from '@mui/icons-material';\nimport Dialog from '@mui/material/Dialog';\n\nimport SettingsIcon from '@mui/icons-material/Settings';\nimport DoDisturbIcon from '@mui/icons-material/DoDisturb';\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack';\n\n\nimport multiavatar from '@multiavatar/multiavatar'\nimport { url, toPreHtml, hexToRGB, hexToRGB2, colorArr, colorIndexArr, getColor } from \"./config\";\n\nimport { ThemeProvider, useTheme, createTheme, styled, } from '@mui/material/styles';\nimport useAppContext from './useAppContext';\n\nimport Radio from '@mui/material/Radio';\nimport RadioGroup from '@mui/material/RadioGroup';\nimport FormControlLabel from '@mui/material/FormControlLabel';\nimport FormControl from '@mui/material/FormControl';\nimport FormLabel from '@mui/material/FormLabel';\n\nimport Cropper from 'react-easy-crop';\nimport getCroppedImg from './cropImage';\nimport AccountCircleOutlinedIcon from '@mui/icons-material/AccountCircleOutlined';\n\nimport TextareaAutosize from '@mui/material/TextareaAutosize';\n\nexport const AppContext = createContext()\n\nfunction App() {\n\n\n  const [postArr, setPostArr] = useState([])\n  //const [userName, setUserName] = useState(\"User\" + String(Math.random()).substring(3, 6))\n  const [userName, setUserName] = useState(localStorage.getItem(\"userName\") || (\"User\" + String(Math.random()).substring(3, 6)))\n  const [userColor, setUserColor] = useState()\n\n\n  const [userAvatarUrl, setUserAvatarUrl] = useState(\"data:image/svg+xml;base64,\" + btoa(multiavatar(userName)))\n\n  const [clickFn, setClickFn] = useState(null)\n\n\n\n  const [savedPostArr, setSavedPostArr] = useState()\n\n  const [needUpdateArr, setNeedUpdateArr] = useState([])\n  const [needReduceArr, setNeedReduceArr] = useState([])\n\n  const [avatarNameArr, setAvatarNameArr] = useState([])\n  const [userInfoArr, setUserInfoArr] = useState([])\n\n\n  const [random, setRandom] = useState(Math.random())\n\n  useEffect(function () {\n    // axios.get(`${url}/api/user/getAllAvatarName`).then(response => {\n    //   setAvatarNameArr(response.data)\n    // })\n\n    axios.get(`${url}/api/user/getAllUser`).then(response => {\n      // setAvatarNameArr(response.data)\n      const arr = response.data.filter(userItem => {\n        return userItem.hasAvatar\n      }).map(userItem => userItem.userName)\n      setAvatarNameArr(arr)\n\n      const colorName = response.data.find(userItem => userItem.userName === userName)?.colorName\n\n      colorName && setUserColor(colorName)\n      setUserInfoArr(response.data)\n\n    })\n\n\n    if (!localStorage.getItem(\"userName\")) {\n\n      axios.post(`${url}/api/user/regist`, { userName }).then(response => {\n        Boolean(response.data)\n          ? localStorage.setItem(\"userName\", userName)\n          : setUserName(\"User\" + String(Math.random()).substring(3, 6))\n      })\n    }\n\n  }, [userName])\n\n  useEffect(function () {\n    if (avatarNameArr.includes(userName)) {\n      setUserAvatarUrl(`${url}/api/user/downloadAvatar/${userName}/${random}`)\n    }\n  }, [avatarNameArr])\n\n  useEffect(function () {\n\n\n\n  }, [userColor])\n\n\n  return (\n    <ThemeContextProvider>\n      <AppContext.Provider value={{\n        userName, setUserName, clickFn, setClickFn,\n        userColor, setUserColor,\n\n        savedPostArr, setSavedPostArr,\n        postArr, setPostArr,\n        needUpdateArr, setNeedUpdateArr,\n        needReduceArr, setNeedReduceArr,\n        userAvatarUrl, setUserAvatarUrl,\n        avatarNameArr, setAvatarNameArr,\n        userInfoArr, setUserInfoArr,\n        random, setRandom,\n      }}>\n\n        <Container disableGutters={true} fixed={false} maxWidth={window.innerWidth >= 3000 ? false : \"lg\"} >\n          <CssBaseline />\n\n          <Routes>\n            <Route path=\"/\" element={<><BarMain /><MainPage /></>} />\n            <Route path=\"/person/*\" element={\n              <>\n                <Routes>\n                  <Route path=\":personName\" element={<><BarPerson /><ContentPerson /></>} />\n                </Routes>\n              </>\n            } />\n          </Routes>\n\n        </Container>\n      </AppContext.Provider>\n    </ThemeContextProvider>\n\n\n\n  );\n}\n\nexport default App;\n\nfunction BarMain({ ...props }) {\n\n  const theme = useTheme()\n  const { userName, setUserName, clickFn, userAvatarUrl, setUserAvatarUrl, random, setRandom, userColor, setUserColor, userInfoArr, setPostArr } = useAppContext()\n  const bgcolor = getColor({ name: userName, userName, userInfoArr, userColor, theme })\n  const [settingOn, setSettingOn] = useState(false)\n  const [open, setOpen] = useState(false)\n\n  const [newName, setNewName] = useState(userName)\n  const nameInputRef = useRef()\n  const [nameBtn, setNameBtn] = useState(true)\n\n  return (\n    <Paper sx={{\n      bgcolor: bgcolor,// theme.isLight ? bgcolor : hexToRGB2(avatarColor, 0.6),\n      padding: \"4px\", my: \"8px\", mx: \"4px\", display: \"flex\", alignItems: \"flex-end\",\n      justifyContent: \"center\",\n    }}>\n      <Box sx={{\n        padding: \"4px\", borderRadius: \"1000px\", bgcolor: \"background.default\", width: \"fit-content\",// opacity: isMainPage ? 1 : 0,\n        transition: \"transfrom, 300ms\",\n      }}>\n        <Avatar src={userAvatarUrl} sx={{ width: \"2.4rem\", height: \"2.4rem\", \"&:hover\": { cursor: \"pointer\", opacity: \"0.8\" } }}\n          onClick={function () { setOpen(true) }}\n        />\n      </Box>\n\n      <Box sx={{\n        //bgcolor: \"background.default\",\n        width: \"60%\", maxWidth: \"600px\",\n        color: theme.palette.text.secondary,\n        //   bgcolor: \"pink\",\n        transition: \"all 300ms\",\n        mx: \"8px\",\n      }}>\n        <Box sx={{\n          bgcolor: \"background.default\", borderRadius: \"8px\", width: \"100%\", maxWidth: \"600px\",\n          color: theme.palette.text.secondary, px: \"8px\",\n          height: \"calc( 2.4rem + 4px )\", display: \"flex\", alignItems: \"center\",\n          marginBottom: settingOn ? \"8px\" : \"2px\"\n        }}\n          onClick={clickFn}\n        >\n          <Typography sx={{ fontSize: theme.sizeObj, color: theme.palette.text.default, display: \"inline-block\" }}>{userName}</Typography>\n        </Box>\n\n        <Collapse unmountOnExit={false} in={settingOn}>\n          <Box direction=\"row\" spacing={2} sx={{ alignItems: \"center\", display: \"flex\", justifyContent: \"space-between\" }}>\n\n\n            <RadioGroup\n              row\n              aria-labelledby=\"demo-controlled-radio-buttons-group\"\n              name=\"controlled-radio-buttons-group\"\n              value={theme.sizeObj[0]}\n              onChange={function (e) {\n                const sizeValue = e.target.value\n\n                theme.setSizeObj({ xs: sizeValue, sm: sizeValue, md: sizeValue, lg: sizeValue, xl: sizeValue })\n              }}\n            >\n              <FormControlLabel value=\"1rem\" control={<Radio />} label=\"\" sx={{ transform: \"scale(0.8)\", \"& span\": { fontSize: \"1rem\" } }} checked={Boolean(theme.sizeObj.xs === \"1rem\")} />\n              <FormControlLabel value=\"1.25rem\" control={<Radio />} label=\"\" sx={{ transform: \"scale(0.9)\", \"& span\": { fontSize: \"1.25rem\" } }} checked={theme.sizeObj.sm === \"1.25rem\"} />\n              <FormControlLabel value=\"1.5rem\" control={<Radio />} label=\"\" sx={{ transform: \"scale(1)\", \"& span\": { fontSize: \"1.5rem\" } }} checked={theme.sizeObj.md === \"1.5rem\"} />\n              <FormControlLabel value=\"1.75rem\" control={<Radio />} label=\"\" sx={{ transform: \"scale(1.1)\", \"& span\": { fontSize: \"1.75rem\" } }} checked={theme.sizeObj.lg === \"1.75rem\"} />\n              <FormControlLabel value=\"2rem\" control={<Radio />} label=\"\" sx={{ transform: \"scale(1.25)\", \"& span\": { fontSize: \"2rem\" } }} checked={theme.sizeObj.xl === \"2rem\"} />\n            </RadioGroup>\n\n            <Switch\n              //   sx={{ position: \"absolute\", right: -10 }}\n              checked={!theme.isLight}\n              onChange={function (event) {\n                event.target.checked\n                  ? theme.setMode(\"dark\")\n                  : theme.setMode(\"light\")\n              }}\n            />\n          </Box>\n          <Box sx={{ display: \"flex\", justifyContent: \"flex-start\", width: \"100%\", gap: \"4px\", flexWrap: \"wrap\" }}>\n            {colorArr.map((colorItem, index) => {\n\n              return (\n                <Box key={index} sx={{\n                  width: \"2.4rem\", height: \"2.4rem\",\n                  borderRadius: \"1000px\",\n                  borderWidth: \"2px\", borderColor: theme.palette.background.default, borderStyle: \"solid\",\n                  \"&:hover\": { transform: \"scale(1.2)\", cursor: \"pointer\" },\n                  transition: \"all 300ms\", overflow: \"hidden\",\n                }}\n                  onClick={function () {\n                    setUserColor(colorIndexArr[index])\n                    axios.put(`${url}/api/user/changeColor`, { userName, colorName: colorIndexArr[index] }).then(response => {\n                      //      console.log(response.data)\n                    })\n                  }}\n                >\n                  <Box sx={{\n                    width: \"100%\", height: \"100%\", bgcolor: colorItem[500] //bgcolor: theme.isLight ? colorItem[100] : hexToRGB2(colorItem[500], 0.7) \n                  }}></Box>\n                </Box>\n              )\n\n\n            })}\n\n            <DoDisturbIcon\n              onClick={function () {\n                setUserColor(null)\n                axios.put(`${url}/api/user/changeColor`, { userName, colorName: \"\" }).then(response => {\n                  //      console.log(response.data)\n                })\n              }}\n              sx={{\n                width: \"2.4rem\", height: \"2.4rem\", \"&:hover\": { transform: \"scale(1.2)\", cursor: \"pointer\" },\n                transition: \"all 300ms\", overflow: \"hidden\",\n              }} fontSize='large' />\n          </Box>\n          <Box sx={{ display: \"flex\", alignItems: \"flex-end\" }}>\n            <TextField label=\"New Name\" variant=\"filled\" sx={{ marginTop: \"4px\", \"& input\": { fontSize: theme.sizeObj, maxWidth: \"200px\" } }}\n              value={newName}\n              inputProps={{ maxLength: 10 }}\n              ref={nameInputRef}\n              onChange={function (e) {\n                const text = e.target.value\n                const regx = /^([\\w_\\[\\u4E00-\\u9FCA\\]]{2,10})$/g\n\n                setNameBtn(pre => {\n                  if (userName === text) { return true }\n                  return !Boolean(text.match(regx))\n\n                })\n                setNewName(e.target.value)\n              }}\n            />\n            <Button disabled={nameBtn} variant='outlined' sx={{ mx: \"4px\" }}\n              onClick={function (e) {\n                setNameBtn(true)\n                axios.get(`${url}/api/user/isUserThere/${newName}`)\n                  .then(response => {\n                    return response.data\n                  })\n                  .then(isThere => {\n                    if (!isThere) {\n                      return axios.put(`${url}/api/user/updateUserName`, { userName, newName })\n                    }\n                    else return false\n                  })\n                  .then(result => {\n\n                    if (result) {\n                      // setPostArr([])\n                      // setUserName(newName)\n                      localStorage.setItem(\"userName\", newName)\n                      window.location.reload();\n                    }\n                    else {\n                      alert(\"name \" + newName + \" was taken\")\n                      setNameBtn(false)\n                    }\n                    //  setNameBtn(false)\n                  })\n\n\n              }}\n            >Change</Button>\n          </Box>\n        </Collapse>\n\n\n\n\n      </Box>\n\n      <Box sx={{\n        padding: \"4px\", borderRadius: \"1000px\", bgcolor: \"background.default\", width: \"fit-content\"\n\n      }}>\n        <Avatar sx={{\n          width: \"2.4rem\", height: \"2.4rem\",\n          // bgcolor: theme.isLight ? bgcolor : hexToRGB2(avatarColor, 0.6),\n          // \"&:hover\": { bgcolor: avatarColor, cursor: \"pointer\" }\n          bgcolor: bgcolor,\n          \"&:hover\": { bgcolor: theme.palette.background.default, cursor: \"pointer\" }\n        }}\n          onClick={function () {\n            // window.open(\"/person\", '_blank')\n            // Boolean(clickFn) ? navigate(`/person/${userName}`) : navigate(`/`)\n            setSettingOn(pre => !pre)\n          }}\n        >\n          <SettingsIcon sx={{ color: theme.palette.background.default, \"&:hover\": { color: bgcolor, } }} fontSize='large' />\n        </Avatar>\n      </Box>\n\n      <Dialog\n        onBackdropClick={function () { setOpen(false) }}\n        fullWidth={true}\n        //  fullScreen={true}\n        open={open}\n        onClose={function () { }}\n        scroll={\"body\"}\n        sx={{ \"& .MuiDialog-paper\": { overflowY: \"auto\", width: \"300px\", height: \"300px\" } }}\n      >\n\n        <Box sx={{ width: \"100%\", height: \"100%\", overflow: \"hidden\" }}>\n          <ImageAdjuster setOpen={setOpen} />\n        </Box>\n\n      </Dialog>\n\n\n    </Paper >\n  )\n}\n\n\nfunction BarPerson() {\n  const theme = useTheme()\n  const { userName, clickFn, userAvatarUrl, setUserAvatarUrl, avatarNameArr, random, userInfoArr, userColor, } = useAppContext()\n  const navigate = useNavigate()\n  const location = useLocation()\n  const isMainPage = Boolean(matchPath(\"/\", location.pathname))\n  const { personName } = useParams()\n\n  const bgcolor = getColor({ name: personName, userName, userInfoArr, userColor, theme })\n  const [newDescription, setNewDescription] = useState(\"\")\n  const userAvatarSrc = userName === personName\n    ? userAvatarUrl\n    : avatarNameArr.includes(personName)\n      ? `${url}/api/user/downloadAvatar/${personName}/${random}`\n      : \"data:image/svg+xml;base64,\" + btoa(multiavatar(personName))\n\n  const avatarString = multiavatar(personName)\n  let avatarColor = avatarString.match(/#[a-zA-z0-9]*/)[0]\n  if (avatarColor.length < 7) {\n    avatarColor = \"#\" + avatarColor[1] + avatarColor[1] + avatarColor[2] + avatarColor[2] + avatarColor[3] + avatarColor[3]\n  }\n\n  const banerRef = useRef()\n  const [height, setHeight] = useState(10)\n  const [imageUrl, setImageUrl] = useState()\n  const [open, setOpen] = useState(false)\n\n  useEffect(function () {\n\n\n    const resizeObserver = new ResizeObserver(entries => {\n      //  console.log(entries[0].contentRect.width)\n      setHeight(entries[0].contentRect.width / 6)\n    })\n\n    resizeObserver.observe(banerRef.current)\n\n\n    axios.get(`${url}/api/user/userDescription/${personName}/${random}`).then(response => {\n      setNewDescription(response.data)\n    })\n\n    return function () { resizeObserver.disconnect() }\n\n\n\n\n  }, [])\n\n  //  useEffect(function () { console.log(imageUrl) }, [imageUrl])\n\n  return (\n    <>\n      <Box sx={{\n        //    bgcolor:\"lightsalmon\", \n        //     padding: \"4px\",\n        my: \"8px\", mx: \"4px\",\n        //display: \"flex\",\n        // alignItems: \"center\",\n        // justifyContent: \"flex-end\",\n        position: \"relative\",\n        // flexDirection: \"column\",\n        maxHeight: 1.5 * height,\n        overflow: \"visible\",\n\n        //  height: height \n      }}>\n\n\n\n        <Box\n          ref={banerRef}\n          sx={{\n            width: \"100%\",// maxWidth: \"600px\",\n            bgcolor,\n            // bgcolor: \"pink\",\n            // overflow: \"hidden\",\n            height,\n            position: \"relative\",\n            overflow: \"visible\",\n            boxShadow: 3,\n            display: \"flex\",\n            alignItems: \"flex-end\",\n            backgroundSize: \"cover\",\n            ...!open && { backgroundImage: `url(${imageUrl || `${url}/api/user/downloadBanerPic/${personName}/${random}`})` },\n          }}>\n          {open && <ImageAdjuster2 setOpen={setOpen} open={open} imageUrl={imageUrl} setImageUrl={setImageUrl} />}\n\n\n          {personName === userName && <IconButton size=\"small\" sx={{\n            transform: { xs: \"scale(1.2)\", sx: \"scale(1.2)\", md: \"scale(1.5)\", lg: \"scale(1.5)\", xl: \"scale(1.5)\" },\n            display: \"block\",\n            bottom: 0,\n            right: 0,\n            position: \"absolute\",\n            zIndex: 300,\n            transform: \"translateY(100%)\",\n          }}\n            onClick={function () { setOpen(pre => !pre) }}\n          >\n            {open\n              ? <Close fontSize='large' sx={{ color: theme.palette.text.secondary }} />\n              : <SettingsIcon fontSize='large' sx={{ color: theme.palette.text.secondary }} />\n            }\n          </IconButton>\n          }\n        </Box>\n\n\n\n        <Grid container\n          direction=\"row\"\n          justifyContent=\"center\"\n          // alignItems=\"flex-end\"\n          spacing={0}\n          sx={{\n            //   bgcolor: \"rgba(122,122,122,0.5)\",\n            transform: \"translateY(-50%)\",\n            //  top: \"50%\",\n            height,\n            zIndex: 200,\n            //   top: \"50%\",\n            overflow: \"hidden\",\n            //  position: \"absolute\",\n          }}\n        >\n          <Grid item xs={1} sm={1} md={1} lg={1} xl={1} sx={{\n            //  bgcolor: \"pink\",\n            height,\n            display: \"flex\",\n            alignItems: \"center\",\n            justifyContent: \"center\"\n          }}>\n            <IconButton size=\"small\" sx={{ transform: { xs: \"scale(1.2)\", sx: \"scale(1.2)\", md: \"scale(1.5)\", lg: \"scale(1.5)\", xl: \"scale(1.5)\" }, }}\n              onClick={function () {\n\n                navigate(\"/\")\n\n              }} >\n              <ArrowBackIcon fontSize='large' sx={{ color: theme.palette.text.secondary }} />\n            </IconButton>\n          </Grid>\n\n          {/* <IconButton size=\"small\" sx={{ postion:\"absolute\", transform: { xs: \"scale(1.2)\", sx: \"scale(1.2)\", md: \"scale(1.5)\", lg: \"scale(1.5)\", xl: \"scale(1.5)\" }, }}\n            onClick={function () { }} >\n            <ArrowBackIcon fontSize='large' sx={{ color: theme.palette.text.secondary }} />\n          </IconButton> */}\n\n\n          <Grid item xs={2} sm={2} md={2} lg={2} xl={2} sx={{\n            position: \"relative\",\n            transform: \"translateX(-16px)\",\n            height,\n          }}>\n            <Avatar src={userAvatarSrc} sx={{\n        \n              width: height,\n              height: height,\n              borderWidth: \"4px\",\n              borderColor: theme.palette.background.default,\n              borderStyle: \"solid\",\n              boxShadow: 3,\n              transform: { xs: \"scale(0.7)\", sx: \"scale(0.7)\", md: \"scale(0.7)\", lg: \"scale(0.7)\", xl: \"scale(0.7)\" },\n         \n              ...open && { display: \"none\" },\n           \n            \n            }}\n            />\n          </Grid>\n\n          <Grid item xs={9} sm={9} md={9} lg={9} xl={9} sx={{\n            //  bgcolor: \"rgba(156,124,12,0.5)\", //height: height / 2, \n            // transform: \"translateY(60%)\"\n            //   bgcolor: \"lightblue\",\n            display: \"flex\", flexDirection: \"column\", justifyContent: \"center\",\n            height,\n            transform: \"translateX(-16px)\",\n          }}>\n            <Typography sx={{ fontSize: theme.sizeObj, height: \"50%\", display: \"flex\", alignItems: \"flex-end\", }}>{personName}</Typography>\n\n            {!open\n              ? <Typography sx={{ fontSize: theme.sizeObj, height: \"50%\", textOverflow: \"ellipsis\", overflow: \"auto\", }}>\n                {newDescription}\n              </Typography>\n              :\n              <>\n                <TextField\n                  value={newDescription}\n                  onChange={function (e) { setNewDescription(e.target.value) }}\n                  autoFocus sx={{ width: \"80%\", bgcolor: \"pink\", \"& textarea\": { fontSize: theme.sizeObj, height: \"100%\" + \" !important\" } }}\n                  multiline\n                />\n                <Button sx={{ width: \"80%\" }} onClick={function () {\n                  setOpen(false)\n                  axios.post(`${url}/api/user/updateDescription`, { userName: personName, description: newDescription })\n\n\n                }}>OK</Button>\n              </>\n\n\n\n\n              //<TextareaAutosize\n              //style={{ fontSize: theme.sizeObj, }}\n              //sx={{ fontSize: theme.sizeObj, width: \"80%\", \"& input\": { fontSize: theme.sizeObj, } }} \n              // />\n            }\n          </Grid>\n        </Grid>\n\n      </Box >\n\n\n\n\n    </>\n  )\n\n\n\n}\n\n\n\n\nfunction ImageAdjuster({ setOpen, ...props }) {\n\n  const { userName, clickFn, userAvatarUrl, setUserAvatarUrl } = useAppContext()\n  const [imageUrl, setImageUrl] = useState(userAvatarUrl)\n\n  const [crop, setCrop] = useState({ x: 0, y: 0 })\n  const [rotation, setRotation] = useState(0)\n  const [zoom, setZoom] = useState(1)\n  const [croppedAreaPixels, setCroppedAreaPixels] = useState(null)\n\n\n  const onCropComplete = useCallback((croppedArea, croppedAreaPixels) => {\n    setCroppedAreaPixels(croppedAreaPixels)\n  }, [])\n\n  // const aspectArr = [1 / 1, 16 / 9, 1 / 1, 1 / 1, 16 / 9]\n\n  const inputRef = useRef()\n  function update(e) {\n    e.stopPropagation()\n    if (e.currentTarget.files[0].name.trim().match(/\\.(gif|jpe?g|tiff|png|webp|bmp)$/i)) {\n\n      const file = URL.createObjectURL(e.currentTarget.files[0])\n      setImageUrl(file)\n    }\n  }\n\n\n\n  return (\n\n    <>\n      <input ref={inputRef} type=\"file\" multiple={false} accept=\"image/*\" style={{ display: \"none\" }}\n        onClick={function (e) { e.currentTarget.value = null; }}\n        onChange={update}\n      />\n\n\n      <IconButton sx={{\n        fontSize: \"2rem\", width: \"2.5rem\", height: \"2.5rem\",\n        position: \"absolute\", top: 8, left: 8,\n        zIndex: 80,\n        bgcolor: \"rgba(255,255,255,0.3)\"\n      }}\n        size=\"small\"\n        contentEditable={false} suppressContentEditableWarning={true}\n        onClick={async function (e) {\n\n          inputRef.current.click()\n\n        }}\n      >\n        <AccountCircleOutlinedIcon fontSize=\"large\" sx={{ \"&:hover\": { bgcolor: \"rgba(255,255,255,0.5)\", borderRadius: \"1000px\" } }} />\n      </IconButton>\n\n      <IconButton sx={{\n        fontSize: \"2rem\", width: \"2.5rem\", height: \"2.5rem\",\n        position: \"absolute\", top: 8, right: 8,\n        zIndex: 80,\n        bgcolor: \"rgba(255,255,255,0.3)\"\n      }}\n        size=\"small\"\n        onClick={async function () {\n          const croppedImage = await getCroppedImg(\n            imageUrl,\n            croppedAreaPixels,\n            rotation,\n          )\n          setUserAvatarUrl(croppedImage)\n          setOpen(false)\n          setImageUrl(croppedImage)\n\n          fetch(croppedImage)\n            .then(file => {\n              return file.blob()\n            })\n            .then(blobData => {\n\n              const data = new FormData();\n\n              data.append(\"file\", new File([blobData], userName, { type: \"image/jpeg\" }))\n              data.append('obj', JSON.stringify({ ownerName: userName }));\n\n              return axios.post(`${url}/api/user/uploadAvatar`, data, {\n                headers: { 'content-type': 'multipart/form-data' },\n              }).then(response => {\n                console.log(response.data)\n              })\n\n            })\n\n\n\n        }}\n      >\n        <Crop fontSize=\"large\" sx={{ \"&:hover\": { bgcolor: \"rgba(255,255,255,0.5)\", borderRadius: \"1000px\" } }} />\n      </IconButton >\n\n\n\n\n      <Box sx={{ width: \"100%\", height: \"100%\", '& div[data-testid*=\"cropper\"]': { borderRadius: \"1000px\" } }}>\n        <Cropper image={imageUrl}  //\"https://img.huffingtonpost.com/asset/5ab4d4ac2000007d06eb2c56.jpeg?cache=sih0jwle4e&ops=1910_1000\"\n          aspect={1}\n          crop={crop}\n          rotation={rotation}\n          zoom={zoom}\n\n          onCropChange={setCrop}\n          onRotationChange={setRotation}\n          onCropComplete={onCropComplete}\n          onZoomChange={setZoom}\n        />\n      </Box>\n\n      <Slider\n        size=\"medium\"\n        value={zoom}\n        min={1}\n        max={3}\n        step={0.1}\n        aria-labelledby=\"Zoom\"\n        //  classes={{ root: classes.slider }}\n        onChange={(e, zoom) => setZoom(zoom)}\n        sx={{\n          //  padding: '22px 0px',\n          //  marginLeft: \"\",\n          marginLeft: \"20px\",\n          marginRight: \"20px\",\n          position: \"absolute\",\n          bottom: 10,\n          left: 0,\n          right: 0,\n          my: \"0\",\n          width: \"85%\",\n          mx: \"auto\",\n          color: \"skyblue\",\n\n        }}\n      />\n\n\n    </>\n  )\n\n}\n\n\nfunction ImageAdjuster2({ open, setOpen, imageUrl, setImageUrl, ...props }) {\n\n  const { userName, clickFn, } = useAppContext()\n  // const [imageUrl, setImageUrl] = useState(userAvatarUrl)\n\n  const [crop, setCrop] = useState({ x: 0, y: 0 })\n  const [rotation, setRotation] = useState(0)\n  const [zoom, setZoom] = useState(1)\n  const [croppedAreaPixels, setCroppedAreaPixels] = useState(null)\n\n\n  const onCropComplete = useCallback((croppedArea, croppedAreaPixels) => {\n    setCroppedAreaPixels(croppedAreaPixels)\n  }, [])\n\n  // const aspectArr = [1 / 1, 16 / 9, 1 / 1, 1 / 1, 16 / 9]\n\n  const inputRef = useRef()\n  function update(e) {\n    e.stopPropagation()\n    if (e.currentTarget.files[0].name.trim().match(/\\.(gif|jpe?g|tiff|png|webp|bmp)$/i)) {\n      const file = URL.createObjectURL(e.currentTarget.files[0])\n      setImageUrl(file)\n    }\n  }\n\n\n\n  return (\n\n    <>\n      <input ref={inputRef} type=\"file\" multiple={false} accept=\"image/*\" style={{ display: \"none\" }}\n        onClick={function (e) { e.currentTarget.value = null; }}\n        onChange={update}\n      />\n\n\n      <IconButton sx={{\n        fontSize: \"2rem\", width: \"2.5rem\", height: \"2.5rem\",\n        position: \"absolute\", top: 8, left: 8,\n        zIndex: 80,\n        bgcolor: \"rgba(255,255,255,0.3)\"\n      }}\n        size=\"small\"\n        contentEditable={false} suppressContentEditableWarning={true}\n        onClick={async function (e) {\n\n          inputRef.current.click()\n\n        }}\n      >\n        <AddAPhoto fontSize=\"large\" sx={{ \"&:hover\": { bgcolor: \"rgba(255,255,255,0.5)\", borderRadius: \"1000px\" } }} />\n      </IconButton>\n\n      <IconButton sx={{\n        fontSize: \"2rem\", width: \"2.5rem\", height: \"2.5rem\",\n        position: \"absolute\", top: 8, right: 8,\n        zIndex: 80,\n        bgcolor: \"rgba(255,255,255,0.3)\"\n      }}\n        size=\"small\"\n        onClick={async function () {\n\n          if (!imageUrl) return\n\n          const croppedImage = await getCroppedImg(\n            imageUrl,\n            croppedAreaPixels,\n            rotation,\n          )\n\n          setOpen(false)\n          setImageUrl(croppedImage)\n\n          fetch(croppedImage)\n            .then(file => {\n              return file.blob()\n            })\n            .then(blobData => {\n\n              const data = new FormData();\n\n              data.append(\"file\", new File([blobData], userName, { type: \"image/jpeg\" }))\n              data.append('obj', JSON.stringify({ ownerName: userName }));\n\n              return axios.post(`${url}/api/user/uploadBanerPic`, data, {\n                headers: { 'content-type': 'multipart/form-data' },\n              }).then(response => {\n                console.log(response.data)\n              })\n            })\n        }}\n      >\n        <Crop fontSize=\"large\" sx={{ \"&:hover\": { bgcolor: \"rgba(255,255,255,0.5)\", borderRadius: \"1000px\" } }} />\n      </IconButton >\n\n\n\n\n      <Box sx={{ width: \"100%\", height: \"100%\", }}>\n        <Cropper image={imageUrl}  //\"https://img.huffingtonpost.com/asset/5ab4d4ac2000007d06eb2c56.jpeg?cache=sih0jwle4e&ops=1910_1000\"\n          aspect={6 / 1}\n          crop={crop}\n          rotation={rotation}\n          zoom={zoom}\n\n          onCropChange={setCrop}\n          onRotationChange={setRotation}\n          onCropComplete={onCropComplete}\n          onZoomChange={setZoom}\n        />\n      </Box>\n\n      {imageUrl && <Slider\n        size=\"medium\"\n        value={zoom}\n        min={1}\n        max={3}\n        step={0.1}\n        aria-labelledby=\"Zoom\"\n        //  classes={{ root: classes.slider }}\n        onChange={(e, zoom) => setZoom(zoom)}\n        sx={{\n          //  padding: '22px 0px',\n          //  marginLeft: \"\",\n          marginLeft: \"20px\",\n          marginRight: \"20px\",\n          position: \"absolute\",\n          bottom: 10,\n          left: 0,\n          right: 0,\n          my: \"0\",\n          width: \"85%\",\n          mx: \"auto\",\n          color: \"skyblue\",\n          zIndex: 600,\n        }}\n      />\n      }\n\n    </>\n  )\n\n}\n\n\n\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport { BrowserRouter } from \"react-router-dom\";\n\n\nReactDOM.render(\n  <React.StrictMode>\n    <BrowserRouter>\n      <App />\n    </BrowserRouter>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}